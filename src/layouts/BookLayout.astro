---
import PageLayout from './PageLayout.astro';
import Button from '@/components/ui/Button.astro';
import Tag from '@/components/ui/Tag.astro';
import BookCover from '@/components/ui/BookCover.astro';
import type { Book } from '@/data/books';

interface Props {
  book: Book;
}

const { book } = Astro.props;

const difficultyLabels = {
  beginner: '入門',
  intermediate: '進階',
  advanced: '高級',
};

const difficultyVariants = {
  beginner: 'success' as const,
  intermediate: 'bitcoin' as const,
  advanced: 'warning' as const,
};
---

<PageLayout
  title={book.title}
  description={book.description}
>
  <article class="py-16 md:py-24">
    <div class="container-wide">
      <!-- Breadcrumb -->
      <nav class="mb-8" aria-label="麵包屑">
        <ol class="flex items-center gap-2 text-sm text-[var(--text-tertiary)]">
          <li>
            <a href="/" class="hover:text-[var(--text-primary)] transition-colors">首頁</a>
          </li>
          <li>/</li>
          <li>
            <a href="/books/" class="hover:text-[var(--text-primary)] transition-colors">書籍</a>
          </li>
          <li>/</li>
          <li class="text-[var(--text-primary)]">{book.title}</li>
        </ol>
      </nav>

      <div class="grid lg:grid-cols-3 gap-12">
        <!-- Book cover -->
        <div class="lg:col-span-1">
          <div class="sticky top-24">
            <div class="flex justify-center">
              <BookCover book={book} size="lg" />
            </div>

            <!-- CTA Button -->
            <div class="mt-6">
              <Button
                href={book.externalUrl}
                variant="primary"
                size="lg"
                class="w-full justify-center"
                external
              >
                <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
                開始閱讀
              </Button>
            </div>
          </div>
        </div>

        <!-- Book info -->
        <div class="lg:col-span-2">
          <!-- Tags -->
          <div class="flex flex-wrap items-center gap-2 mb-4">
            <Tag variant={difficultyVariants[book.difficulty]}>
              {difficultyLabels[book.difficulty]}
            </Tag>
            <span class="text-sm text-[var(--text-tertiary)]">{book.year} 年出版</span>
            <span class="text-sm text-[var(--text-tertiary)]">·</span>
            <span class="text-sm text-[var(--text-tertiary)]">{book.pages} 頁</span>
          </div>

          <!-- Title -->
          <h1 class="text-4xl md:text-5xl font-bold text-[var(--text-primary)] mb-2">
            {book.title}
          </h1>
          <p class="text-xl text-[var(--text-secondary)] mb-8">
            {book.subtitle}
          </p>

          <!-- Meta info -->
          <div class="grid sm:grid-cols-2 gap-6 p-6 rounded-xl bg-[var(--bg-secondary)] mb-8">
            <div>
              <p class="text-sm text-[var(--text-tertiary)] mb-1">作者</p>
              <p class="font-medium text-[var(--text-primary)]">{book.author}</p>
            </div>
            <div>
              <p class="text-sm text-[var(--text-tertiary)] mb-1">譯者</p>
              <p class="font-medium text-[var(--text-primary)]">{book.translator}</p>
            </div>
          </div>

          <!-- Description -->
          <div class="mb-8">
            <h2 class="text-xl font-semibold text-[var(--text-primary)] mb-4">關於本書</h2>
            <p class="text-lg text-[var(--text-secondary)] leading-relaxed">
              {book.description}
            </p>
          </div>

          <!-- Topics -->
          <div class="mb-8">
            <h2 class="text-xl font-semibold text-[var(--text-primary)] mb-4">涵蓋主題</h2>
            <div class="flex flex-wrap gap-2">
              {book.topics.map((topic) => (
                <Tag size="md">{topic}</Tag>
              ))}
            </div>
          </div>

          <!-- Additional content slot -->
          <slot />

          <!-- External link card -->
          <div class="mt-12 p-6 rounded-xl border border-bitcoin-500/30 bg-bitcoin-500/5">
            <div class="flex items-start gap-4">
              <div class="flex-shrink-0">
                <div class="h-12 w-12 rounded-lg bg-bitcoin-500 flex items-center justify-center">
                  <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </div>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-[var(--text-primary)] mb-1">免費線上閱讀</h3>
                <p class="text-sm text-[var(--text-secondary)] mb-3">
                  本書由社群翻譯，完全免費開放閱讀。點擊下方按鈕前往閱讀。
                </p>
                <a
                  href={book.externalUrl}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center text-sm font-medium text-bitcoin-500 hover:text-bitcoin-600"
                >
                  {book.externalUrl}
                  <svg class="ml-1 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Back to books -->
      <div class="mt-16 pt-8 border-t border-[var(--border-default)]">
        <Button href="/books/" variant="ghost">
          <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
          </svg>
          返回書籍列表
        </Button>
      </div>
    </div>
  </article>
</PageLayout>
