---
import Tag from './Tag.astro';

interface Props {
  title: string;
  date: Date;
  endDate?: Date;
  location: string;
  type: 'meetup' | 'conference' | 'workshop' | 'online' | 'hackathon';
  url?: string;
  description: string;
  tags?: string[];
  class?: string;
}

const {
  title,
  date,
  endDate,
  location,
  type,
  url,
  description,
  tags = [],
  class: className = '',
} = Astro.props;

const typeLabels: Record<string, string> = {
  meetup: '聚會',
  conference: '會議',
  workshop: '工作坊',
  online: '線上',
  hackathon: '黑客松',
};

const typeVariants: Record<string, 'bitcoin' | 'lightning' | 'nostr' | 'success' | 'default'> = {
  meetup: 'bitcoin',
  conference: 'lightning',
  workshop: 'success',
  online: 'nostr',
  hackathon: 'default',
};

const formatDate = (d: Date) => {
  return d.toLocaleDateString('zh-TW', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};

const formatDay = (d: Date) => d.getDate();
const formatMonth = (d: Date) => d.toLocaleDateString('zh-TW', { month: 'short' });

const isUpcoming = date > new Date();
---

<div
  class:list={[
    'group block rounded-xl border border-[var(--border-default)] bg-[var(--surface-elevated)] overflow-hidden',
    'transition-all duration-200 ease-out transform-gpu hover:-translate-y-1 hover:border-bitcoin-500/50 hover:shadow-xl hover:shadow-bitcoin-500/10 active:translate-y-0 active:scale-[0.99]',
    className,
  ]}
>
  <div class="flex">
    <!-- Date block -->
    <div class="flex-shrink-0 w-20 bg-bitcoin-500/10 flex flex-col items-center justify-center p-4">
      <span class="text-2xl font-bold text-bitcoin-500">{formatDay(date)}</span>
      <span class="text-sm text-bitcoin-600 dark:text-bitcoin-400">{formatMonth(date)}</span>
    </div>

    <!-- Content -->
    <div class="flex-1 p-4">
      <div class="flex items-center gap-2 mb-2">
        <Tag variant={typeVariants[type]} size="sm">{typeLabels[type]}</Tag>
        {isUpcoming && (
          <span class="text-xs px-2 py-0.5 rounded-full bg-green-500/10 text-green-600 dark:text-green-400">
            即將舉行
          </span>
        )}
      </div>

      <h3 class="text-lg font-semibold text-[var(--text-primary)] group-hover:text-bitcoin-500 transition-colors mb-1">
        {title}
      </h3>

      <div class="flex items-center gap-2 text-sm text-[var(--text-tertiary)] mb-2">
        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        <span>{location}</span>
        {endDate && (
          <>
            <span class="text-[var(--text-tertiary)]">|</span>
            <span>{formatDate(date)} - {formatDate(endDate)}</span>
          </>
        )}
      </div>

      <p class="text-sm text-[var(--text-secondary)] line-clamp-2 mb-3">
        {description}
      </p>

      {tags.length > 0 && (
        <div class="flex flex-wrap gap-1">
          {tags.slice(0, 3).map((tag) => (
            <Tag size="sm">{tag}</Tag>
          ))}
        </div>
      )}

      {url && (
        <a
          href={url}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center gap-1 text-sm text-bitcoin-500 hover:text-bitcoin-600 mt-3"
        >
          查看詳情
          <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
          </svg>
        </a>
      )}
    </div>
  </div>
</div>
