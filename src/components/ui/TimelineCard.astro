---
import Tag from './Tag.astro';
import type { BitcoinMilestone } from '@/data/bitcoin-timeline';
import { categoryLabels, categoryColors } from '@/data/bitcoin-timeline';

interface Props {
  milestone: BitcoinMilestone;
  compact?: boolean;
  class?: string;
}

const { milestone, compact = false, class: className } = Astro.props;
const {
  date,
  title,
  titleEn,
  description,
  category,
  significance,
  blockHeight,
  relatedBips,
  links,
} = milestone;

const tagVariant = categoryColors[category] as
  | 'default'
  | 'bitcoin'
  | 'lightning'
  | 'nostr'
  | 'success'
  | 'warning';
---

<div class:list={['relative pl-6 pb-4', className]}>
  <!-- Timeline dot -->
  <div
    class:list={[
      'absolute -left-[5px] w-2.5 h-2.5 rounded-full mt-1.5',
      significance === 'critical'
        ? 'bg-bitcoin-500'
        : significance === 'major'
          ? 'bg-lightning-500'
          : 'bg-neutral-400 dark:bg-neutral-600',
    ]}
  >
  </div>

  <!-- Content -->
  <div
    class:list={[
      'rounded-lg border border-[var(--border-default)] transition-colors hover:border-[var(--border-hover)]',
      significance === 'critical' ? 'bg-bitcoin-500/5' : 'bg-[var(--surface-elevated)]',
    ]}
  >
    <div class="p-3">
      <div class="flex flex-wrap items-center gap-1.5 mb-1.5 text-xs">
        <span class="font-mono text-[var(--text-tertiary)]">{date.slice(5)}</span>
        <Tag variant={tagVariant} size="sm">{categoryLabels[category]}</Tag>
        {
          blockHeight !== undefined && (
            <span class="font-mono px-1.5 py-0.5 rounded bg-neutral-100 dark:bg-neutral-800 text-[var(--text-tertiary)]">
              #{blockHeight.toLocaleString()}
            </span>
          )
        }
      </div>

      <h3 class="text-base font-semibold text-[var(--text-primary)] leading-snug">{title}</h3>
      {titleEn && <p class="text-xs text-[var(--text-tertiary)] mt-0.5">{titleEn}</p>}
      <p class="text-sm text-[var(--text-secondary)] mt-1.5 leading-relaxed">{description}</p>

      {
        (relatedBips?.length || links?.length) && (
          <div class="flex flex-wrap items-center gap-2 mt-2 pt-2 border-t border-[var(--border-default)]">
            {relatedBips?.map((bip) => (
              <a
                href={`/bips/${bip}`}
                class="text-xs px-1.5 py-0.5 rounded bg-bitcoin-500/10 text-bitcoin-600 dark:text-bitcoin-400 hover:bg-bitcoin-500/20 transition-colors"
              >
                {bip.toUpperCase()}
              </a>
            ))}
            {links?.map((link) => (
              <a href={link.url} class="text-xs text-bitcoin-500 hover:underline">
                {link.label} â†’
              </a>
            ))}
          </div>
        )
      }
    </div>
  </div>
</div>
