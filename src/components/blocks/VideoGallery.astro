---
import VideoCard from '@/components/ui/VideoCard.astro';
import Button from '@/components/ui/Button.astro';

interface Video {
  title: string;
  date: Date;
  duration: string;
  platform: 'youtube' | 'bilibili' | 'vimeo' | 'other';
  embedId: string;
  thumbnailUrl?: string;
  speaker?: string;
  topics: string[];
  description: string;
  language?: 'zh' | 'en' | 'zh-sub';
}

interface Props {
  title?: string;
  subtitle?: string;
  videos: Video[];
  showViewAll?: boolean;
  limit?: number;
  columns?: 2 | 3 | 4;
  class?: string;
}

const {
  title = '精選影片',
  subtitle,
  videos,
  showViewAll = true,
  limit = 6,
  columns = 3,
  class: className = '',
} = Astro.props;

const displayVideos = videos.sort((a, b) => b.date.getTime() - a.date.getTime()).slice(0, limit);

const gridCols = {
  2: 'md:grid-cols-2',
  3: 'md:grid-cols-2 lg:grid-cols-3',
  4: 'md:grid-cols-2 lg:grid-cols-4',
};
---

<section class:list={['py-16 md:py-24', className]}>
  <div class="container-wide">
    <div class="max-w-3xl mx-auto text-center mb-12">
      <h2 class="text-3xl md:text-4xl font-bold text-[var(--text-primary)] mb-4">
        {title}
      </h2>
      {subtitle && <p class="text-lg text-[var(--text-secondary)]">{subtitle}</p>}
    </div>

    {
      displayVideos.length > 0 ? (
        <div class:list={['grid gap-6', gridCols[columns]]}>
          {displayVideos.map((video) => (
            <VideoCard {...video} />
          ))}
        </div>
      ) : (
        <div class="text-center py-12 border border-dashed border-[var(--border-default)] rounded-xl">
          <svg
            class="h-12 w-12 mx-auto text-[var(--text-tertiary)] mb-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
            />
          </svg>
          <p class="text-[var(--text-tertiary)]">暫無影片資源</p>
        </div>
      )
    }

    {
      showViewAll && videos.length > limit && (
        <div class="mt-12 text-center">
          <Button href="/videos/" variant="secondary">
            查看所有影片
            <svg
              class="h-4 w-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </Button>
        </div>
      )
    }
  </div>
</section>
