---
import PageLayout from '@/layouts/PageLayout.astro';
import Button from '@/components/ui/Button.astro';
import Breadcrumb from '@/components/ui/Breadcrumb.astro';
---

<PageLayout
  title="閃電網路服務商 (LSP)"
  description="了解 LSP 如何簡化閃電網路的使用，提供流動性和通道管理服務。"
>
  <article class="py-16 md:py-24">
    <div class="container-wide">
      <div class="max-w-3xl mx-auto">
        <Breadcrumb items={[
          { label: '學習', href: '/learn/' },
          { label: '閃電網路', href: '/learn/lightning/' },
          { label: 'LSP' },
        ]} />

        <!-- Header -->
        <header class="mb-12">
          <div class="flex items-center gap-3 mb-4">
            <span class="px-3 py-1 rounded-full text-sm font-medium bg-purple-500/10 text-purple-600 dark:text-purple-400">
              閃電網路
            </span>
            <span class="text-sm text-[var(--text-tertiary)]">閱讀時間：15 分鐘</span>
          </div>
          <h1 class="text-4xl md:text-5xl font-bold text-[var(--text-primary)] mb-6">
            閃電網路服務商 (LSP)
          </h1>
          <p class="text-xl text-[var(--text-secondary)]">
            Lightning Service Provider (LSP) 是專業的閃電網路服務商，
            幫助用戶和錢包解決流動性、通道管理等複雜問題。
          </p>
        </header>

        <!-- Content -->
        <div class="prose prose-lg prose-zh dark:prose-invert max-w-none">
          <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-12 mb-4">什麼是 LSP？</h2>
          <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
            LSP 是專門為閃電網路提供基礎設施服務的實體。它們運營節點、提供流動性、
            並為錢包和用戶提供各種服務，讓使用閃電網路變得更簡單。
          </p>

          <div class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
            <p class="font-semibold text-[var(--text-primary)] mb-3">LSP 提供的主要服務</p>
            <div class="grid md:grid-cols-2 gap-4 text-sm">
              <div>
                <p class="text-bitcoin-500 font-semibold mb-1">流動性服務</p>
                <ul class="text-[var(--text-secondary)] space-y-1">
                  <li>• 入站流動性</li>
                  <li>• 通道租賃</li>
                  <li>• JIT (Just-In-Time) 通道</li>
                </ul>
              </div>
              <div>
                <p class="text-bitcoin-500 font-semibold mb-1">技術服務</p>
                <ul class="text-[var(--text-secondary)] space-y-1">
                  <li>• 通道管理</li>
                  <li>• 備份服務</li>
                  <li>• 瞭望塔 (Watchtower)</li>
                </ul>
              </div>
            </div>
          </div>

          <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-12 mb-4">為什麼需要 LSP？</h2>

          <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-8 mb-3">流動性問題</h3>
          <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
            閃電網路最大的使用障礙是「入站流動性」。新用戶開設通道後，
            只有出站容量，無法接收付款。LSP 解決這個雞生蛋問題。
          </p>

          <div class="not-prose mb-8 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
            <p class="text-sm text-yellow-700 dark:text-yellow-400">
              <strong>入站流動性問題：</strong> 假設 Alice 用 100,000 sats 開設通道，
              她可以發送最多 100,000 sats，但無法接收任何付款，
              因為對方沒有容量可以推給她。
            </p>
          </div>

          <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-8 mb-3">技術複雜性</h3>
          <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
            運行閃電節點需要：
          </p>

          <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
            <li>• 24/7 在線</li>
            <li>• 定期備份通道狀態</li>
            <li>• 監控懲罰交易</li>
            <li>• 管理多個通道的流動性</li>
            <li>• 處理強制關閉和鏈上交易</li>
          </ul>

          <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
            LSP 將這些複雜性抽象化，讓普通用戶專注於收付款。
          </p>

          <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-12 mb-4">LSP 服務類型</h2>

          <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-8 mb-3">1. 入站流動性</h3>
          <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
            LSP 主動向你開設通道，或在現有通道中為你提供入站容量。
          </p>

          <div class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
            <p class="font-semibold text-[var(--text-primary)] mb-3">入站流動性示例</p>
            <div class="font-mono text-xs text-[var(--text-secondary)] space-y-2">
              <p># LSP 向你開設 1M sats 通道</p>
              <p>┌─────────────────────────────────────┐</p>
              <p>│ LSP                           You   │</p>
              <p>│ [1,000,000 sats] ──────── [0 sats] │</p>
              <p>└─────────────────────────────────────┘</p>
              <p class="text-green-500">你可以接收最多 1,000,000 sats！</p>
            </div>
          </div>

          <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-8 mb-3">2. JIT 通道 (Just-In-Time)</h3>
          <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
            當收到付款請求時，LSP 即時開設通道來轉發付款。
            用戶不需要預先有通道，收到的付款就是入站容量。
          </p>

          <div class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
            <p class="font-semibold text-[var(--text-primary)] mb-3">JIT 通道流程</p>
            <div class="space-y-3 text-sm text-[var(--text-secondary)]">
              <div class="flex items-center gap-3">
                <span class="flex-shrink-0 w-6 h-6 rounded-full bg-bitcoin-500 text-white flex items-center justify-center text-xs">1</span>
                <span>發送者付款 50,000 sats 給你</span>
              </div>
              <div class="flex items-center gap-3">
                <span class="flex-shrink-0 w-6 h-6 rounded-full bg-bitcoin-500 text-white flex items-center justify-center text-xs">2</span>
                <span>LSP 攔截付款，即時開設通道</span>
              </div>
              <div class="flex items-center gap-3">
                <span class="flex-shrink-0 w-6 h-6 rounded-full bg-bitcoin-500 text-white flex items-center justify-center text-xs">3</span>
                <span>通道包含這筆付款（扣除開通道費用）</span>
              </div>
              <div class="flex items-center gap-3">
                <span class="flex-shrink-0 w-6 h-6 rounded-full bg-green-500 text-white flex items-center justify-center text-xs">✓</span>
                <span>你收到付款，同時獲得通道！</span>
              </div>
            </div>
          </div>

          <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-8 mb-3">3. 通道租賃</h3>
          <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
            付費「租用」一段時間的入站容量。LSP 保證在租期內保持通道開放。
          </p>

          <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-8 mb-3">4. 瞭望塔 (Watchtower)</h3>
          <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
            監控區塊鏈，檢測對手是否廣播過期的承諾交易。
            如果檢測到作弊，自動廣播懲罰交易。
          </p>

          <div class="not-prose mb-8 p-4 rounded-lg bg-green-500/10 border border-green-500/30">
            <p class="text-sm text-green-700 dark:text-green-400">
              <strong>為什麼需要瞭望塔？</strong> 如果你的節點離線，
              對手可以廣播舊狀態偷走你的資金。瞭望塔服務確保即使你離線，
              也有人監控並保護你的資金。
            </p>
          </div>

          <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-12 mb-4">LSPS 標準</h2>
          <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
            Lightning Service Provider Specification (LSPS) 是正在制定的 LSP 服務標準，
            旨在提供錢包和 LSP 之間的互操作性。
          </p>

          <div class="not-prose mb-6 overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="border-b border-[var(--border-default)]">
                  <th class="text-left py-2 text-[var(--text-primary)]">規範</th>
                  <th class="text-left py-2 text-[var(--text-primary)]">描述</th>
                  <th class="text-left py-2 text-[var(--text-primary)]">狀態</th>
                </tr>
              </thead>
              <tbody class="text-[var(--text-secondary)]">
                <tr class="border-b border-[var(--border-default)]">
                  <td class="py-2 font-mono">LSPS0</td>
                  <td class="py-2">傳輸層和 API 基礎</td>
                  <td class="py-2 text-green-500">Final</td>
                </tr>
                <tr class="border-b border-[var(--border-default)]">
                  <td class="py-2 font-mono">LSPS1</td>
                  <td class="py-2">通道請求</td>
                  <td class="py-2 text-green-500">Final</td>
                </tr>
                <tr class="border-b border-[var(--border-default)]">
                  <td class="py-2 font-mono">LSPS2</td>
                  <td class="py-2">JIT 通道</td>
                  <td class="py-2 text-yellow-500">Draft</td>
                </tr>
                <tr>
                  <td class="py-2 font-mono">LSPS4</td>
                  <td class="py-2">持續的通道服務</td>
                  <td class="py-2 text-yellow-500">Draft</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-12 mb-4">知名 LSP</h2>

          <div class="not-prose mb-6 space-y-4">
            <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
              <p class="font-semibold text-[var(--text-primary)]">ACINQ (Phoenix)</p>
              <p class="text-sm text-[var(--text-secondary)] mt-1">Phoenix 錢包背後的公司，提供自動化的通道管理和流動性服務</p>
            </div>
            <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
              <p class="font-semibold text-[var(--text-primary)]">Breez</p>
              <p class="text-sm text-[var(--text-secondary)] mt-1">提供 SDK 和 LSP 服務，讓開發者輕鬆集成閃電網路</p>
            </div>
            <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
              <p class="font-semibold text-[var(--text-primary)]">Voltage</p>
              <p class="text-sm text-[var(--text-secondary)] mt-1">託管節點和 LSP 服務，適合企業使用</p>
            </div>
            <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
              <p class="font-semibold text-[var(--text-primary)]">Olympus by ZEUS</p>
              <p class="text-sm text-[var(--text-secondary)] mt-1">ZEUS 錢包的 LSP，支援 LSPS 標準</p>
            </div>
          </div>

          <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-12 mb-4">LSP 的權衡</h2>

          <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-8 mb-3">優點</h3>
          <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
            <li class="flex items-start gap-2">
              <span class="text-green-500">✓</span>
              <span>大幅降低使用門檻</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500">✓</span>
              <span>自動管理流動性</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500">✓</span>
              <span>提供額外的安全保護（瞭望塔）</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-green-500">✓</span>
              <span>更好的路由連通性</span>
            </li>
          </ul>

          <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-8 mb-3">缺點</h3>
          <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
            <li class="flex items-start gap-2">
              <span class="text-red-500">✗</span>
              <span>增加費用（服務費 + 開通道費）</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-red-500">✗</span>
              <span>隱私降低（LSP 知道你的交易）</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-red-500">✗</span>
              <span>可能存在單點故障</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-red-500">✗</span>
              <span>依賴第三方服務</span>
            </li>
          </ul>

          <div class="not-prose mb-8 p-4 rounded-lg bg-red-500/10 border border-red-500/30">
            <p class="text-sm text-red-700 dark:text-red-400">
              <strong>隱私考量：</strong> LSP 可以看到通過其節點的所有付款。
              雖然這不代表它們知道最終收款人，但這確實減少了隱私。
              對於高隱私需求，考慮自己運行節點。
            </p>
          </div>

          <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-12 mb-4">選擇 LSP 的考量</h2>

          <div class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
            <div class="space-y-3 text-sm">
              <div class="flex items-start gap-3">
                <div class="flex-shrink-0 w-6 h-6 rounded-full bg-bitcoin-500/20 text-bitcoin-500 flex items-center justify-center font-bold text-xs">1</div>
                <div>
                  <p class="font-semibold text-[var(--text-primary)]">費用結構</p>
                  <p class="text-[var(--text-secondary)]">通道費用、服務費、路由費率</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="flex-shrink-0 w-6 h-6 rounded-full bg-bitcoin-500/20 text-bitcoin-500 flex items-center justify-center font-bold text-xs">2</div>
                <div>
                  <p class="font-semibold text-[var(--text-primary)]">可靠性</p>
                  <p class="text-[var(--text-secondary)]">節點正常運行時間、歷史記錄</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="flex-shrink-0 w-6 h-6 rounded-full bg-bitcoin-500/20 text-bitcoin-500 flex items-center justify-center font-bold text-xs">3</div>
                <div>
                  <p class="font-semibold text-[var(--text-primary)]">隱私政策</p>
                  <p class="text-[var(--text-secondary)]">數據保留、日誌政策</p>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="flex-shrink-0 w-6 h-6 rounded-full bg-bitcoin-500/20 text-bitcoin-500 flex items-center justify-center font-bold text-xs">4</div>
                <div>
                  <p class="font-semibold text-[var(--text-primary)]">標準支援</p>
                  <p class="text-[var(--text-secondary)]">是否支援 LSPS 標準，便於切換</p>
                </div>
              </div>
            </div>
          </div>

          <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-12 mb-4">未來發展</h2>
          <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
            <li>• <strong class="text-[var(--text-primary)]">LSPS 標準化</strong>：更好的互操作性和競爭</li>
            <li>• <strong class="text-[var(--text-primary)]">Splicing</strong>：動態調整通道大小，減少 LSP 依賴</li>
            <li>• <strong class="text-[var(--text-primary)]">點對點流動性市場</strong>：去中心化的流動性交易</li>
          </ul>

          <div class="not-prose mb-6 p-4 rounded-lg bg-bitcoin-500/10 border border-bitcoin-500/30">
            <p class="text-sm text-bitcoin-700 dark:text-bitcoin-400">
              <strong>延伸閱讀：</strong> 了解 <a href="/learn/lightning/channels" class="underline">支付通道</a>
              和 <a href="/learn/lightning/routing" class="underline">路由機制</a> 可以更好地理解 LSP 的作用。
            </p>
          </div>
        </div>

        <!-- Navigation -->
        <div class="mt-12 pt-8 border-t border-[var(--border-default)] flex justify-between">
          <Button href="/learn/lightning/invoices" variant="ghost">
            <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
            上一篇：發票格式
          </Button>
          <Button href="/learn/lightning/" variant="primary">
            返回閃電網路
            <svg class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
          </Button>
        </div>
      </div>
    </div>
  </article>
</PageLayout>
