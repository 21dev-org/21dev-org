---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="UTXO 模型"
  description="深入理解比特幣的未花費交易輸出模型，這是比特幣與傳統帳戶模型的核心差異。"
  breadcrumbs={[
    { label: '學習', href: '/learn/' },
    { label: '進階知識', href: '/learn/intermediate/' },
    { label: 'UTXO 模型' },
  ]}
  difficulty="intermediate"
  readingTime="20 分鐘"
  prevPage={{ title: '入門基礎', href: '/learn/basics/' }}
  nextPage={{ title: '交易結構', href: '/learn/intermediate/transaction-structure' }}
>
  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">什麼是 UTXO？</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    UTXO 是 "Unspent Transaction Output"（未花費交易輸出）的縮寫。
    這是比特幣追蹤所有權的核心機制，與傳統銀行系統使用的帳戶餘額模型有根本性的不同。
  </p>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    你可以把 UTXO 想像成一張張的紙幣。每張紙幣有固定的面額，
    當你想要支付時，必須使用整張紙幣，如果金額超過需要支付的數目，
    你會收到找零（一個新的 UTXO）。
  </p>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">UTXO vs 帳戶模型</h2>
  <div class="not-prose mb-8 overflow-x-auto">
    <table class="w-full text-sm border border-[var(--border-default)] rounded-lg overflow-hidden" aria-label="UTXO 模型與帳戶模型的特性比較：餘額追蹤、隱私性、並行處理、驗證效率">
      <thead class="bg-[var(--bg-secondary)]">
        <tr>
          <th scope="col" class="px-4 py-3 text-left text-[var(--text-primary)]">特性</th>
          <th scope="col" class="px-4 py-3 text-left text-[var(--text-primary)]">UTXO 模型（比特幣）</th>
          <th scope="col" class="px-4 py-3 text-left text-[var(--text-primary)]">帳戶模型（銀行/以太坊）</th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-t border-[var(--border-default)]">
          <td class="px-4 py-3 text-[var(--text-secondary)]">餘額追蹤</td>
          <td class="px-4 py-3 text-[var(--text-secondary)]">計算所有 UTXO 的總和</td>
          <td class="px-4 py-3 text-[var(--text-secondary)]">直接存儲餘額數字</td>
        </tr>
        <tr class="border-t border-[var(--border-default)]">
          <td class="px-4 py-3 text-[var(--text-secondary)]">隱私性</td>
          <td class="px-4 py-3 text-[var(--text-secondary)]">較好（可使用多個地址）</td>
          <td class="px-4 py-3 text-[var(--text-secondary)]">較差（所有交易關聯同一帳戶）</td>
        </tr>
        <tr class="border-t border-[var(--border-default)]">
          <td class="px-4 py-3 text-[var(--text-secondary)]">並行處理</td>
          <td class="px-4 py-3 text-[var(--text-secondary)]">天然支持（不同 UTXO 獨立）</td>
          <td class="px-4 py-3 text-[var(--text-secondary)]">需要處理 nonce 順序</td>
        </tr>
        <tr class="border-t border-[var(--border-default)]">
          <td class="px-4 py-3 text-[var(--text-secondary)]">驗證效率</td>
          <td class="px-4 py-3 text-[var(--text-secondary)]">只需驗證輸入的 UTXO</td>
          <td class="px-4 py-3 text-[var(--text-secondary)]">需要知道當前狀態</td>
        </tr>
      </tbody>
    </table>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">UTXO 的生命週期</h2>
  <div class="space-y-4 mb-8">
    <div class="flex items-start gap-4 p-4 rounded-lg bg-[var(--bg-secondary)]">
      <div class="w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center font-bold text-sm">1</div>
      <div>
        <h3 class="font-semibold text-[var(--text-primary)]">創建</h3>
        <p class="text-sm text-[var(--text-secondary)]">
          當一筆交易被確認，它的輸出就成為新的 UTXO。這些 UTXO 被「鎖定」在特定的腳本條件下。
        </p>
      </div>
    </div>
    <div class="flex items-start gap-4 p-4 rounded-lg bg-[var(--bg-secondary)]">
      <div class="w-8 h-8 rounded-full bg-bitcoin-500 text-white flex items-center justify-center font-bold text-sm">2</div>
      <div>
        <h3 class="font-semibold text-[var(--text-primary)]">存在</h3>
        <p class="text-sm text-[var(--text-secondary)]">
          UTXO 存在於 UTXO 集合中，等待被花費。全節點維護這個集合來驗證新交易。
        </p>
      </div>
    </div>
    <div class="flex items-start gap-4 p-4 rounded-lg bg-[var(--bg-secondary)]">
      <div class="w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center font-bold text-sm">3</div>
      <div>
        <h3 class="font-semibold text-[var(--text-primary)]">花費</h3>
        <p class="text-sm text-[var(--text-secondary)]">
          當 UTXO 被用作交易輸入時，它就被「銷毀」了。你必須提供滿足鎖定條件的「解鎖腳本」。
        </p>
      </div>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">實際範例</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-4">
    假設 Alice 想要發送 0.3 BTC 給 Bob，而她有以下 UTXO：
  </p>
  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span>UTXO 1: 0.2 BTC</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span>UTXO 2: 0.15 BTC</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span>UTXO 3: 0.1 BTC</span>
    </li>
  </ul>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    Alice 需要選擇足夠的 UTXO 來支付 0.3 BTC 加上交易費用。她可以使用 UTXO 1 和 UTXO 2（總計 0.35 BTC），
    然後創建兩個輸出：
  </p>
  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-green-500">→</span>
      <span>給 Bob: 0.3 BTC</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-blue-500">→</span>
      <span>找零給自己: 0.0499 BTC（扣除 0.0001 BTC 交易費）</span>
    </li>
  </ul>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">UTXO 集合</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    所有未花費的 UTXO 組成了「UTXO 集合」。這個集合是驗證新交易的關鍵數據結構。
    當一筆交易聲稱要花費某個 UTXO 時，節點會檢查這個 UTXO 是否存在於集合中。
  </p>
  <div class="p-4 rounded-lg bg-bitcoin-500/10 border border-bitcoin-500/30 mb-8">
    <p class="text-sm text-bitcoin-700 dark:text-bitcoin-400">
      <strong>有趣的事實：</strong> 截至 2024 年，比特幣 UTXO 集合包含約 1.5 億個 UTXO，
      佔用約 8 GB 的磁碟空間。全節點需要將此集合保存在快速存儲中以高效驗證交易。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">UTXO 管理最佳實踐</h2>
  <ul class="space-y-3 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span><strong class="text-[var(--text-primary)]">合併小額 UTXO</strong>：當交易費用較低時，合併多個小額 UTXO 以降低未來的費用</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span><strong class="text-[var(--text-primary)]">避免 dust</strong>：不要創建太小的 UTXO（通常小於 546 satoshis），它們的花費成本可能超過價值</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span><strong class="text-[var(--text-primary)]">隱私考量</strong>：使用新地址接收找零，避免地址重用</span>
    </li>
  </ul>
</ArticleLayout>
