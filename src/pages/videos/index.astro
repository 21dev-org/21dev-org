---
import { getCollection } from 'astro:content';
import PageLayout from '@/layouts/PageLayout.astro';
import VideoCard from '@/components/ui/VideoCard.astro';
import Button from '@/components/ui/Button.astro';
import Tag from '@/components/ui/Tag.astro';

const allVideos = await getCollection('videos');

// Sort videos by date (newest first)
const sortedVideos = allVideos.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Get unique topics
const allTopics = [...new Set(sortedVideos.flatMap((v) => v.data.topics))];
---

<PageLayout title="影片資源" description="精選的比特幣技術影片教學和演講。">
  <!-- Hero section -->
  <section
    class="py-16 md:py-24 bg-gradient-to-b from-[var(--bg-secondary)] to-[var(--bg-primary)]"
  >
    <div class="container-wide">
      <div class="max-w-3xl">
        <h1 class="text-4xl md:text-5xl font-bold text-[var(--text-primary)] mb-6">影片資源</h1>
        <p class="text-xl text-[var(--text-secondary)]">
          精選的比特幣技術影片，包括教學、演講和訪談。透過影片更直觀地學習比特幣技術。
        </p>
      </div>
    </div>
  </section>

  <!-- Topic filter -->
  {
    allTopics.length > 0 && (
      <section class="py-8 border-b border-[var(--border-default)]">
        <div class="container-wide">
          <div class="flex flex-wrap items-center gap-2">
            <span class="text-sm text-[var(--text-tertiary)] mr-2">主題：</span>
            <Tag variant="bitcoin" size="md">
              全部
            </Tag>
            {allTopics.slice(0, 8).map((topic) => (
              <Tag size="md">{topic}</Tag>
            ))}
          </div>
        </div>
      </section>
    )
  }

  <!-- Videos grid -->
  <section class="py-16 md:py-24">
    <div class="container-wide">
      {
        sortedVideos.length > 0 ? (
          <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {sortedVideos.map((video) => (
              <VideoCard
                title={video.data.title}
                date={video.data.date}
                duration={video.data.duration}
                platform={video.data.platform}
                embedId={video.data.embedId}
                thumbnailUrl={video.data.thumbnailUrl}
                speaker={video.data.speaker}
                topics={video.data.topics}
                description={video.data.description}
                language={video.data.language}
                href={`/videos/${video.slug}`}
              />
            ))}
          </div>
        ) : (
          <div class="text-center py-12 border border-dashed border-[var(--border-default)] rounded-xl">
            <svg
              class="h-12 w-12 mx-auto text-[var(--text-tertiary)] mb-4"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
              />
            </svg>
            <p class="text-lg text-[var(--text-secondary)]">影片資源即將推出。</p>
          </div>
        )
      }
    </div>
  </section>

  <!-- Contribute -->
  <section class="py-16 md:py-24 bg-[var(--bg-secondary)]">
    <div class="container-wide text-center">
      <h2 class="text-3xl font-bold text-[var(--text-primary)] mb-4">推薦影片</h2>
      <p class="text-lg text-[var(--text-secondary)] mb-8 max-w-2xl mx-auto">
        如果你知道優質的比特幣技術影片，歡迎推薦給我們。
      </p>
      <Button
        href="https://github.com/21dev-org/21dev-org/issues/new?template=video_request.md"
        variant="primary"
        size="lg"
        external
      >
        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
          ></path>
        </svg>
        推薦影片
      </Button>
    </div>
  </section>
</PageLayout>
