---
import BookLayout from '@/layouts/BookLayout.astro';
import { getBookById } from '@/data/books';

const book = getBookById('mastering-bitcoin-3rd')!;
---

<BookLayout book={book}>
  <div class="mb-8">
    <h2 class="text-xl font-semibold text-[var(--text-primary)] mb-4">第三版新增內容</h2>
    <ul class="space-y-3 text-[var(--text-secondary)]">
      <li class="flex items-start gap-3">
        <span class="text-bitcoin-500 mt-1">•</span>
        <span>完整涵蓋 SegWit（隔離見證）的技術細節和實現</span>
      </li>
      <li class="flex items-start gap-3">
        <span class="text-bitcoin-500 mt-1">•</span>
        <span>深入解析 Taproot 升級，包括 Schnorr 簽名和 Tapscript</span>
      </li>
      <li class="flex items-start gap-3">
        <span class="text-bitcoin-500 mt-1">•</span>
        <span>PSBT（部分簽名比特幣交易）的完整說明</span>
      </li>
      <li class="flex items-start gap-3">
        <span class="text-bitcoin-500 mt-1">•</span>
        <span>更新的安全最佳實踐和現代錢包架構</span>
      </li>
      <li class="flex items-start gap-3">
        <span class="text-bitcoin-500 mt-1">•</span>
        <span>由 David A. Harding 共同撰寫，增加更多技術深度</span>
      </li>
    </ul>
  </div>

  <div class="mb-8">
    <h2 class="text-xl font-semibold text-[var(--text-primary)] mb-4">章節概覽</h2>
    <div class="grid sm:grid-cols-2 gap-3">
      {[
        { num: 1, title: '比特幣簡介', desc: '歷史與基本概念' },
        { num: 2, title: '比特幣的運作原理', desc: '交易、區塊與挖礦' },
        { num: 3, title: 'Bitcoin Core', desc: '參考實現與節點運行' },
        { num: 4, title: '密鑰與地址', desc: '橢圓曲線與地址格式' },
        { num: 5, title: '錢包恢復', desc: 'HD 錢包與備份策略' },
        { num: 6, title: '交易', desc: '交易結構與序列化' },
        { num: 7, title: '授權與認證', desc: 'Script 與簽名驗證' },
        { num: 8, title: '數位簽章', desc: 'ECDSA 與 Schnorr' },
        { num: 9, title: '交易手續費', desc: '費率估算與 RBF' },
        { num: 10, title: '比特幣網路', desc: 'P2P 協議與節點發現' },
        { num: 11, title: '區塊鏈', desc: '區塊結構與 Merkle Tree' },
        { num: 12, title: '挖礦與共識', desc: 'PoW 與難度調整' },
        { num: 13, title: '比特幣安全', desc: '最佳實踐與威脅模型' },
        { num: 14, title: '第二層應用', desc: '閃電網路與狀態通道' },
      ].map((chapter) => (
        <div class="flex items-start gap-3 p-3 rounded-lg bg-[var(--bg-secondary)]">
          <span class="flex-shrink-0 w-6 h-6 rounded bg-bitcoin-500/10 text-bitcoin-500 text-xs font-medium flex items-center justify-center">
            {chapter.num}
          </span>
          <div>
            <span class="text-sm font-medium text-[var(--text-primary)]">{chapter.title}</span>
            <p class="text-xs text-[var(--text-tertiary)]">{chapter.desc}</p>
          </div>
        </div>
      ))}
    </div>
  </div>

  <div class="mb-8">
    <h2 class="text-xl font-semibold text-[var(--text-primary)] mb-4">技術升級亮點</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="p-4 rounded-lg border border-[var(--border-default)]">
        <h3 class="font-semibold text-[var(--text-primary)] mb-2 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-green-500"></span>
          Taproot (BIP-340/341/342)
        </h3>
        <ul class="space-y-1 text-sm text-[var(--text-secondary)]">
          <li>• Schnorr 簽名方案的完整解析</li>
          <li>• MAST（Merkle 抽象語法樹）原理</li>
          <li>• Tapscript 新操作碼</li>
          <li>• 隱私與效率的提升</li>
        </ul>
      </div>
      <div class="p-4 rounded-lg border border-[var(--border-default)]">
        <h3 class="font-semibold text-[var(--text-primary)] mb-2 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-blue-500"></span>
          SegWit 深入解析
        </h3>
        <ul class="space-y-1 text-sm text-[var(--text-secondary)]">
          <li>• 隔離見證的技術原理</li>
          <li>• 區塊權重計算</li>
          <li>• Bech32/Bech32m 地址格式</li>
          <li>• 向後兼容性設計</li>
        </ul>
      </div>
      <div class="p-4 rounded-lg border border-[var(--border-default)]">
        <h3 class="font-semibold text-[var(--text-primary)] mb-2 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-yellow-500"></span>
          PSBT (BIP-174)
        </h3>
        <ul class="space-y-1 text-sm text-[var(--text-secondary)]">
          <li>• 部分簽名交易格式</li>
          <li>• 多方簽名工作流程</li>
          <li>• 硬體錢包整合</li>
          <li>• 離線簽名最佳實踐</li>
        </ul>
      </div>
      <div class="p-4 rounded-lg border border-[var(--border-default)]">
        <h3 class="font-semibold text-[var(--text-primary)] mb-2 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-purple-500"></span>
          現代錢包架構
        </h3>
        <ul class="space-y-1 text-sm text-[var(--text-secondary)]">
          <li>• 輸出描述符（Descriptors）</li>
          <li>• Miniscript 策略語言</li>
          <li>• 多路徑派生標準</li>
          <li>• 錢包互操作性</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="mb-8">
    <h2 class="text-xl font-semibold text-[var(--text-primary)] mb-4">第二版 vs 第三版</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-sm border border-[var(--border-default)] rounded-lg overflow-hidden" aria-label="精通比特幣第二版與第三版內容比較">
        <thead class="bg-[var(--bg-secondary)]">
          <tr>
            <th scope="col" class="px-4 py-3 text-left text-[var(--text-primary)]">主題</th>
            <th scope="col" class="px-4 py-3 text-left text-[var(--text-primary)]">第二版 (2017)</th>
            <th scope="col" class="px-4 py-3 text-left text-[var(--text-primary)]">第三版 (2023)</th>
          </tr>
        </thead>
        <tbody class="text-[var(--text-secondary)]">
          <tr class="border-t border-[var(--border-default)]">
            <td class="px-4 py-3 font-medium">簽名方案</td>
            <td class="px-4 py-3">ECDSA</td>
            <td class="px-4 py-3">ECDSA + Schnorr</td>
          </tr>
          <tr class="border-t border-[var(--border-default)]">
            <td class="px-4 py-3 font-medium">地址格式</td>
            <td class="px-4 py-3">Base58、Bech32</td>
            <td class="px-4 py-3">Base58、Bech32、Bech32m</td>
          </tr>
          <tr class="border-t border-[var(--border-default)]">
            <td class="px-4 py-3 font-medium">腳本</td>
            <td class="px-4 py-3">P2PKH、P2SH、P2WPKH</td>
            <td class="px-4 py-3">+ P2TR、Tapscript</td>
          </tr>
          <tr class="border-t border-[var(--border-default)]">
            <td class="px-4 py-3 font-medium">錢包標準</td>
            <td class="px-4 py-3">BIP-32/39/44</td>
            <td class="px-4 py-3">+ PSBT、Descriptors</td>
          </tr>
          <tr class="border-t border-[var(--border-default)]">
            <td class="px-4 py-3 font-medium">Layer 2</td>
            <td class="px-4 py-3">概念介紹</td>
            <td class="px-4 py-3">閃電網路完整章節</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="mb-8">
    <h2 class="text-xl font-semibold text-[var(--text-primary)] mb-4">適合讀者</h2>
    <div class="grid md:grid-cols-3 gap-4">
      <div class="p-4 rounded-lg border border-green-500/30 bg-green-500/5">
        <h3 class="font-semibold text-green-600 dark:text-green-400 mb-2">非常適合</h3>
        <ul class="space-y-1 text-sm text-[var(--text-secondary)]">
          <li>• 讀過第二版想了解新發展</li>
          <li>• 需要掌握 Taproot 的開發者</li>
          <li>• 想構建現代比特幣應用</li>
        </ul>
      </div>
      <div class="p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/5">
        <h3 class="font-semibold text-yellow-600 dark:text-yellow-400 mb-2">可能適合</h3>
        <ul class="space-y-1 text-sm text-[var(--text-secondary)]">
          <li>• 比特幣技術新手（內容較深）</li>
          <li>• 非開發者但想深入理解</li>
          <li>• 區塊鏈研究人員</li>
        </ul>
      </div>
      <div class="p-4 rounded-lg border border-red-500/30 bg-red-500/5">
        <h3 class="font-semibold text-red-600 dark:text-red-400 mb-2">不太適合</h3>
        <ul class="space-y-1 text-sm text-[var(--text-secondary)]">
          <li>• 完全沒有技術背景</li>
          <li>• 只想了解比特幣投資</li>
          <li>• 尋找快速入門指南</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="p-4 rounded-lg bg-bitcoin-500/10 border border-bitcoin-500/30">
    <h4 class="font-semibold text-bitcoin-700 dark:text-bitcoin-400 mb-2">學習建議</h4>
    <p class="text-sm text-bitcoin-700/80 dark:text-bitcoin-400/80 mb-3">
      如果你是比特幣技術新手，建議先閱讀第二版打好基礎，再學習第三版的新內容。
      第三版假設讀者已經理解基本概念，直接深入最新的協議升級。
    </p>
    <div class="flex flex-wrap gap-2">
      <a href="/books/mastering-bitcoin" class="inline-flex items-center gap-1 text-sm text-bitcoin-600 dark:text-bitcoin-400 hover:underline">
        閱讀第二版 →
      </a>
      <span class="text-bitcoin-500/50">|</span>
      <a href="/bips/bip-0340" class="inline-flex items-center gap-1 text-sm text-bitcoin-600 dark:text-bitcoin-400 hover:underline">
        了解 Schnorr 簽名 →
      </a>
      <span class="text-bitcoin-500/50">|</span>
      <a href="/bips/bip-0341" class="inline-flex items-center gap-1 text-sm text-bitcoin-600 dark:text-bitcoin-400 hover:underline">
        了解 Taproot →
      </a>
    </div>
  </div>
</BookLayout>
