---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="NIP-89: æ‡‰ç”¨æ¨è–¦"
  description="Recommended Application Handlers - æ‡‰ç”¨ç™¼ç¾èˆ‡äº‹ä»¶è™•ç†"
  breadcrumbs={[
    { label: 'æŠ€è¡“', href: '/tech/' },
    { label: 'Nostr', href: '/tech/nostr/' },
    { label: 'NIP-89' },
  ]}
  difficulty="intermediate"
  readingTime="10 åˆ†é˜"
  tags={['Nostr', 'NIP-89', 'æ‡‰ç”¨', 'handlers', 'discovery']}
  prevPage={{ title: 'NIP-84 ç²¾é¸æ¨™è¨˜', href: '/tech/nostr/nip-84' }}
  nextPage={{ title: 'NIP-90 è³‡æ–™è²©è³£æ©Ÿ', href: '/tech/nostr/nip-90' }}
>
  <!-- Breadcrumb -->
  <nav class="flex items-center gap-2 text-sm text-[var(--text-tertiary)] mb-8 flex-wrap">
    <a href="/" class="hover:text-[var(--text-secondary)] transition-colors">é¦–é </a>
    <span>/</span>
    <a href="/tech" class="hover:text-[var(--text-secondary)] transition-colors">æŠ€è¡“</a>
    <span>/</span>
    <a href="/tech/nostr" class="hover:text-[var(--text-secondary)] transition-colors">Nostr</a>
    <span>/</span>
    <span class="text-[var(--text-primary)]">NIP-89</span>
  </nav>

  <!-- Introduction -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ¦‚è¿°</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      NIP-89 å®šç¾©äº†æ‡‰ç”¨æ¨è–¦ç³»çµ±ï¼Œè®“ç”¨æˆ¶å¯ä»¥æ¨è–¦è™•ç†ç‰¹å®šäº‹ä»¶é¡å‹çš„æ‡‰ç”¨ç¨‹å¼ï¼Œ
      åŒæ™‚è®“æ‡‰ç”¨é–‹ç™¼è€…å¯ä»¥è²æ˜ä»–å€‘çš„æ‡‰ç”¨æ”¯æ´å“ªäº›äº‹ä»¶é¡å‹ã€‚é€™å»ºç«‹äº†ä¸€å€‹å»ä¸­å¿ƒåŒ–çš„æ‡‰ç”¨ç™¼ç¾æ©Ÿåˆ¶ã€‚
    </p>
    <div class="p-4 rounded-lg bg-purple-500/10 border border-purple-500/20">
      <p class="text-[var(--text-secondary)]">
        <strong class="text-purple-400">æ ¸å¿ƒæ¦‚å¿µï¼š</strong>
        NIP-89 ä½¿ç”¨å…©ç¨®äº‹ä»¶é¡å‹ï¼škind 31990ï¼ˆæ‡‰ç”¨è³‡è¨Šï¼‰ç”±é–‹ç™¼è€…ç™¼å¸ƒï¼Œè²æ˜æ”¯æ´çš„äº‹ä»¶é¡å‹ï¼›
        kind 31989ï¼ˆæ¨è–¦ï¼‰ç”±ç”¨æˆ¶ç™¼å¸ƒï¼Œæ¨è–¦è™•ç†ç‰¹å®šäº‹ä»¶çš„æ‡‰ç”¨ã€‚
      </p>
    </div>
  </section>

  <!-- Event Kinds -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">äº‹ä»¶é¡å‹</h2>
    <div class="overflow-x-auto">
      <table class="w-full border-collapse mb-4">
        <thead>
          <tr class="border-b border-[var(--border-default)]">
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">Kind</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">åç¨±</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">ç™¼å¸ƒè€…</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">èªªæ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">31990</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">Handler Information</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ‡‰ç”¨é–‹ç™¼è€…</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">è²æ˜æ‡‰ç”¨æ”¯æ´çš„äº‹ä»¶é¡å‹å’Œè™•ç†æ–¹å¼</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">31989</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">Recommendation</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">ç”¨æˆ¶</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ¨è–¦è™•ç†ç‰¹å®šäº‹ä»¶é¡å‹çš„æ‡‰ç”¨</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Handler Information -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ‡‰ç”¨è³‡è¨Šäº‹ä»¶ï¼ˆKind 31990ï¼‰</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      æ‡‰ç”¨é–‹ç™¼è€…ç™¼å¸ƒæ­¤äº‹ä»¶ï¼Œè²æ˜æ‡‰ç”¨å¯ä»¥è™•ç†å“ªäº›äº‹ä»¶é¡å‹ï¼š
    </p>
    <div class="overflow-x-auto">
      <table class="w-full border-collapse mb-4">
        <thead>
          <tr class="border-b border-[var(--border-default)]">
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">æ¨™ç±¤</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">æ ¼å¼</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">èªªæ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">d</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["d", "&lt;identifier&gt;"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">éš¨æ©Ÿå”¯ä¸€æ¨™è­˜ç¬¦</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">k</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["k", "1"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ”¯æ´çš„äº‹ä»¶ kindï¼ˆå¯å¤šå€‹ï¼‰</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">web</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["web", "https://app.com/&lt;bech32&gt;"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">ç¶²é ç‰ˆ URL æ¨¡æ¿</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">ios</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["ios", "app://open/&lt;bech32&gt;"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">iOS æ‡‰ç”¨ URL scheme</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">android</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["android", "intent://..."]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">Android intent URL</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="p-4 rounded-lg bg-blue-500/10 border border-blue-500/20">
      <p class="text-[var(--text-secondary)]">
        <strong class="text-blue-400">URL æ¨¡æ¿ï¼š</strong>
        ä½¿ç”¨ <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">&lt;bech32&gt;</code>
        ä½œç‚ºä½”ä½ç¬¦ï¼Œå®¢æˆ¶ç«¯æœƒå°‡å…¶æ›¿æ›ç‚ºå¯¦éš›çš„ NIP-19 ç·¨ç¢¼ï¼ˆå¦‚ neventã€naddrã€npub ç­‰ï¼‰ã€‚
      </p>
    </div>
  </section>

  <!-- Recommendation Event -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ¨è–¦äº‹ä»¶ï¼ˆKind 31989ï¼‰</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      ç”¨æˆ¶ç™¼å¸ƒæ­¤äº‹ä»¶ï¼Œæ¨è–¦è™•ç†ç‰¹å®šäº‹ä»¶é¡å‹çš„æ‡‰ç”¨ï¼š
    </p>
    <div class="overflow-x-auto">
      <table class="w-full border-collapse mb-4">
        <thead>
          <tr class="border-b border-[var(--border-default)]">
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">æ¨™ç±¤</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">æ ¼å¼</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">èªªæ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">d</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["d", "31923"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ¨è–¦è™•ç†çš„äº‹ä»¶ kind</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">a</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["a", "31990:pubkey:d", "relay", "platform"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æŒ‡å‘æ¨è–¦çš„æ‡‰ç”¨ï¼ˆå¯å¤šå€‹ï¼‰</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="grid md:grid-cols-3 gap-4 mt-4">
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">web</h4>
        <p class="text-sm text-[var(--text-secondary)]">ç¶²é ç‰ˆæ‡‰ç”¨</p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ios</h4>
        <p class="text-sm text-[var(--text-secondary)]">iOS æ‡‰ç”¨</p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">android</h4>
        <p class="text-sm text-[var(--text-secondary)]">Android æ‡‰ç”¨</p>
      </div>
    </div>
  </section>

  <!-- Examples -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ä½¿ç”¨ç¯„ä¾‹</h2>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">æ‡‰ç”¨è²æ˜æ”¯æ´çš„äº‹ä»¶é¡å‹</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 31990,
  "tags": [
    ["d", "calendar-app-v1"],
    ["k", "31922"],
    ["k", "31923"],
    ["k", "31925"],
    ["web", "https://calendar.nostr.app/<bech32>"],
    ["web", "https://calendar.nostr.app/<bech32>", "nevent"],
    ["web", "https://calendar.nostr.app/<bech32>", "naddr"],
    ["ios", "nostrcalendar://open/<bech32>"],
    ["android", "intent://open/<bech32>#Intent;scheme=nostrcalendar;end"]
  ],
  "content": "{\\"name\\":\\"Nostr Calendar\\",\\"display_name\\":\\"Nostr æ—¥æ›†\\",\\"picture\\":\\"https://calendar.nostr.app/icon.png\\",\\"about\\":\\"ç®¡ç†ä½ çš„ Nostr æ—¥æ›†æ´»å‹•\\"}"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">é•·æ–‡é–±è®€å™¨æ‡‰ç”¨</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 31990,
  "tags": [
    ["d", "habla-reader"],
    ["k", "30023"],
    ["web", "https://habla.news/a/<bech32>", "naddr"],
    ["web", "https://habla.news/<bech32>"]
  ],
  "content": "{\\"name\\":\\"Habla\\",\\"display_name\\":\\"Habla\\",\\"picture\\":\\"https://habla.news/logo.png\\",\\"about\\":\\"Nostr é•·æ–‡é–±è®€èˆ‡å¯«ä½œå¹³å°\\"}"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">ç”¨æˆ¶æ¨è–¦æ—¥æ›†æ‡‰ç”¨</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 31989,
  "tags": [
    ["d", "31923"],
    ["a", "31990:<app-pubkey>:calendar-app-v1", "wss://relay.example.com", "web"]
  ],
  "content": "æ¨è–¦ä½¿ç”¨é€™å€‹æ—¥æ›†æ‡‰ç”¨è™•ç†æ´»å‹•äº‹ä»¶"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">æ¨è–¦å¤šå€‹æ‡‰ç”¨</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 31989,
  "tags": [
    ["d", "30023"],
    ["a", "31990:<habla-pubkey>:habla-reader", "wss://relay.example.com", "web"],
    ["a", "31990:<yakihonne-pubkey>:yakihonne", "wss://relay.example.com", "web"],
    ["a", "31990:<blogstack-pubkey>:blogstack", "wss://relay.example.com", "web"]
  ],
  "content": "æˆ‘æ¨è–¦çš„é•·æ–‡é–±è®€æ‡‰ç”¨"
}`}</code></pre>
  </section>

  <!-- TypeScript Implementation -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">TypeScript å¯¦ä½œ</h2>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`import { finalizeEvent, generateSecretKey, getPublicKey, nip19 } from 'nostr-tools'

type Platform = 'web' | 'ios' | 'android'

interface HandlerUrl {
  platform: Platform
  url: string
  nip19Type?: string  // nevent, naddr, npub, etc.
}

interface AppMetadata {
  name: string
  display_name?: string
  picture?: string
  about?: string
}

interface HandlerOptions {
  identifier: string
  supportedKinds: number[]
  handlers: HandlerUrl[]
  metadata?: AppMetadata
}

// å‰µå»ºæ‡‰ç”¨è³‡è¨Šäº‹ä»¶ï¼ˆé–‹ç™¼è€…ç”¨ï¼‰
function createHandlerEvent(
  options: HandlerOptions,
  secretKey: Uint8Array
): object {
  const tags: string[][] = [
    ['d', options.identifier],
  ]

  // æ·»åŠ æ”¯æ´çš„ kinds
  for (const kind of options.supportedKinds) {
    tags.push(['k', kind.toString()])
  }

  // æ·»åŠ è™•ç†å™¨ URLs
  for (const handler of options.handlers) {
    const tag = [handler.platform, handler.url]
    if (handler.nip19Type) {
      tag.push(handler.nip19Type)
    }
    tags.push(tag)
  }

  const event = {
    kind: 31990,
    created_at: Math.floor(Date.now() / 1000),
    tags,
    content: options.metadata ? JSON.stringify(options.metadata) : '',
  }

  return finalizeEvent(event, secretKey)
}

// å‰µå»ºæ¨è–¦äº‹ä»¶ï¼ˆç”¨æˆ¶ç”¨ï¼‰
function createRecommendation(
  eventKind: number,
  recommendations: { pubkey: string; identifier: string; relay?: string; platform?: Platform }[],
  secretKey: Uint8Array,
  comment?: string
): object {
  const tags: string[][] = [
    ['d', eventKind.toString()],
  ]

  for (const rec of recommendations) {
    const aTag = \`31990:\${rec.pubkey}:\${rec.identifier}\`
    const tag = ['a', aTag]
    if (rec.relay) tag.push(rec.relay)
    else if (rec.platform) tag.push('')
    if (rec.platform) tag.push(rec.platform)
    tags.push(tag)
  }

  const event = {
    kind: 31989,
    created_at: Math.floor(Date.now() / 1000),
    tags,
    content: comment || '',
  }

  return finalizeEvent(event, secretKey)
}

// ç”Ÿæˆè™•ç† URL
function buildHandlerUrl(
  template: string,
  eventId: string,
  eventPubkey: string,
  eventKind: number,
  relays: string[] = []
): string {
  // æ ¹æ“š kind é¸æ“‡é©ç•¶çš„ NIP-19 ç·¨ç¢¼
  let bech32: string

  if (eventKind >= 30000 && eventKind < 40000) {
    // å¯å®šå€äº‹ä»¶ä½¿ç”¨ naddr
    bech32 = nip19.naddrEncode({
      kind: eventKind,
      pubkey: eventPubkey,
      identifier: eventId,
      relays,
    })
  } else {
    // ä¸€èˆ¬äº‹ä»¶ä½¿ç”¨ nevent
    bech32 = nip19.neventEncode({
      id: eventId,
      author: eventPubkey,
      relays,
    })
  }

  return template.replace('<bech32>', bech32)
}

// ä½¿ç”¨ç¯„ä¾‹ - é–‹ç™¼è€…ç™¼å¸ƒæ‡‰ç”¨è³‡è¨Š
const appSk = generateSecretKey()
const appPk = getPublicKey(appSk)

const handlerEvent = createHandlerEvent({
  identifier: 'my-calendar-app',
  supportedKinds: [31922, 31923, 31925],
  handlers: [
    { platform: 'web', url: 'https://mycalendar.app/<bech32>' },
    { platform: 'web', url: 'https://mycalendar.app/event/<bech32>', nip19Type: 'nevent' },
    { platform: 'ios', url: 'mycalendar://open/<bech32>' },
  ],
  metadata: {
    name: 'MyCalendar',
    display_name: 'æˆ‘çš„æ—¥æ›†',
    picture: 'https://mycalendar.app/icon.png',
    about: 'ä¸€å€‹ç°¡å–®çš„ Nostr æ—¥æ›†æ‡‰ç”¨',
  },
}, appSk)

// ä½¿ç”¨ç¯„ä¾‹ - ç”¨æˆ¶æ¨è–¦æ‡‰ç”¨
const userSk = generateSecretKey()

const recommendation = createRecommendation(
  31923,  // æ¨è–¦è™•ç†æ™‚é–“æ´»å‹•çš„æ‡‰ç”¨
  [
    { pubkey: appPk, identifier: 'my-calendar-app', relay: 'wss://relay.example.com', platform: 'web' }
  ],
  userSk,
  'é€™å€‹æ—¥æ›†æ‡‰ç”¨éå¸¸å¥½ç”¨ï¼'
)

console.log('Handler event:', handlerEvent)
console.log('Recommendation:', recommendation)`}</code></pre>
  </section>

  <!-- Query Handlers -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æŸ¥è©¢æ‡‰ç”¨è™•ç†å™¨</h2>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`import { SimplePool } from 'nostr-tools'

const pool = new SimplePool()
const relays = ['wss://relay.example.com']

// æŸ¥è©¢æ”¯æ´ç‰¹å®šäº‹ä»¶é¡å‹çš„æ‡‰ç”¨
async function getHandlersForKind(kind: number) {
  const handlers = await pool.querySync(relays, {
    kinds: [31990],
    '#k': [kind.toString()],
  })
  return handlers
}

// æŸ¥è©¢ç”¨æˆ¶æ¨è–¦çš„æ‡‰ç”¨
async function getRecommendationsForKind(kind: number) {
  const recommendations = await pool.querySync(relays, {
    kinds: [31989],
    '#d': [kind.toString()],
  })
  return recommendations
}

// æŸ¥è©¢é—œæ³¨è€…æ¨è–¦çš„æ‡‰ç”¨
async function getFollowingRecommendations(
  kind: number,
  followingPubkeys: string[]
) {
  const recommendations = await pool.querySync(relays, {
    kinds: [31989],
    authors: followingPubkeys,
    '#d': [kind.toString()],
  })
  return recommendations
}

// è§£ææ‡‰ç”¨è™•ç†å™¨
function parseHandler(event: any) {
  const identifier = event.tags.find((t: string[]) => t[0] === 'd')?.[1]

  const supportedKinds = event.tags
    .filter((t: string[]) => t[0] === 'k')
    .map((t: string[]) => parseInt(t[1]))

  const handlers: { platform: string; url: string; nip19Type?: string }[] = []
  for (const tag of event.tags) {
    if (['web', 'ios', 'android'].includes(tag[0])) {
      handlers.push({
        platform: tag[0],
        url: tag[1],
        nip19Type: tag[2],
      })
    }
  }

  // è§£æ metadata
  let metadata = null
  if (event.content) {
    try {
      metadata = JSON.parse(event.content)
    } catch {}
  }

  return {
    pubkey: event.pubkey,
    identifier,
    supportedKinds,
    handlers,
    metadata,
  }
}

// è§£ææ¨è–¦
function parseRecommendation(event: any) {
  const targetKind = event.tags.find((t: string[]) => t[0] === 'd')?.[1]

  const recommendations = event.tags
    .filter((t: string[]) => t[0] === 'a')
    .map((t: string[]) => {
      const [kind, pubkey, identifier] = t[1].split(':')
      return {
        handlerKind: parseInt(kind),
        pubkey,
        identifier,
        relay: t[2] || undefined,
        platform: t[3] || undefined,
      }
    })

  return {
    recommenderPubkey: event.pubkey,
    targetKind: parseInt(targetKind),
    recommendations,
    comment: event.content,
  }
}

// é¸æ“‡æœ€ä½³è™•ç†å™¨
function selectBestHandler(
  handlers: ReturnType<typeof parseHandler>[],
  platform: 'web' | 'ios' | 'android',
  nip19Type?: string
) {
  for (const handler of handlers) {
    const matchingHandler = handler.handlers.find(h => {
      if (h.platform !== platform) return false
      if (nip19Type && h.nip19Type && h.nip19Type !== nip19Type) return false
      return true
    })
    if (matchingHandler) {
      return { handler, url: matchingHandler.url }
    }
  }
  return null
}

// ä½¿ç”¨ç¯„ä¾‹
const calendarHandlers = await getHandlersForKind(31923)
console.log('æ—¥æ›†æ‡‰ç”¨:', calendarHandlers.map(h => parseHandler(h)))

// å¾é—œæ³¨è€…ç²å–æ¨è–¦
const myFollowing = ['pubkey1', 'pubkey2']
const recommendations = await getFollowingRecommendations(31923, myFollowing)
console.log('é—œæ³¨è€…æ¨è–¦:', recommendations.map(r => parseRecommendation(r)))`}</code></pre>
  </section>

  <!-- Use Cases -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ‡‰ç”¨å ´æ™¯</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ“± æ‡‰ç”¨ç™¼ç¾</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ç”¨æˆ¶å¯ä»¥ç™¼ç¾è™•ç†ç‰¹å®šäº‹ä»¶é¡å‹çš„æ‡‰ç”¨ï¼Œå¦‚æ—¥æ›†ã€é•·æ–‡é–±è®€å™¨ã€éŸ³æ¨‚æ’­æ”¾å™¨ç­‰ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ”— æ·±åº¦é€£çµ</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          å®¢æˆ¶ç«¯å¯ä»¥ä½¿ç”¨æ­£ç¢ºçš„æ‡‰ç”¨æ‰“é–‹ç‰¹å®šäº‹ä»¶ï¼Œæä¾›ç„¡ç¸«é«”é©—ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">â­ ç¤¾äº¤æ¨è–¦</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          åŸºæ–¼é—œæ³¨è€…çš„æ¨è–¦ï¼Œç™¼ç¾æœ‹å‹å€‘ä½¿ç”¨çš„æ‡‰ç”¨ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸŒ è·¨å¹³å°æ”¯æ´</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          æ”¯æ´ Webã€iOSã€Androidï¼Œæ ¹æ“šç”¨æˆ¶å¹³å°é¸æ“‡åˆé©çš„è™•ç†æ–¹å¼ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ¯ å°ˆæ¥­æ‡‰ç”¨</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ç‰¹å®šäº‹ä»¶é¡å‹å¯ä»¥ç”±å°ˆé–€çš„æ‡‰ç”¨è™•ç†ï¼Œå¦‚ç›´æ’­ã€éŸ³æ¨‚ã€éŠæˆ²ç­‰ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ“¢ æ‡‰ç”¨æ¨å»£</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          é–‹ç™¼è€…å¯ä»¥é€éç™¼å¸ƒ handler äº‹ä»¶è®“æ‡‰ç”¨è¢«ç™¼ç¾ã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- Workflow -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">å·¥ä½œæµç¨‹</h2>
    <div class="space-y-4">
      <div class="flex items-start gap-4 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-500 text-white flex items-center justify-center font-bold">1</div>
        <div>
          <h4 class="font-semibold text-[var(--text-primary)]">é–‹ç™¼è€…ç™¼å¸ƒæ‡‰ç”¨è³‡è¨Š</h4>
          <p class="text-sm text-[var(--text-secondary)]">ç™¼å¸ƒ kind 31990 äº‹ä»¶ï¼Œè²æ˜æ”¯æ´çš„ kinds å’Œè™•ç† URL</p>
        </div>
      </div>
      <div class="flex items-start gap-4 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-500 text-white flex items-center justify-center font-bold">2</div>
        <div>
          <h4 class="font-semibold text-[var(--text-primary)]">ç”¨æˆ¶ç™¼ç¾ä¸¦è©¦ç”¨æ‡‰ç”¨</h4>
          <p class="text-sm text-[var(--text-secondary)]">å®¢æˆ¶ç«¯æŸ¥è©¢å¯ç”¨çš„ handlers ä¸¦å±•ç¤ºçµ¦ç”¨æˆ¶</p>
        </div>
      </div>
      <div class="flex items-start gap-4 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-500 text-white flex items-center justify-center font-bold">3</div>
        <div>
          <h4 class="font-semibold text-[var(--text-primary)]">ç”¨æˆ¶æ¨è–¦æ‡‰ç”¨</h4>
          <p class="text-sm text-[var(--text-secondary)]">ç™¼å¸ƒ kind 31989 äº‹ä»¶æ¨è–¦å–œæ­¡çš„æ‡‰ç”¨</p>
        </div>
      </div>
      <div class="flex items-start gap-4 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <div class="flex-shrink-0 w-8 h-8 rounded-full bg-purple-500 text-white flex items-center justify-center font-bold">4</div>
        <div>
          <h4 class="font-semibold text-[var(--text-primary)]">å…¶ä»–ç”¨æˆ¶åƒè€ƒæ¨è–¦</h4>
          <p class="text-sm text-[var(--text-secondary)]">æŸ¥è©¢é—œæ³¨è€…çš„æ¨è–¦ï¼Œå„ªå…ˆé¸æ“‡è¢«æ¨è–¦çš„æ‡‰ç”¨</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Best Practices -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æœ€ä½³å¯¦è¸</h2>
    <div class="space-y-4">
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ æä¾›å®Œæ•´çš„ metadata</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          åœ¨ content ä¸­æä¾› nameã€pictureã€about ç­‰è³‡è¨Šï¼Œæ–¹ä¾¿ç”¨æˆ¶äº†è§£æ‡‰ç”¨ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ æ”¯æ´å¤šç¨® NIP-19 é¡å‹</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ç‚ºä¸åŒçš„ NIP-19 é¡å‹ï¼ˆneventã€naddr ç­‰ï¼‰æä¾›å°ˆé–€çš„ URL æ¨¡æ¿ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ å¤šå¹³å°æ”¯æ´</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ç›¡å¯èƒ½æä¾› webã€iosã€android å¤šå€‹å¹³å°çš„è™•ç† URLã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/20">
        <h4 class="font-semibold text-yellow-400 mb-2">âš  ç„¡ metadata æ™‚ä½¿ç”¨ kind:0</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          å¦‚æœ content ç‚ºç©ºï¼Œå®¢æˆ¶ç«¯æ‡‰ä½¿ç”¨æ‡‰ç”¨ pubkey çš„ kind:0 äº‹ä»¶ç²å–è³‡è¨Šã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- Related NIPs -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ç›¸é—œ NIP</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <a
        href="/tech/nostr/nip-19"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-19 bech32 ç·¨ç¢¼</h4>
        <p class="text-sm text-[var(--text-secondary)]">URL æ¨¡æ¿ä¸­çš„ bech32 ä½”ä½ç¬¦</p>
      </a>
      <a
        href="/tech/nostr/nip-52"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-52 æ—¥æ›†æ´»å‹•</h4>
        <p class="text-sm text-[var(--text-secondary)]">æ—¥æ›†æ‡‰ç”¨è™•ç†å™¨ç¯„ä¾‹</p>
      </a>
      <a
        href="/tech/nostr/nip-23"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-23 é•·æ–‡å…§å®¹</h4>
        <p class="text-sm text-[var(--text-secondary)]">é•·æ–‡é–±è®€å™¨è™•ç†å™¨ç¯„ä¾‹</p>
      </a>
      <a
        href="/tech/nostr/nip-01"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-01 åŸºæœ¬å”è­°</h4>
        <p class="text-sm text-[var(--text-secondary)]">å¯å®šå€äº‹ä»¶çš„åŸºç¤</p>
      </a>
    </div>
  </section>

  <!-- Summary -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ç¸½çµ</h2>
    <div class="p-6 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
      <p class="text-[var(--text-secondary)] mb-4">
        NIP-89 å»ºç«‹äº†ä¸€å€‹å»ä¸­å¿ƒåŒ–çš„æ‡‰ç”¨ç™¼ç¾å’Œæ¨è–¦ç³»çµ±ã€‚é–‹ç™¼è€…å¯ä»¥è²æ˜æ‡‰ç”¨æ”¯æ´çš„äº‹ä»¶é¡å‹ï¼Œ
        ç”¨æˆ¶å¯ä»¥æ¨è–¦å–œæ­¡çš„æ‡‰ç”¨ï¼Œå®¢æˆ¶ç«¯å¯ä»¥æ ¹æ“šäº‹ä»¶é¡å‹é¸æ“‡åˆé©çš„è™•ç†æ–¹å¼ï¼Œ
        å¯¦ç¾äº† Nostr ç”Ÿæ…‹ç³»çµ±ä¸­æ‡‰ç”¨çš„äº’æ“ä½œæ€§ã€‚
      </p>
      <div class="grid md:grid-cols-4 gap-4 text-center">
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-purple-400">31990</div>
          <div class="text-sm text-[var(--text-secondary)]">æ‡‰ç”¨è³‡è¨Š</div>
        </div>
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-blue-400">31989</div>
          <div class="text-sm text-[var(--text-secondary)]">ç”¨æˆ¶æ¨è–¦</div>
        </div>
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-green-400">k æ¨™ç±¤</div>
          <div class="text-sm text-[var(--text-secondary)]">æ”¯æ´çš„ kinds</div>
        </div>
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-orange-400">3 å¹³å°</div>
          <div class="text-sm text-[var(--text-secondary)]">web/ios/android</div>
        </div>
      </div>
    </div>
  </section>
</ArticleLayout>
