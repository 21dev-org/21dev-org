---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
import { defined } from '@/utils/types';
---

<ArticleLayout
  title="NIP-32: æ¨™ç±¤ç³»çµ±"
  subtitle="Labeling - ç‚ºå…§å®¹æ·»åŠ çµæ§‹åŒ–åˆ†é¡æ¨™ç±¤"
  difficulty="intermediate"
  readingTime={12}
  tags={['Nostr', 'NIP-32', 'æ¨™ç±¤', 'labeling', 'taxonomy']}
  prevPage={defined({ href: '/tech/nostr/nip-30', label: 'NIP-30 è‡ªè¨‚è¡¨æƒ…' })}
  nextPage={defined({ href: '/tech/nostr/nip-36', label: 'NIP-36 æ•æ„Ÿå…§å®¹' })}
>
  <!-- Breadcrumb -->
  <nav class="flex items-center gap-2 text-sm text-[var(--text-tertiary)] mb-8 flex-wrap">
    <a href="/" class="hover:text-[var(--text-secondary)] transition-colors">é¦–é </a>
    <span>/</span>
    <a href="/tech" class="hover:text-[var(--text-secondary)] transition-colors">æŠ€è¡“</a>
    <span>/</span>
    <a href="/tech/nostr" class="hover:text-[var(--text-secondary)] transition-colors">Nostr</a>
    <span>/</span>
    <span class="text-[var(--text-primary)]">NIP-32</span>
  </nav>

  <!-- Introduction -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ¦‚è¿°</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      NIP-32 å®šç¾©äº†ä¸€å¥—æ¨™ç±¤ç³»çµ±ï¼Œå…è¨±ç”¨æˆ¶ç‚ºäº‹ä»¶ã€äººç‰©ã€ä¸­ç¹¼å™¨ã€åœ°å€å’Œä¸»é¡Œæ·»åŠ çµæ§‹åŒ–çš„åˆ†é¡æ¨™ç±¤ã€‚
      é€™å€‹ç³»çµ±æ”¯æ´å¤šç¨®å‘½åç©ºé–“ï¼Œè®“ä¸åŒçš„æ‡‰ç”¨å ´æ™¯ï¼ˆå¦‚å…§å®¹å¯©æ ¸ã€åˆ†é¡ã€è©•ç´šç­‰ï¼‰å¯ä»¥ä½¿ç”¨çµ±ä¸€çš„æ¨™ç±¤æ©Ÿåˆ¶ã€‚
    </p>
    <div class="p-4 rounded-lg bg-purple-500/10 border border-purple-500/20">
      <p class="text-[var(--text-secondary)]">
        <strong class="text-purple-400">æ ¸å¿ƒæ¦‚å¿µï¼š</strong>
        æ¨™ç±¤ç³»çµ±ä½¿ç”¨ kind 1985 äº‹ä»¶é¡å‹ï¼Œé€é <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">L</code>ï¼ˆå‘½åç©ºé–“ï¼‰
        å’Œ <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">l</code>ï¼ˆæ¨™ç±¤å€¼ï¼‰æ¨™ç±¤å°å…§å®¹é€²è¡Œåˆ†é¡ã€‚
      </p>
    </div>
  </section>

  <!-- Label Event Structure -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ¨™ç±¤äº‹ä»¶çµæ§‹</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      æ¨™ç±¤äº‹ä»¶ä½¿ç”¨ kind 1985ï¼ŒåŒ…å«å‘½åç©ºé–“å’Œæ¨™ç±¤å€¼ï¼š
    </p>
    <div class="overflow-x-auto">
      <table class="w-full border-collapse mb-4">
        <thead>
          <tr class="border-b border-[var(--border-default)]">
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">æ¨™ç±¤</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">æ ¼å¼</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">èªªæ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">L</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["L", "&lt;namespace&gt;"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ¨™ç±¤å‘½åç©ºé–“ï¼ˆLabel Namespaceï¼‰</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">l</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["l", "&lt;label&gt;", "&lt;namespace&gt;"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ¨™ç±¤å€¼ï¼Œç¬¬ä¸‰å€‹å…ƒç´ å°æ‡‰ L æ¨™ç±¤</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">e</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["e", "&lt;event-id&gt;", "&lt;relay-hint&gt;"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ¨™ç±¤ç›®æ¨™äº‹ä»¶</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">p</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["p", "&lt;pubkey&gt;", "&lt;relay-hint&gt;"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ¨™ç±¤ç›®æ¨™ç”¨æˆ¶</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">r</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["r", "&lt;relay-url&gt;"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ¨™ç±¤ç›®æ¨™ä¸­ç¹¼å™¨</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">a</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["a", "&lt;naddr&gt;"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ¨™ç±¤å¯æ›¿æ›äº‹ä»¶åœ°å€</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">t</td>
            <td class="py-3 px-4 font-mono text-sm text-[var(--text-secondary)]">["t", "&lt;topic&gt;"]</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ¨™ç±¤ä¸»é¡Œæ¨™ç±¤</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Namespaces -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">å‘½åç©ºé–“</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      å‘½åç©ºé–“ç”¨æ–¼å€åˆ†ä¸åŒä¾†æºå’Œç”¨é€”çš„æ¨™ç±¤ã€‚å»ºè­°ä½¿ç”¨æ˜ç¢ºçš„æ¨™è­˜ç¬¦ï¼š
    </p>

    <div class="grid md:grid-cols-2 gap-4 mb-6">
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ugcï¼ˆç”¨æˆ¶ç”Ÿæˆå…§å®¹ï¼‰</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ä¿ç•™å‘½åç©ºé–“ï¼Œç”¨æ–¼ç”¨æˆ¶è‡ªå®šç¾©æ¨™ç±¤ã€‚ç•¶ l æ¨™ç±¤æ²’æœ‰æŒ‡å®šå‘½åç©ºé–“æ™‚ï¼Œé»˜èªä½¿ç”¨ ugcã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ISO æ¨™æº–</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          å¯ä½¿ç”¨ ISO æ¨™æº–ä½œç‚ºå‘½åç©ºé–“ï¼Œå¦‚ <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">ISO-639-1</code> è¡¨ç¤ºèªè¨€ä»£ç¢¼ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">åå‘åŸŸåæ¨™è¨˜</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          æ¨è–¦ä½¿ç”¨åå‘åŸŸåæ¨™è¨˜ï¼Œå¦‚ <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">com.example.ontology</code>ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2"># å‰ç¶´</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ä»¥ <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">#</code> é–‹é ­è¡¨ç¤ºæ¨™æº– Nostr æ¨™ç±¤é—œè¯ï¼Œå¦‚ <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">#t</code> è¡¨ç¤ºä¸»é¡Œæ¨™ç±¤ã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- Examples -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ä½¿ç”¨ç¯„ä¾‹</h2>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">æ¨™è¨˜äº‹ä»¶èªè¨€</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 1985,
  "tags": [
    ["L", "ISO-639-1"],
    ["l", "zh", "ISO-639-1"],
    ["e", "<event-id>", "wss://relay.example.com"]
  ],
  "content": ""
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">å…§å®¹åˆ†é¡æ¨™ç±¤</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 1985,
  "tags": [
    ["L", "com.example.content-type"],
    ["l", "news", "com.example.content-type"],
    ["l", "technology", "com.example.content-type"],
    ["e", "<event-id>", "wss://relay.example.com"]
  ],
  "content": "é€™æ˜¯ä¸€ç¯‡ç§‘æŠ€æ–°èç›¸é—œçš„è²¼æ–‡"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">ç”¨æˆ¶ç”Ÿæˆæ¨™ç±¤ï¼ˆUGCï¼‰</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 1985,
  "tags": [
    ["L", "ugc"],
    ["l", "æœ‰è¶£", "ugc"],
    ["l", "æ¨è–¦", "ugc"],
    ["e", "<event-id>", "wss://relay.example.com"]
  ],
  "content": ""
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">æ¨™è¨˜ç”¨æˆ¶ï¼ˆèº«ä»½æ¨™ç±¤ï¼‰</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 1985,
  "tags": [
    ["L", "com.example.trust"],
    ["l", "verified", "com.example.trust"],
    ["p", "<pubkey>", "wss://relay.example.com"]
  ],
  "content": "æ­¤ç”¨æˆ¶å·²é€šéèº«ä»½é©—è­‰"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">æ¨™è¨˜ä¸­ç¹¼å™¨</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 1985,
  "tags": [
    ["L", "com.example.relay-type"],
    ["l", "paid", "com.example.relay-type"],
    ["l", "fast", "com.example.relay-type"],
    ["r", "wss://premium.relay.example.com"]
  ],
  "content": ""
}`}</code></pre>
  </section>

  <!-- Self-Reporting -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">è‡ªæˆ‘æ¨™è¨˜</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      é™¤äº†ä½¿ç”¨ kind 1985 æ¨™ç±¤äº‹ä»¶å¤–ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä»–äº‹ä»¶ä¸­ç›´æ¥æ·»åŠ  L å’Œ l æ¨™ç±¤é€²è¡Œè‡ªæˆ‘æ¨™è¨˜ï¼š
    </p>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`// è‡ªæˆ‘æ¨™è¨˜çš„è²¼æ–‡ï¼ˆkind 1ï¼‰
{
  "kind": 1,
  "tags": [
    ["L", "ISO-639-1"],
    ["l", "en", "ISO-639-1"],
    ["L", "#t"],
    ["l", "bitcoin", "#t"],
    ["t", "bitcoin"]
  ],
  "content": "Bitcoin is the future of money!"
}`}</code></pre>
    <div class="p-4 rounded-lg bg-blue-500/10 border border-blue-500/20">
      <p class="text-[var(--text-secondary)]">
        <strong class="text-blue-400">æ³¨æ„ï¼š</strong>
        è‡ªæˆ‘æ¨™è¨˜è®“äº‹ä»¶ç™¼å¸ƒè€…å¯ä»¥é å…ˆåˆ†é¡è‡ªå·±çš„å…§å®¹ï¼Œæ–¹ä¾¿å®¢æˆ¶ç«¯éæ¿¾å’Œæœå°‹ã€‚
        <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">#t</code>
        å‘½åç©ºé–“è¡¨ç¤ºé€™å€‹æ¨™ç±¤èˆ‡ tï¼ˆä¸»é¡Œï¼‰æ¨™ç±¤é—œè¯ã€‚
      </p>
    </div>
  </section>

  <!-- TypeScript Implementation -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">TypeScript å¯¦ä½œ</h2>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`import { finalizeEvent, generateSecretKey, getPublicKey } from 'nostr-tools'

// æ¨™ç±¤å‘½åç©ºé–“å¸¸é‡
const NAMESPACES = {
  UGC: 'ugc',
  LANGUAGE: 'ISO-639-1',
  CONTENT_TYPE: 'com.example.content-type',
  TRUST: 'com.example.trust',
} as const

interface LabelTarget {
  type: 'event' | 'pubkey' | 'relay' | 'address' | 'topic'
  value: string
  relayHint?: string
}

interface LabelData {
  namespace: string
  labels: string[]
  target: LabelTarget
  content?: string
}

// å‰µå»ºæ¨™ç±¤äº‹ä»¶
function createLabelEvent(
  data: LabelData,
  secretKey: Uint8Array
): object {
  const tags: string[][] = []

  // æ·»åŠ å‘½åç©ºé–“
  tags.push(['L', data.namespace])

  // æ·»åŠ æ¨™ç±¤å€¼
  for (const label of data.labels) {
    tags.push(['l', label, data.namespace])
  }

  // æ·»åŠ ç›®æ¨™
  switch (data.target.type) {
    case 'event':
      tags.push(['e', data.target.value, data.target.relayHint || ''])
      break
    case 'pubkey':
      tags.push(['p', data.target.value, data.target.relayHint || ''])
      break
    case 'relay':
      tags.push(['r', data.target.value])
      break
    case 'address':
      tags.push(['a', data.target.value])
      break
    case 'topic':
      tags.push(['t', data.target.value])
      break
  }

  const event = {
    kind: 1985,
    created_at: Math.floor(Date.now() / 1000),
    tags,
    content: data.content || '',
  }

  return finalizeEvent(event, secretKey)
}

// æ¨™è¨˜äº‹ä»¶èªè¨€
function labelEventLanguage(
  eventId: string,
  languageCode: string,
  relayHint: string,
  secretKey: Uint8Array
): object {
  return createLabelEvent({
    namespace: NAMESPACES.LANGUAGE,
    labels: [languageCode],
    target: {
      type: 'event',
      value: eventId,
      relayHint,
    },
  }, secretKey)
}

// æ¨™è¨˜ç”¨æˆ¶ä¿¡ä»»ç­‰ç´š
function labelUserTrust(
  pubkey: string,
  trustLevel: string,
  relayHint: string,
  secretKey: Uint8Array
): object {
  return createLabelEvent({
    namespace: NAMESPACES.TRUST,
    labels: [trustLevel],
    target: {
      type: 'pubkey',
      value: pubkey,
      relayHint,
    },
  }, secretKey)
}

// ç”¨æˆ¶ç”Ÿæˆæ¨™ç±¤
function createUGCLabel(
  eventId: string,
  labels: string[],
  relayHint: string,
  secretKey: Uint8Array
): object {
  return createLabelEvent({
    namespace: NAMESPACES.UGC,
    labels,
    target: {
      type: 'event',
      value: eventId,
      relayHint,
    },
  }, secretKey)
}

// ç‚ºè‡ªå·±çš„è²¼æ–‡æ·»åŠ è‡ªæˆ‘æ¨™è¨˜
function createSelfLabeledNote(
  content: string,
  language: string,
  topics: string[],
  secretKey: Uint8Array
): object {
  const tags: string[][] = []

  // èªè¨€æ¨™ç±¤
  tags.push(['L', NAMESPACES.LANGUAGE])
  tags.push(['l', language, NAMESPACES.LANGUAGE])

  // ä¸»é¡Œæ¨™ç±¤
  if (topics.length > 0) {
    tags.push(['L', '#t'])
    for (const topic of topics) {
      tags.push(['l', topic, '#t'])
      tags.push(['t', topic])
    }
  }

  const event = {
    kind: 1,
    created_at: Math.floor(Date.now() / 1000),
    tags,
    content,
  }

  return finalizeEvent(event, secretKey)
}

// ä½¿ç”¨ç¯„ä¾‹
const sk = generateSecretKey()

// æ¨™è¨˜äº‹ä»¶èªè¨€ç‚ºä¸­æ–‡
const languageLabel = labelEventLanguage(
  'abc123...',
  'zh',
  'wss://relay.example.com',
  sk
)

// æ¨™è¨˜ç”¨æˆ¶ç‚ºå·²é©—è­‰
const trustLabel = labelUserTrust(
  'pubkey123...',
  'verified',
  'wss://relay.example.com',
  sk
)

// ç”¨æˆ¶ç”Ÿæˆæ¨™ç±¤
const ugcLabel = createUGCLabel(
  'event456...',
  ['æœ‰è¶£', 'æ¨è–¦', 'å¿…è®€'],
  'wss://relay.example.com',
  sk
)

// å‰µå»ºå¸¶è‡ªæˆ‘æ¨™è¨˜çš„è²¼æ–‡
const selfLabeledNote = createSelfLabeledNote(
  'Bitcoin æ˜¯æœªä¾†çš„è²¨å¹£ï¼',
  'zh',
  ['bitcoin', 'cryptocurrency'],
  sk
)`}</code></pre>
  </section>

  <!-- Query Labels -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æŸ¥è©¢æ¨™ç±¤</h2>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`import { SimplePool } from 'nostr-tools'

const pool = new SimplePool()
const relays = ['wss://relay.example.com']

// æŸ¥è©¢ç‰¹å®šäº‹ä»¶çš„æ‰€æœ‰æ¨™ç±¤
async function getLabelsForEvent(eventId: string) {
  const labels = await pool.querySync(relays, {
    kinds: [1985],
    '#e': [eventId],
  })
  return labels
}

// æŸ¥è©¢ç‰¹å®šå‘½åç©ºé–“çš„æ¨™ç±¤
async function getLabelsByNamespace(namespace: string) {
  const labels = await pool.querySync(relays, {
    kinds: [1985],
    '#L': [namespace],
  })
  return labels
}

// æŸ¥è©¢ç‰¹å®šæ¨™ç±¤å€¼
async function getEventsByLabel(label: string, namespace?: string) {
  const filter: any = {
    kinds: [1985],
    '#l': [label],
  }

  if (namespace) {
    filter['#L'] = [namespace]
  }

  const labels = await pool.querySync(relays, filter)
  return labels
}

// æŸ¥è©¢æŸç”¨æˆ¶çš„æ‰€æœ‰æ¨™ç±¤
async function getLabelsForUser(pubkey: string) {
  const labels = await pool.querySync(relays, {
    kinds: [1985],
    '#p': [pubkey],
  })
  return labels
}

// æŸ¥è©¢ä¸­æ–‡å…§å®¹
async function getChineseContent() {
  const labels = await pool.querySync(relays, {
    kinds: [1985],
    '#L': ['ISO-639-1'],
    '#l': ['zh'],
  })

  // æå–è¢«æ¨™è¨˜çš„äº‹ä»¶ ID
  const eventIds = labels
    .flatMap(l => l.tags.filter(t => t[0] === 'e').map(t => t[1]))

  // ç²å–å¯¦éš›äº‹ä»¶
  if (eventIds.length > 0) {
    return await pool.querySync(relays, {
      ids: eventIds,
    })
  }

  return []
}

// è§£ææ¨™ç±¤äº‹ä»¶
function parseLabels(event: any): {
  namespace: string
  labels: string[]
  targets: { type: string; value: string }[]
} {
  const namespaceTags = event.tags.filter((t: string[]) => t[0] === 'L')
  const labelTags = event.tags.filter((t: string[]) => t[0] === 'l')

  const namespace = namespaceTags[0]?.[1] || 'ugc'
  const labels = labelTags.map((t: string[]) => t[1])

  const targets: { type: string; value: string }[] = []
  for (const tag of event.tags) {
    if (tag[0] === 'e') targets.push({ type: 'event', value: tag[1] })
    if (tag[0] === 'p') targets.push({ type: 'pubkey', value: tag[1] })
    if (tag[0] === 'r') targets.push({ type: 'relay', value: tag[1] })
    if (tag[0] === 'a') targets.push({ type: 'address', value: tag[1] })
    if (tag[0] === 't') targets.push({ type: 'topic', value: tag[1] })
  }

  return { namespace, labels, targets }
}`}</code></pre>
  </section>

  <!-- Use Cases -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ‡‰ç”¨å ´æ™¯</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸŒ èªè¨€æ¨™è¨˜</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ä½¿ç”¨ ISO-639-1 æ¨™è¨˜å…§å®¹èªè¨€ï¼Œè®“å®¢æˆ¶ç«¯å¯ä»¥éæ¿¾é¡¯ç¤ºç‰¹å®šèªè¨€çš„å…§å®¹ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ·ï¸ å…§å®¹åˆ†é¡</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ç‚ºè²¼æ–‡æ·»åŠ åˆ†é¡æ¨™ç±¤å¦‚ã€Œæ–°èã€ã€ã€Œæ•™ç¨‹ã€ã€ã€Œè¨è«–ã€ç­‰ï¼Œæ–¹ä¾¿å…§å®¹ç™¼ç¾ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">âœ… ä¿¡ä»»æ¨™è¨˜</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          æ¨™è¨˜ç”¨æˆ¶çš„ä¿¡ä»»ç­‰ç´šæˆ–é©—è­‰ç‹€æ…‹ï¼Œå»ºç«‹å»ä¸­å¿ƒåŒ–çš„ä¿¡ä»»ç¶²çµ¡ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ›¡ï¸ å…§å®¹å¯©æ ¸</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          çµåˆ NIP-56 èˆ‰å ±ç³»çµ±ï¼Œå¯©æ ¸å“¡å¯ä»¥æ·»åŠ å¯©æ ¸çµæœæ¨™ç±¤ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">â­ è©•ç´šç³»çµ±</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ç‚ºå…§å®¹æ·»åŠ å“è³ªè©•ç´šï¼Œå¦‚ã€Œé«˜å“è³ªã€ã€ã€Œç²¾é¸ã€ã€ã€Œæ¨è–¦ã€ç­‰ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ“Š ä¸­ç¹¼å™¨åˆ†é¡</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          æ¨™è¨˜ä¸­ç¹¼å™¨çš„ç‰¹æ€§ï¼Œå¦‚ã€Œä»˜è²»ã€ã€ã€Œå…è²»ã€ã€ã€Œå¿«é€Ÿã€ã€ã€Œå°ˆæ¥­ã€ç­‰ã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- Best Practices -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æœ€ä½³å¯¦è¸</h2>
    <div class="space-y-4">
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ ä½¿ç”¨æ˜ç¢ºçš„å‘½åç©ºé–“</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ä½¿ç”¨ ISO æ¨™æº–æˆ–åå‘åŸŸåæ¨™è¨˜ï¼Œé¿å…å‘½åç©ºé–“è¡çªã€‚ä¿æŒå‘½åç©ºé–“å…¬é–‹ä¸”éå°ˆæœ‰ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ æ¨™ç±¤å€¼ä¿æŒç°¡çŸ­</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          æ¨™ç±¤æ‡‰è©²æ˜¯ç°¡çŸ­ã€æœ‰æ„ç¾©çš„å­—ä¸²ã€‚è¼ƒé•·çš„è§£é‡‹æ‡‰æ”¾åœ¨ content æ¬„ä½ä¸­ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ æ·»åŠ ä¸­ç¹¼å™¨æç¤º</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ä½¿ç”¨ e å’Œ p æ¨™ç±¤æ™‚ï¼Œæ‡‰åŒ…å«ä¸­ç¹¼å™¨æç¤ºä»¥å¹«åŠ©å®¢æˆ¶ç«¯æ‰¾åˆ°ç›®æ¨™ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/20">
        <h4 class="font-semibold text-yellow-400 mb-2">âš  å–®ä¸€å‘½åç©ºé–“åŸå‰‡</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          æ¯å€‹æ¨™ç±¤äº‹ä»¶æ‡‰é™åˆ¶åœ¨å–®ä¸€å‘½åç©ºé–“å…§ã€‚å¦‚éœ€å¤šå€‹å‘½åç©ºé–“ï¼Œå‰µå»ºå¤šå€‹æ¨™ç±¤äº‹ä»¶ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/20">
        <h4 class="font-semibold text-yellow-400 mb-2">âš  l æ¨™ç±¤å¿…é ˆåŒ…å«å‘½åç©ºé–“æ¨™è¨˜</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ç•¶ä½¿ç”¨ L æ¨™ç±¤æ™‚ï¼Œl æ¨™ç±¤å¿…é ˆåŒ…å«ç¬¬ä¸‰å€‹å…ƒç´ å°æ‡‰ L æ¨™ç±¤çš„å€¼ã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- Related NIPs -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ç›¸é—œ NIP</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <a
        href="/tech/nostr/nip-56"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-56 èˆ‰å ±</h4>
        <p class="text-sm text-[var(--text-secondary)]">å…§å®¹èˆ‰å ±æ©Ÿåˆ¶ï¼Œå¯èˆ‡æ¨™ç±¤ç³»çµ±é…åˆä½¿ç”¨</p>
      </a>
      <a
        href="/tech/nostr/nip-36"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-36 æ•æ„Ÿå…§å®¹</h4>
        <p class="text-sm text-[var(--text-secondary)]">å…§å®¹è­¦å‘Šæ¨™è¨˜</p>
      </a>
      <a
        href="/tech/nostr/nip-09"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-09 äº‹ä»¶åˆªé™¤</h4>
        <p class="text-sm text-[var(--text-secondary)]">å¯ç”¨æ–¼æ‰¹é‡åˆªé™¤å’Œæ›¿æ›æ¨™ç±¤</p>
      </a>
      <a
        href="/tech/nostr/nip-01"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-01 åŸºæœ¬å”è­°</h4>
        <p class="text-sm text-[var(--text-secondary)]">äº‹ä»¶çµæ§‹å’Œéæ¿¾å™¨åŸºç¤</p>
      </a>
    </div>
  </section>

  <!-- Summary -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ç¸½çµ</h2>
    <div class="p-6 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
      <p class="text-[var(--text-secondary)] mb-4">
        NIP-32 æ¨™ç±¤ç³»çµ±æä¾›äº†ä¸€å€‹éˆæ´»çš„æ©Ÿåˆ¶ï¼Œè®“ç”¨æˆ¶å’Œæ‡‰ç”¨å¯ä»¥ç‚º Nostr å…§å®¹æ·»åŠ çµæ§‹åŒ–çš„åˆ†é¡è³‡è¨Šã€‚
        é€éå‘½åç©ºé–“éš”é›¢ï¼Œä¸åŒçš„ä½¿ç”¨å ´æ™¯å¯ä»¥å…±å­˜è€Œä¸æœƒäº’ç›¸å¹²æ“¾ã€‚
      </p>
      <div class="grid md:grid-cols-3 gap-4 text-center">
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-purple-400">Kind 1985</div>
          <div class="text-sm text-[var(--text-secondary)]">æ¨™ç±¤äº‹ä»¶é¡å‹</div>
        </div>
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-blue-400">L + l</div>
          <div class="text-sm text-[var(--text-secondary)]">å‘½åç©ºé–“ + æ¨™ç±¤å€¼</div>
        </div>
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-green-400">5 ç¨®</div>
          <div class="text-sm text-[var(--text-secondary)]">æ¨™ç±¤ç›®æ¨™é¡å‹</div>
        </div>
      </div>
    </div>
  </section>
</ArticleLayout>
