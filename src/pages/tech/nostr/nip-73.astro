---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="NIP-73: å¤–éƒ¨å…§å®¹ ID"
  description="ä½¿ç”¨ i æ¨™ç±¤å¼•ç”¨å¤–éƒ¨å…§å®¹çš„å”¯ä¸€è­˜åˆ¥ç¬¦"
  breadcrumbs={[
    { label: 'æŠ€è¡“', href: '/tech/' },
    { label: 'Nostr', href: '/tech/nostr/' },
    { label: 'NIP-73' },
  ]}
>
  <h2 id="overview">æ¦‚è¿°</h2>
  <p>
    NIP-73 å®šç¾©äº† <code>i</code> æ¨™ç±¤ï¼Œç”¨æ–¼å°‡ Nostr äº‹ä»¶é—œè¯åˆ°å¤–éƒ¨ç³»çµ±ä¸­çš„å…§å®¹ã€‚ é€™è®“ä½¿ç”¨è€…å¯ä»¥å°é›»å½±ã€éŸ³æ¨‚ã€æ›¸ç±ã€Podcast
    ç­‰å¤–éƒ¨å…§å®¹ç™¼è¡¨è©•è«–ã€è©•åˆ†æˆ–è¨è«–ï¼Œ åŒæ™‚ä¿æŒèˆ‡åŸå§‹å…§å®¹çš„å¯è¿½è¹¤é€£çµã€‚
  </p>

  <h2 id="tag-format">æ¨™ç±¤æ ¼å¼</h2>
  <pre><code class="language-json" is:raw>["i", "&lt;type&gt;:&lt;id&gt;", "&lt;proof-url&gt;"]</code></pre>

  <table>
    <thead>
      <tr>
        <th>æ¬„ä½</th>
        <th>èªªæ˜</th>
        <th>å¿…è¦æ€§</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>type</code></td>
        <td>å¤–éƒ¨ç³»çµ±/å¹³å°é¡å‹</td>
        <td>å¿…è¦</td>
      </tr>
      <tr>
        <td><code>id</code></td>
        <td>è©²ç³»çµ±ä¸­çš„å”¯ä¸€è­˜åˆ¥ç¬¦</td>
        <td>å¿…è¦</td>
      </tr>
      <tr>
        <td><code>proof-url</code></td>
        <td>è­‰æ˜é€£çµï¼ˆå¦‚é©ç”¨ï¼‰</td>
        <td>å¯é¸</td>
      </tr>
    </tbody>
  </table>

  <h2 id="supported-types">æ”¯æ´çš„é¡å‹</h2>

  <h3>åª’é«”èˆ‡å¨›æ¨‚</h3>
  <table>
    <thead>
      <tr>
        <th>é¡å‹</th>
        <th>èªªæ˜</th>
        <th>ID æ ¼å¼</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>imdb</code></td>
        <td>IMDb é›»å½±/é›»è¦–</td>
        <td><code>tt1234567</code></td>
      </tr>
      <tr>
        <td><code>tmdb</code></td>
        <td>TheMovieDB</td>
        <td><code>movie:12345</code> æˆ– <code>tv:12345</code></td>
      </tr>
      <tr>
        <td><code>spotify</code></td>
        <td>Spotify éŸ³æ¨‚</td>
        <td><code>track:xxx</code>ã€<code>album:xxx</code></td>
      </tr>
      <tr>
        <td><code>tidal</code></td>
        <td>Tidal éŸ³æ¨‚</td>
        <td><code>track:12345</code></td>
      </tr>
      <tr>
        <td><code>deezer</code></td>
        <td>Deezer éŸ³æ¨‚</td>
        <td><code>track:12345</code></td>
      </tr>
      <tr>
        <td><code>podcast:guid</code></td>
        <td>Podcast åŠ‡é›† GUID</td>
        <td>UUID æ ¼å¼</td>
      </tr>
      <tr>
        <td><code>podcast:item:guid</code></td>
        <td>Podcast é …ç›® GUID</td>
        <td>é …ç›®å”¯ä¸€è­˜åˆ¥ç¬¦</td>
      </tr>
    </tbody>
  </table>

  <h3>æ›¸ç±èˆ‡å‡ºç‰ˆ</h3>
  <table>
    <thead>
      <tr>
        <th>é¡å‹</th>
        <th>èªªæ˜</th>
        <th>ID æ ¼å¼</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>isbn</code></td>
        <td>åœ‹éš›æ¨™æº–æ›¸è™Ÿ</td>
        <td>10 æˆ– 13 ä½ ISBN</td>
      </tr>
      <tr>
        <td><code>openlibrary</code></td>
        <td>Open Library</td>
        <td><code>OL12345W</code></td>
      </tr>
      <tr>
        <td><code>goodreads</code></td>
        <td>Goodreads æ›¸ç±</td>
        <td>æ›¸ç± ID</td>
      </tr>
      <tr>
        <td><code>doi</code></td>
        <td>æ•¸ä½ç‰©ä»¶è­˜åˆ¥ç¢¼</td>
        <td><code>10.1000/xyz123</code></td>
      </tr>
    </tbody>
  </table>

  <h3>éŠæˆ²èˆ‡è»Ÿé«”</h3>
  <table>
    <thead>
      <tr>
        <th>é¡å‹</th>
        <th>èªªæ˜</th>
        <th>ID æ ¼å¼</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>steam</code></td>
        <td>Steam éŠæˆ²</td>
        <td>App ID</td>
      </tr>
      <tr>
        <td><code>igdb</code></td>
        <td>IGDB éŠæˆ²è³‡æ–™åº«</td>
        <td>éŠæˆ² ID</td>
      </tr>
    </tbody>
  </table>

  <h3>åœ°ç†ä½ç½®</h3>
  <table>
    <thead>
      <tr>
        <th>é¡å‹</th>
        <th>èªªæ˜</th>
        <th>ID æ ¼å¼</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>geo</code></td>
        <td>åœ°ç†åº§æ¨™</td>
        <td><code>lat,lon</code></td>
      </tr>
      <tr>
        <td><code>geohash</code></td>
        <td>Geohash ç·¨ç¢¼</td>
        <td>Geohash å­—ä¸²</td>
      </tr>
      <tr>
        <td><code>osm</code></td>
        <td>OpenStreetMap</td>
        <td><code>node:12345</code>ã€<code>way:12345</code></td>
      </tr>
    </tbody>
  </table>

  <h2 id="examples">ç¯„ä¾‹</h2>

  <h3>é›»å½±è©•è«–</h3>
  <pre><code class="language-json" is:raw>{
  "kind": 1,
  "content": "å‰›çœ‹å®Œã€Šä¹˜é¢¨ç ´æµªã€‹ï¼Œéå¸¸ç²¾å½©çš„é›»å½±ï¼åŠ‡æƒ…ç·Šæ¹Šï¼Œæ¼”å“¡æ¼”æŠ€å‡ºè‰²ã€‚æ¨è–¦ï¼â­â­â­â­â­",
  "tags": [
    ["i", "imdb:tt1234567"],
    ["i", "tmdb:movie:54321"]
  ]
}</code></pre>

  <h3>éŸ³æ¨‚åˆ†äº«</h3>
  <pre><code class="language-json" is:raw>{
  "kind": 1,
  "content": "é€™é¦–æ­Œæœ€è¿‘å–®æ›²å¾ªç’°ä¸­ ğŸµ",
  "tags": [
    ["i", "spotify:track:4iV5W9uYEdYUVa79Axb7Rh"],
    ["i", "tidal:track:12345678"]
  ]
}</code></pre>

  <h3>æ›¸ç±è¨è«–</h3>
  <pre><code class="language-json" is:raw>{
  "kind": 1,
  "content": "çµ‚æ–¼è®€å®Œäº†ã€Šç²¾é€šæ¯”ç‰¹å¹£ã€‹ï¼Œå¼·çƒˆæ¨è–¦çµ¦æ‰€æœ‰æƒ³æ·±å…¥äº†è§£å€å¡Šéˆçš„äººï¼",
  "tags": [
    ["i", "isbn:9781491954386"],
    ["i", "openlibrary:OL26201858W"]
  ]
}</code></pre>

  <h3>Podcast è¨è«–</h3>
  <pre><code class="language-json" is:raw>{
  "kind": 1,
  "content": "ä»Šå¤©é€™é›† Podcast èŠåˆ°äº†å¾ˆå¤šæœ‰è¶£çš„è§€é»ï¼",
  "tags": [
    ["i", "podcast:guid:917393e3-1b1e-5cef-ace4-edaa54e1f82d"],
    ["i", "podcast:item:guid:ep-2024-01-15"]
  ]
}</code></pre>

  <h3>åœ°é»æ‰“å¡</h3>
  <pre><code class="language-json" is:raw>{
  "kind": 1,
  "content": "ä»Šå¤©ä¾†åˆ°é€™å®¶å’–å•¡å»³ï¼Œç’°å¢ƒå¾ˆæ£’ï¼â˜•",
  "tags": [
    ["i", "geo:25.0330,121.5654"],
    ["i", "geohash:wsqqj"],
    ["i", "osm:node:123456789"]
  ]
}</code></pre>

  <h3>éŠæˆ²è©•è«–</h3>
  <pre><code class="language-json" is:raw>{
  "kind": 1,
  "content": "å‰›é€šé—œé€™æ¬¾éŠæˆ²ï¼Œæ•…äº‹ç·šéå¸¸æ„Ÿäººï¼",
  "tags": [
    ["i", "steam:1234567"],
    ["i", "igdb:12345"]
  ]
}</code></pre>

  <h2 id="implementation">TypeScript å¯¦ä½œ</h2>

  <h3>å»ºç«‹å¤–éƒ¨å…§å®¹å¼•ç”¨</h3>
  <pre><code class="language-typescript" is:raw>import { finalizeEvent } from 'nostr-tools';

type ExternalContentType =
  | 'imdb'
  | 'tmdb'
  | 'spotify'
  | 'tidal'
  | 'deezer'
  | 'isbn'
  | 'openlibrary'
  | 'goodreads'
  | 'doi'
  | 'steam'
  | 'igdb'
  | 'geo'
  | 'geohash'
  | 'osm'
  | 'podcast:guid'
  | 'podcast:item:guid';

interface ExternalReference {
  type: ExternalContentType;
  id: string;
  proofUrl?: string;
}

function createExternalReferenceEvent(
  content: string,
  references: ExternalReference[],
  secretKey: Uint8Array,
  additionalTags: string[][] = []
) {
  const iTags = references.map((ref) => {
    const tag = ['i', `${ref.type}:${ref.id}`];
    if (ref.proofUrl) {
      tag.push(ref.proofUrl);
    }
    return tag;
  });

  const event = {
    kind: 1,
    content,
    tags: [...iTags, ...additionalTags],
    created_at: Math.floor(Date.now() / 1000),
  };

  return finalizeEvent(event, secretKey);
}

// ä½¿ç”¨ç¯„ä¾‹ï¼šé›»å½±è©•è«–
const movieReview = createExternalReferenceEvent(
  'éå¸¸æ£’çš„é›»å½±ï¼åŠ‡æƒ…ç·Šæ¹Šï¼Œç‰¹æ•ˆå‡ºè‰²ã€‚',
  [
    { type: 'imdb', id: 'tt1234567' },
    { type: 'tmdb', id: 'movie:54321' },
  ],
  secretKey
);

// ä½¿ç”¨ç¯„ä¾‹ï¼šéŸ³æ¨‚åˆ†äº«
const musicShare = createExternalReferenceEvent(
  'é€™é¦–æ­Œå¤ªå¥½è½äº†ï¼ğŸµ',
  [
    { type: 'spotify', id: 'track:4iV5W9uYEdYUVa79Axb7Rh' },
  ],
  secretKey
);</code></pre>

  <h3>è§£æå¤–éƒ¨å¼•ç”¨</h3>
  <pre><code class="language-typescript" is:raw>interface ParsedExternalRef {
  type: string;
  id: string;
  proofUrl?: string;
  fullId: string;
}

function parseExternalReferences(event: any): ParsedExternalRef[] {
  const iTags = event.tags.filter(
    (tag: string[]) => tag[0] === 'i' && tag.length >= 2
  );

  return iTags.map((tag: string[]) => {
    const fullId = tag[1];
    const colonIndex = fullId.indexOf(':');

    let type: string;
    let id: string;

    if (colonIndex > 0) {
      type = fullId.slice(0, colonIndex);
      id = fullId.slice(colonIndex + 1);
    } else {
      type = 'unknown';
      id = fullId;
    }

    return {
      type,
      id,
      proofUrl: tag[2],
      fullId,
    };
  });
}

// ä½¿ç”¨ç¯„ä¾‹
const refs = parseExternalReferences(event);
refs.forEach((ref) => {
  console.log(`é¡å‹: ${ref.type}, ID: ${ref.id}`);
});</code></pre>

  <h3>ç”¢ç”Ÿå¤–éƒ¨é€£çµ</h3>
  <pre><code class="language-typescript" is:raw>function getExternalUrl(ref: ParsedExternalRef): string | null {
  switch (ref.type) {
    case 'imdb':
      return `https://www.imdb.com/title/${ref.id}`;

    case 'tmdb':
      const [tmdbType, tmdbId] = ref.id.split(':');
      return `https://www.themoviedb.org/${tmdbType}/${tmdbId}`;

    case 'spotify':
      const [spotifyType, spotifyId] = ref.id.split(':');
      return `https://open.spotify.com/${spotifyType}/${spotifyId}`;

    case 'tidal':
      const [tidalType, tidalId] = ref.id.split(':');
      return `https://tidal.com/${tidalType}/${tidalId}`;

    case 'isbn':
      return `https://openlibrary.org/isbn/${ref.id}`;

    case 'openlibrary':
      return `https://openlibrary.org/works/${ref.id}`;

    case 'goodreads':
      return `https://www.goodreads.com/book/show/${ref.id}`;

    case 'doi':
      return `https://doi.org/${ref.id}`;

    case 'steam':
      return `https://store.steampowered.com/app/${ref.id}`;

    case 'igdb':
      return `https://www.igdb.com/games/${ref.id}`;

    case 'geo':
      const [lat, lon] = ref.id.split(',');
      return `https://www.openstreetmap.org/?mlat=${lat}&mlon=${lon}`;

    case 'geohash':
      return `https://geohash.org/${ref.id}`;

    case 'osm':
      const [osmType, osmId] = ref.id.split(':');
      return `https://www.openstreetmap.org/${osmType}/${osmId}`;

    default:
      return null;
  }
}

// ä½¿ç”¨ç¯„ä¾‹
const refs = parseExternalReferences(event);
refs.forEach((ref) => {
  const url = getExternalUrl(ref);
  if (url) {
    console.log(`${ref.type}: ${url}`);
  }
});</code></pre>

  <h3>æœå°‹ç›¸é—œäº‹ä»¶</h3>
  <pre><code class="language-typescript" is:raw>import { SimplePool } from 'nostr-tools';

async function findEventsForContent(
  pool: SimplePool,
  relays: string[],
  type: ExternalContentType,
  id: string
): Promise&lt;any[]&gt; {
  const filter = {
    kinds: [1],
    '#i': [`${type}:${id}`],
    limit: 100,
  };

  const events = await pool.querySync(relays, filter);

  return events.sort((a, b) => b.created_at - a.created_at);
}

// ä½¿ç”¨ç¯„ä¾‹ï¼šæŸ¥è©¢é—œæ–¼ç‰¹å®šé›»å½±çš„æ‰€æœ‰è¨è«–
const movieDiscussions = await findEventsForContent(
  pool,
  ['wss://relay.example.com'],
  'imdb',
  'tt1234567'
);

console.log(`æ‰¾åˆ° ${movieDiscussions.length} å‰‡ç›¸é—œè¨è«–`);</code></pre>

  <h3>React å…ƒä»¶</h3>
  <pre><code class="language-typescript" is:raw>interface ExternalContentCardProps {
  reference: ParsedExternalRef;
}

function ExternalContentCard({ reference }: ExternalContentCardProps) {
  const url = getExternalUrl(reference);

  const typeLabels: Record&lt;string, string&gt; = {
    imdb: 'IMDb',
    tmdb: 'TMDb',
    spotify: 'Spotify',
    tidal: 'Tidal',
    isbn: 'ISBN',
    openlibrary: 'Open Library',
    goodreads: 'Goodreads',
    doi: 'DOI',
    steam: 'Steam',
    igdb: 'IGDB',
    geo: 'ä½ç½®',
    geohash: 'Geohash',
    osm: 'OpenStreetMap',
  };

  const typeIcons: Record&lt;string, string&gt; = {
    imdb: 'ğŸ¬',
    tmdb: 'ğŸ¥',
    spotify: 'ğŸµ',
    tidal: 'ğŸ§',
    isbn: 'ğŸ“š',
    openlibrary: 'ğŸ“–',
    goodreads: 'ğŸ“•',
    doi: 'ğŸ“„',
    steam: 'ğŸ®',
    igdb: 'ğŸ•¹ï¸',
    geo: 'ğŸ“',
    geohash: 'ğŸ—ºï¸',
    osm: 'ğŸŒ',
  };

  return (
    &lt;div className="external-content-card"&gt;
      &lt;span className="icon"&gt;
        {typeIcons[reference.type] || 'ğŸ”—'}
      &lt;/span&gt;
      &lt;span className="label"&gt;
        {typeLabels[reference.type] || reference.type}
      &lt;/span&gt;
      &lt;span className="id"&gt;{reference.id}&lt;/span&gt;
      {url && (
        &lt;a
          href={url}
          target="_blank"
          rel="noopener noreferrer"
          className="link"
        &gt;
          é–‹å•Ÿ
        &lt;/a&gt;
      )}
    &lt;/div&gt;
  );
}

function EventExternalRefs({ event }: { event: any }) {
  const refs = parseExternalReferences(event);

  if (refs.length === 0) {
    return null;
  }

  return (
    &lt;div className="external-refs"&gt;
      {refs.map((ref, i) =&gt; (
        &lt;ExternalContentCard key={i} reference={ref} /&gt;
      ))}
    &lt;/div&gt;
  );
}</code></pre>

  <h2 id="use-cases">ä½¿ç”¨å ´æ™¯</h2>

  <h3>åª’é«”è©•è«–èˆ‡è¨è«–</h3>
  <ul>
    <li>é›»å½±ã€é›»è¦–åŠ‡è©•è«–</li>
    <li>éŸ³æ¨‚å°ˆè¼¯ã€æ­Œæ›²è¨è«–</li>
    <li>Podcast ç¯€ç›®è©•è«–</li>
    <li>éŠæˆ²è©•æ¸¬</li>
  </ul>

  <h3>æ›¸ç±ç¤¾ç¾¤</h3>
  <ul>
    <li>è®€æ›¸ç­†è¨˜èˆ‡å¿ƒå¾—</li>
    <li>æ›¸ç±æ¨è–¦åˆ—è¡¨</li>
    <li>å­¸è¡“è«–æ–‡è¨è«–ï¼ˆDOIï¼‰</li>
  </ul>

  <h3>ä½ç½®ç›¸é—œå…§å®¹</h3>
  <ul>
    <li>é¤å»³ã€å’–å•¡å»³è©•è«–</li>
    <li>æ—…éŠæ™¯é»åˆ†äº«</li>
    <li>æ´»å‹•åœ°é»æ¨™è¨˜</li>
  </ul>

  <h3>å…§å®¹èšåˆ</h3>
  <ul>
    <li>èšåˆæ‰€æœ‰é—œæ–¼ç‰¹å®šé›»å½±çš„è¨è«–</li>
    <li>å»ºç«‹åœç¹ç‰¹å®šæ›¸ç±çš„ç¤¾ç¾¤</li>
    <li>è¿½è¹¤ç‰¹å®šéŸ³æ¨‚çš„ç†±åº¦</li>
  </ul>

  <h2 id="best-practices">æœ€ä½³å¯¦è¸</h2>
  <ul>
    <li><strong>ä½¿ç”¨æ¨™æº–è­˜åˆ¥ç¬¦</strong>ï¼šå„ªå…ˆä½¿ç”¨å»£æ³›èªå¯çš„ ID ç³»çµ±ï¼ˆå¦‚ IMDbã€ISBNï¼‰</li>
    <li><strong>å¤šé‡å¼•ç”¨</strong>ï¼šåŒæ™‚ä½¿ç”¨å¤šå€‹ä¾†æº ID æé«˜å¯ç™¼ç¾æ€§</li>
    <li><strong>æä¾›è­‰æ˜é€£çµ</strong>ï¼šåœ¨å¯èƒ½çš„æƒ…æ³ä¸‹åŒ…å« proof URL</li>
    <li><strong>å®¢æˆ¶ç«¯è±å¯ŒåŒ–</strong>ï¼šå¾å¤–éƒ¨ API ç²å–è©³ç´°è³‡è¨Šä¸¦å±•ç¤º</li>
    <li><strong>å¿«å–å¤–éƒ¨è³‡æ–™</strong>ï¼šæ¸›å°‘å°å¤–éƒ¨æœå‹™çš„è«‹æ±‚</li>
  </ul>

  <h2 id="related-nips">ç›¸é—œ NIPs</h2>
  <ul>
    <li><a href="/tech/nostr/nip-01">NIP-01</a>ï¼šåŸºæœ¬å”è­° - äº‹ä»¶æ ¼å¼</li>
    <li><a href="/tech/nostr/nip-32">NIP-32</a>ï¼šæ¨™ç±¤ç³»çµ± - åˆ†é¡æ¨™ç±¤</li>
    <li><a href="/tech/nostr/nip-39">NIP-39</a>ï¼šå¤–éƒ¨èº«ä»½ - èº«ä»½é©—è­‰</li>
    <li><a href="/tech/nostr/nip-48">NIP-48</a>ï¼šä»£ç†æ¨™ç±¤ - å¦ä¸€ç¨®å¤–éƒ¨å¼•ç”¨æ–¹å¼</li>
    <li><a href="/tech/nostr/nip-52">NIP-52</a>ï¼šæ—¥æ›†æ´»å‹• - åœ°é»æ¨™ç±¤</li>
  </ul>

  <h2 id="references">åƒè€ƒè³‡æº</h2>
  <ul>
    <li>
      <a
        href="https://github.com/nostr-protocol/nips/blob/master/73.md"
        target="_blank"
        rel="noopener noreferrer">NIP-73 è¦ç¯„</a>
    </li>
    <li><a href="https://www.imdb.com/" target="_blank" rel="noopener noreferrer">IMDb</a></li>
    <li>
      <a href="https://www.themoviedb.org/" target="_blank" rel="noopener noreferrer">TheMovieDB</a>
    </li>
    <li>
      <a href="https://openlibrary.org/" target="_blank" rel="noopener noreferrer">Open Library</a>
    </li>
  </ul>
</ArticleLayout>
