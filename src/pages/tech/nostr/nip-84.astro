---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="NIP-84: ç²¾é¸æ¨™è¨˜"
  description="Highlights - æ¨™è¨˜ã€å¼•ç”¨èˆ‡è¨»è§£å…§å®¹"
  breadcrumbs={[
    { label: 'æŠ€è¡“', href: '/tech/' },
    { label: 'Nostr', href: '/tech/nostr/' },
    { label: 'NIP-84' },
  ]}
  difficulty="beginner"
  readingTime="10 åˆ†é˜"
  tags={['Nostr', 'NIP-84', 'æ¨™è¨˜', 'highlights', 'annotation']}
  prevPage={{ title: 'NIP-75 Zap ç›®æ¨™', href: '/tech/nostr/nip-75' }}
  nextPage={{ title: 'NIP-90 è³‡æ–™è²©è³£æ©Ÿ', href: '/tech/nostr/nip-90' }}
>
  <!-- Breadcrumb -->
  <nav class="flex items-center gap-2 text-sm text-[var(--text-tertiary)] mb-8 flex-wrap">
    <a href="/" class="hover:text-[var(--text-secondary)] transition-colors">é¦–é </a>
    <span>/</span>
    <a href="/tech" class="hover:text-[var(--text-secondary)] transition-colors">æŠ€è¡“</a>
    <span>/</span>
    <a href="/tech/nostr" class="hover:text-[var(--text-secondary)] transition-colors">Nostr</a>
    <span>/</span>
    <span class="text-[var(--text-primary)]">NIP-84</span>
  </nav>

  <!-- Introduction -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ¦‚è¿°</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      NIP-84 å®šç¾©äº†ç²¾é¸æ¨™è¨˜ï¼ˆHighlightsï¼‰äº‹ä»¶ï¼Œè®“ç”¨æˆ¶å¯ä»¥æ¨™è¨˜å’Œå¼•ç”¨æ–‡ç« ä¸­çš„ç²¾å½©æ®µè½ã€‚ é€™é¡ä¼¼æ–¼
      Medium çš„æ–‡å­—æ¨™è¨˜åŠŸèƒ½æˆ– Kindle çš„åŠƒç·šåŠŸèƒ½ï¼Œè®“è®€è€…å¯ä»¥ä¿å­˜å’Œåˆ†äº«æœ‰åƒ¹å€¼çš„å…§å®¹ç‰‡æ®µã€‚
    </p>
    <div class="p-4 rounded-lg bg-purple-500/10 border border-purple-500/20">
      <p class="text-[var(--text-secondary)]">
        <strong class="text-purple-400">æ ¸å¿ƒæ¦‚å¿µï¼š</strong>
        ç²¾é¸æ¨™è¨˜ä½¿ç”¨ kind 9802ï¼Œå°‡æ¨™è¨˜çš„æ–‡å­—å­˜æ”¾åœ¨ <code
          class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]"
          >content</code
        > æ¬„ä½ï¼Œ ä¸¦é€é <code
          class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]"
          >a</code
        >ã€<code
          class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]"
          >e</code
        > æˆ–
        <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]"
          >r</code
        > æ¨™ç±¤å¼•ç”¨ä¾†æºã€‚
      </p>
    </div>
  </section>

  <!-- Event Structure -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">äº‹ä»¶çµæ§‹</h2>
    <p class="text-[var(--text-secondary)] mb-4">ç²¾é¸æ¨™è¨˜äº‹ä»¶ä½¿ç”¨ kind 9802ï¼š</p>
    <div class="overflow-x-auto">
      <table class="w-full border-collapse mb-4">
        <thead>
          <tr class="border-b border-[var(--border-default)]">
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">æ¬„ä½/æ¨™ç±¤</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">å¿…è¦</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">èªªæ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">kind</td>
            <td class="py-3 px-4 text-green-400">âœ“</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">9802</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">content</td>
            <td class="py-3 px-4 text-green-400">âœ“</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">æ¨™è¨˜çš„æ–‡å­—å…§å®¹</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">a / e / r</td>
            <td class="py-3 px-4 text-green-400">âœ“</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">ä¾†æºå¼•ç”¨ï¼ˆæ“‡ä¸€ï¼‰</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">p</td>
            <td class="py-3 px-4 text-gray-400">-</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">åŸä½œè€…ï¼ˆå«è§’è‰²ï¼‰</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">context</td>
            <td class="py-3 px-4 text-gray-400">-</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">å‘¨åœä¸Šä¸‹æ–‡</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">comment</td>
            <td class="py-3 px-4 text-gray-400">-</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">å¼•ç”¨è©•è«–</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Source References -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ä¾†æºå¼•ç”¨</h2>
    <p class="text-[var(--text-secondary)] mb-4">ç²¾é¸æ¨™è¨˜å¯ä»¥å¼•ç”¨ä¸‰ç¨®é¡å‹çš„ä¾†æºï¼š</p>

    <div class="grid md:grid-cols-3 gap-4 mb-6">
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2 flex items-center gap-2">
          <span class="text-purple-400 font-mono">a</span> å¯å®šå€äº‹ä»¶
        </h4>
        <p class="text-sm text-[var(--text-secondary)]">å¼•ç”¨ NIP-23 é•·æ–‡ç­‰å¯å®šå€äº‹ä»¶</p>
        <code class="text-xs mt-2 block text-gray-400">30023:pubkey:slug</code>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2 flex items-center gap-2">
          <span class="text-blue-400 font-mono">e</span> ä¸€èˆ¬äº‹ä»¶
        </h4>
        <p class="text-sm text-[var(--text-secondary)]">å¼•ç”¨ä¸€èˆ¬è²¼æ–‡æˆ–å…¶ä»–äº‹ä»¶</p>
        <code class="text-xs mt-2 block text-gray-400">event-id</code>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2 flex items-center gap-2">
          <span class="text-green-400 font-mono">r</span> å¤–éƒ¨ URL
        </h4>
        <p class="text-sm text-[var(--text-secondary)]">å¼•ç”¨ç¶²é æ–‡ç« æˆ–å¤–éƒ¨å…§å®¹</p>
        <code class="text-xs mt-2 block text-gray-400">https://...</code>
      </div>
    </div>

    <div class="p-4 rounded-lg bg-blue-500/10 border border-blue-500/20">
      <p class="text-[var(--text-secondary)]">
        <strong class="text-blue-400">æœ€ä½³å¯¦è¸ï¼š</strong>
        å¼•ç”¨å¤–éƒ¨ URL æ™‚ï¼Œå®¢æˆ¶ç«¯æ‡‰æ¸…ç†è¿½è¹¤åƒæ•¸å’Œç„¡ç”¨è³‡è¨Šï¼Œä¿æŒ URL ç°¡æ½”ã€‚
      </p>
    </div>
  </section>

  <!-- Author Attribution -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ä½œè€…æ­¸å±¬</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      å¯ä»¥é€é p æ¨™ç±¤æ¨™è¨˜åŸä½œè€…ï¼Œç‰¹åˆ¥é©ç”¨æ–¼å¼•ç”¨é Nostr å…§å®¹æ™‚ï¼š
    </p>
    <pre
      class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`["p", "<author-pubkey>", "<relay-url>", "author"]
["p", "<editor-pubkey>", "<relay-url>", "editor"]`}</code></pre>

    <div class="grid md:grid-cols-2 gap-4">
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">author</h4>
        <p class="text-sm text-[var(--text-secondary)]">åŸå§‹å…§å®¹çš„ä½œè€…</p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">editor</h4>
        <p class="text-sm text-[var(--text-secondary)]">å…§å®¹çš„ç·¨è¼¯è€…</p>
      </div>
    </div>
  </section>

  <!-- Examples -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ä½¿ç”¨ç¯„ä¾‹</h2>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">æ¨™è¨˜ Nostr é•·æ–‡</h3>
    <pre
      class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 9802,
  "tags": [
    ["a", "30023:<author-pubkey>:my-article-slug", "wss://relay.example.com"],
    ["p", "<author-pubkey>", "wss://relay.example.com", "author"]
  ],
  "content": "æ¯”ç‰¹å¹£çš„æ ¸å¿ƒå‰µæ–°åœ¨æ–¼è§£æ±ºäº†æ•¸ä½è²¨å¹£çš„é›™é‡æ”¯ä»˜å•é¡Œï¼Œè€Œç„¡éœ€ä¾è³´ä¸­å¤®æ©Ÿæ§‹ã€‚"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">æ¨™è¨˜ä¸€èˆ¬è²¼æ–‡</h3>
    <pre
      class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 9802,
  "tags": [
    ["e", "<event-id>", "wss://relay.example.com"],
    ["p", "<author-pubkey>", "", "author"]
  ],
  "content": "Nostr çš„ç°¡å–®æ€§æ˜¯å®ƒæœ€å¤§çš„å„ªå‹¢"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">æ¨™è¨˜å¤–éƒ¨ç¶²é </h3>
    <pre
      class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 9802,
  "tags": [
    ["r", "https://bitcoin.org/bitcoin.pdf"]
  ],
  "content": "A purely peer-to-peer version of electronic cash would allow online payments to be sent directly from one party to another without going through a financial institution."
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">å¸¶ä¸Šä¸‹æ–‡çš„æ¨™è¨˜</h3>
    <pre
      class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 9802,
  "tags": [
    ["a", "30023:<pubkey>:nostr-guide", "wss://relay.example.com"],
    ["p", "<pubkey>", "", "author"],
    ["context", "åœ¨è¨è«– Nostr å”è­°çš„è¨­è¨ˆç†å¿µæ™‚ï¼Œä½œè€…æåˆ°äº†ä¸€å€‹é‡è¦è§€é»ï¼š"]
  ],
  "content": "ç°¡å–®æ€§æ˜¯ Nostr æœ€å¤§çš„ç‰¹è‰²ï¼Œæ ¸å¿ƒå”è­°åªéœ€å¹¾ç™¾è¡Œä»£ç¢¼å°±èƒ½å¯¦ç¾ã€‚"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">
      å¼•ç”¨è©•è«–ï¼ˆQuote Highlightï¼‰
    </h3>
    <pre
      class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 9802,
  "tags": [
    ["e", "<event-id>", "wss://relay.example.com"],
    ["p", "<author-pubkey>", "", "author"],
    ["comment", "é€™æ®µè©±å®Œç¾èªªæ˜äº†ç‚ºä»€éº¼æˆ‘å€‘éœ€è¦å»ä¸­å¿ƒåŒ–çš„ç¤¾äº¤ç¶²è·¯"]
  ],
  "content": "åœ¨å‚³çµ±ç¤¾äº¤å¹³å°ä¸Šï¼Œä½ çš„å¸³è™Ÿã€ä½ çš„é—œæ³¨è€…ã€ä½ çš„å…§å®¹éƒ½ä¸å±¬æ–¼ä½ ã€‚"
}`}</code></pre>
  </section>

  <!-- TypeScript Implementation -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">TypeScript å¯¦ä½œ</h2>
    <pre
      class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`import { finalizeEvent, generateSecretKey, getPublicKey } from 'nostr-tools'

type AuthorRole = 'author' | 'editor'

interface HighlightSource {
  type: 'event' | 'address' | 'url'
  value: string
  relay?: string
}

interface Author {
  pubkey: string
  relay?: string
  role: AuthorRole
}

interface HighlightOptions {
  content: string
  source: HighlightSource
  authors?: Author[]
  context?: string
  comment?: string
}

// å‰µå»ºç²¾é¸æ¨™è¨˜äº‹ä»¶
function createHighlight(
  options: HighlightOptions,
  secretKey: Uint8Array
): object {
  const tags: string[][] = []

  // æ·»åŠ ä¾†æºå¼•ç”¨
  switch (options.source.type) {
    case 'event':
      tags.push(['e', options.source.value, options.source.relay || ''])
      break
    case 'address':
      tags.push(['a', options.source.value, options.source.relay || ''])
      break
    case 'url':
      tags.push(['r', cleanUrl(options.source.value)])
      break
  }

  // æ·»åŠ ä½œè€…
  if (options.authors) {
    for (const author of options.authors) {
      tags.push(['p', author.pubkey, author.relay || '', author.role])
    }
  }

  // æ·»åŠ ä¸Šä¸‹æ–‡
  if (options.context) {
    tags.push(['context', options.context])
  }

  // æ·»åŠ è©•è«–
  if (options.comment) {
    tags.push(['comment', options.comment])
  }

  const event = {
    kind: 9802,
    created_at: Math.floor(Date.now() / 1000),
    tags,
    content: options.content,
  }

  return finalizeEvent(event, secretKey)
}

// æ¸…ç† URLï¼ˆç§»é™¤è¿½è¹¤åƒæ•¸ï¼‰
function cleanUrl(url: string): string {
  try {
    const parsed = new URL(url)
    // ç§»é™¤å¸¸è¦‹è¿½è¹¤åƒæ•¸
    const trackingParams = [
      'utm_source', 'utm_medium', 'utm_campaign', 'utm_content', 'utm_term',
      'fbclid', 'gclid', 'ref', 'source'
    ]
    trackingParams.forEach(param => parsed.searchParams.delete(param))
    return parsed.toString()
  } catch {
    return url
  }
}

// æ¨™è¨˜ Nostr é•·æ–‡
function highlightArticle(
  authorPubkey: string,
  articleSlug: string,
  highlightedText: string,
  relay: string,
  secretKey: Uint8Array,
  options?: { context?: string; comment?: string }
): object {
  return createHighlight({
    content: highlightedText,
    source: {
      type: 'address',
      value: \`30023:\${authorPubkey}:\${articleSlug}\`,
      relay,
    },
    authors: [{ pubkey: authorPubkey, relay, role: 'author' }],
    context: options?.context,
    comment: options?.comment,
  }, secretKey)
}

// æ¨™è¨˜ä¸€èˆ¬è²¼æ–‡
function highlightNote(
  eventId: string,
  authorPubkey: string,
  highlightedText: string,
  relay: string,
  secretKey: Uint8Array
): object {
  return createHighlight({
    content: highlightedText,
    source: {
      type: 'event',
      value: eventId,
      relay,
    },
    authors: [{ pubkey: authorPubkey, role: 'author' }],
  }, secretKey)
}

// æ¨™è¨˜å¤–éƒ¨ç¶²é 
function highlightWebpage(
  url: string,
  highlightedText: string,
  secretKey: Uint8Array,
  options?: { context?: string; comment?: string }
): object {
  return createHighlight({
    content: highlightedText,
    source: {
      type: 'url',
      value: url,
    },
    context: options?.context,
    comment: options?.comment,
  }, secretKey)
}

// ä½¿ç”¨ç¯„ä¾‹
const sk = generateSecretKey()
const pk = getPublicKey(sk)

// æ¨™è¨˜é•·æ–‡ä¸­çš„ç²¾å½©æ®µè½
const articleHighlight = highlightArticle(
  'author-pubkey-here',
  'intro-to-nostr',
  'Nostr æ˜¯ä¸€å€‹ç°¡å–®ã€é–‹æ”¾çš„å»ä¸­å¿ƒåŒ–ç¤¾äº¤å”è­°ã€‚',
  'wss://relay.example.com',
  sk,
  {
    context: 'åœ¨ä»‹ç´¹ Nostr çš„åŸºæœ¬æ¦‚å¿µæ™‚ï¼š',
    comment: 'é€™å¥è©±å®Œç¾ç¸½çµäº† Nostr çš„æ ¸å¿ƒåƒ¹å€¼'
  }
)

// æ¨™è¨˜å¤–éƒ¨æ–‡ç« 
const webHighlight = highlightWebpage(
  'https://bitcoin.org/bitcoin.pdf?utm_source=twitter',
  'A purely peer-to-peer version of electronic cash',
  sk,
  { comment: 'æ¯”ç‰¹å¹£ç™½çš®æ›¸çš„é–‹ç¯‡å°±é»æ˜äº†æ ¸å¿ƒæ¦‚å¿µ' }
)

console.log('Article highlight:', articleHighlight)
console.log('Web highlight:', webHighlight)`}</code></pre>
  </section>

  <!-- Query Highlights -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æŸ¥è©¢ç²¾é¸æ¨™è¨˜</h2>
    <pre
      class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`import { SimplePool } from 'nostr-tools'

const pool = new SimplePool()
const relays = ['wss://relay.example.com']

// æŸ¥è©¢ç”¨æˆ¶çš„æ‰€æœ‰ç²¾é¸æ¨™è¨˜
async function getUserHighlights(pubkey: string) {
  const highlights = await pool.querySync(relays, {
    kinds: [9802],
    authors: [pubkey],
  })
  return highlights
}

// æŸ¥è©¢ç‰¹å®šæ–‡ç« çš„æ‰€æœ‰ç²¾é¸æ¨™è¨˜
async function getArticleHighlights(authorPubkey: string, slug: string) {
  const aTag = \`30023:\${authorPubkey}:\${slug}\`
  const highlights = await pool.querySync(relays, {
    kinds: [9802],
    '#a': [aTag],
  })
  return highlights
}

// æŸ¥è©¢ç‰¹å®šäº‹ä»¶çš„ç²¾é¸æ¨™è¨˜
async function getEventHighlights(eventId: string) {
  const highlights = await pool.querySync(relays, {
    kinds: [9802],
    '#e': [eventId],
  })
  return highlights
}

// æŸ¥è©¢ç‰¹å®š URL çš„ç²¾é¸æ¨™è¨˜
async function getUrlHighlights(url: string) {
  const highlights = await pool.querySync(relays, {
    kinds: [9802],
    '#r': [url],
  })
  return highlights
}

// è§£æç²¾é¸æ¨™è¨˜
function parseHighlight(event: any) {
  const getTag = (name: string) =>
    event.tags.find((t: string[]) => t[0] === name)

  // åˆ¤æ–·ä¾†æºé¡å‹
  let sourceType: 'event' | 'address' | 'url' | null = null
  let sourceValue: string | null = null
  let sourceRelay: string | undefined

  const eTag = getTag('e')
  const aTag = getTag('a')
  const rTag = getTag('r')

  if (eTag) {
    sourceType = 'event'
    sourceValue = eTag[1]
    sourceRelay = eTag[2]
  } else if (aTag) {
    sourceType = 'address'
    sourceValue = aTag[1]
    sourceRelay = aTag[2]
  } else if (rTag) {
    sourceType = 'url'
    sourceValue = rTag[1]
  }

  // è§£æä½œè€…
  const authors = event.tags
    .filter((t: string[]) => t[0] === 'p')
    .map((t: string[]) => ({
      pubkey: t[1],
      relay: t[2] || undefined,
      role: t[3] || 'author',
    }))

  const contextTag = getTag('context')
  const commentTag = getTag('comment')

  return {
    id: event.id,
    pubkey: event.pubkey,
    content: event.content,
    source: sourceType ? {
      type: sourceType,
      value: sourceValue,
      relay: sourceRelay,
    } : null,
    authors,
    context: contextTag?.[1],
    comment: commentTag?.[1],
    createdAt: event.created_at,
  }
}

// ç²å–ç”¨æˆ¶æœ€è¿‘çš„ç²¾é¸
const myHighlights = await getUserHighlights('my-pubkey')
console.log('æˆ‘çš„ç²¾é¸:', myHighlights.map(h => parseHighlight(h)))`}</code></pre>
  </section>

  <!-- React Component -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">React å…ƒä»¶ç¯„ä¾‹</h2>
    <pre
      class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`import { useState } from 'react'

interface Highlight {
  content: string
  context?: string
  comment?: string
  source: {
    type: 'event' | 'address' | 'url'
    value: string
  }
  authors: { pubkey: string; role: string }[]
  createdAt: number
}

function HighlightCard({ highlight }: { highlight: Highlight }) {
  return (
    <div className="rounded-xl bg-gray-800 border border-gray-700 overflow-hidden">
      <div className="p-4">
        {/* ä¸Šä¸‹æ–‡ */}
        {highlight.context && (
          <p className="text-sm text-gray-500 mb-2 italic">
            {highlight.context}
          </p>
        )}

        {/* æ¨™è¨˜å…§å®¹ */}
        <blockquote className="border-l-4 border-purple-500 pl-4 py-2">
          <p className="text-white text-lg leading-relaxed">
            "{highlight.content}"
          </p>
        </blockquote>

        {/* è©•è«– */}
        {highlight.comment && (
          <div className="mt-4 p-3 bg-gray-700/50 rounded-lg">
            <p className="text-gray-300 text-sm">
              ğŸ’¬ {highlight.comment}
            </p>
          </div>
        )}

        {/* ä¾†æºèˆ‡ä½œè€… */}
        <div className="mt-4 flex items-center justify-between text-sm text-gray-500">
          <div className="flex items-center gap-2">
            {highlight.source.type === 'url' ? (
              <a
                href={highlight.source.value}
                target="_blank"
                rel="noopener noreferrer"
                className="hover:text-purple-400 truncate max-w-xs"
              >
                ğŸ”— {new URL(highlight.source.value).hostname}
              </a>
            ) : (
              <span>ğŸ“ Nostr å…§å®¹</span>
            )}
          </div>
          <span>
            {new Date(highlight.createdAt * 1000).toLocaleDateString()}
          </span>
        </div>
      </div>
    </div>
  )
}

// æ–‡å­—é¸å–æ¨™è¨˜å…ƒä»¶
function TextHighlighter({
  onHighlight
}: {
  onHighlight: (text: string, context: string) => void
}) {
  const [selectedText, setSelectedText] = useState('')

  const handleMouseUp = () => {
    const selection = window.getSelection()
    if (selection && selection.toString().trim()) {
      const text = selection.toString().trim()

      // ç²å–ä¸Šä¸‹æ–‡ï¼ˆå‰å¾Œ 50 å€‹å­—å…ƒï¼‰
      const range = selection.getRangeAt(0)
      const container = range.commonAncestorContainer
      const fullText = container.textContent || ''
      const startIndex = Math.max(0, fullText.indexOf(text) - 50)
      const endIndex = Math.min(fullText.length, fullText.indexOf(text) + text.length + 50)
      const context = fullText.slice(startIndex, endIndex)

      setSelectedText(text)
    }
  }

  const handleHighlight = () => {
    if (selectedText) {
      onHighlight(selectedText, '')
      setSelectedText('')
      window.getSelection()?.removeAllRanges()
    }
  }

  return (
    <div>
      <div onMouseUp={handleMouseUp}>
        {/* æ–‡ç« å…§å®¹æ”¾é€™è£¡ */}
      </div>

      {selectedText && (
        <div className="fixed bottom-4 left-1/2 -translate-x-1/2 bg-purple-600 text-white
                        px-4 py-2 rounded-full shadow-lg flex items-center gap-2">
          <span className="text-sm truncate max-w-xs">
            "{selectedText.slice(0, 30)}..."
          </span>
          <button
            onClick={handleHighlight}
            className="px-3 py-1 bg-white/20 rounded-full hover:bg-white/30"
          >
            âœ¨ æ¨™è¨˜
          </button>
        </div>
      )}
    </div>
  )
}`}</code></pre>
  </section>

  <!-- Use Cases -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ‡‰ç”¨å ´æ™¯</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ“š é–±è®€ç­†è¨˜</h4>
        <p class="text-sm text-[var(--text-secondary)]">é–±è®€é•·æ–‡æ™‚æ¨™è¨˜é‡é»æ®µè½ï¼Œå»ºç«‹å€‹äººçŸ¥è­˜åº«ã€‚</p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ’¬ å¼•ç”¨åˆ†äº«</h4>
        <p class="text-sm text-[var(--text-secondary)]">å¼•ç”¨ç²¾å½©æ®µè½ä¸¦åŠ ä¸Šè©•è«–ï¼Œåˆ†äº«çµ¦é—œæ³¨è€…ã€‚</p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ”– æ›¸ç±¤åŠŸèƒ½</h4>
        <p class="text-sm text-[var(--text-secondary)]">æ¯”å–®ç´”æ›¸ç±¤æ›´æœ‰åƒ¹å€¼ï¼Œä¿å­˜å…·é«”å…§å®¹ç‰‡æ®µã€‚</p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ“° å…§å®¹ç­–å±•</h4>
        <p class="text-sm text-[var(--text-secondary)]">ç­–å±•å„ªè³ªå…§å®¹ï¼Œå»ºç«‹ä¸»é¡Œç²¾é¸é›†ã€‚</p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ“ å­¸ç¿’å·¥å…·</h4>
        <p class="text-sm text-[var(--text-secondary)]">æ¨™è¨˜å­¸ç¿’ææ–™ä¸­çš„é‡é»ï¼Œæ–¹ä¾¿è¤‡ç¿’ã€‚</p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸŒ ç¶²é æ¨™è¨˜</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          æ¨™è¨˜ä»»ä½•ç¶²é å…§å®¹ï¼Œä¸é™æ–¼ Nostr åŸç”Ÿå…§å®¹ã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- Best Practices -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æœ€ä½³å¯¦è¸</h2>
    <div class="space-y-4">
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ æ¸…ç† URL è¿½è¹¤åƒæ•¸</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          å¼•ç”¨å¤–éƒ¨ URL æ™‚ï¼Œç§»é™¤ utm_* ç­‰è¿½è¹¤åƒæ•¸ï¼Œä¿æŒ URL ç°¡æ½”ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ æ·»åŠ ä½œè€…æ­¸å±¬</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ä½¿ç”¨ p æ¨™ç±¤æ¨™è¨˜åŸä½œè€…ï¼Œç‰¹åˆ¥æ˜¯å¼•ç”¨é Nostr å…§å®¹æ™‚ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ æä¾›ä¸Šä¸‹æ–‡</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ä½¿ç”¨ context æ¨™ç±¤æä¾›å‘¨åœå…§å®¹ï¼Œå¹«åŠ©è®€è€…ç†è§£æ¨™è¨˜çš„æ„ç¾©ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/20">
        <h4 class="font-semibold text-yellow-400 mb-2">âš  å¼•ç”¨è©•è«–çš„ç‰¹æ®Šè™•ç†</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ä½¿ç”¨ comment æ¨™ç±¤æ™‚ï¼Œå®¢æˆ¶ç«¯æ‡‰å°‡å…¶æ¸²æŸ“ç‚ºå¼•ç”¨è²¼æ–‡ï¼Œé¿å…åœ¨æ™‚é–“ç·šä¸Šç”¢ç”Ÿé‡è¤‡å…§å®¹ã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- Related NIPs -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ç›¸é—œ NIP</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <a
        href="/tech/nostr/nip-23"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-23 é•·æ–‡å…§å®¹</h4>
        <p class="text-sm text-[var(--text-secondary)]">å¸¸è¦‹çš„æ¨™è¨˜ä¾†æº</p>
      </a>
      <a
        href="/tech/nostr/nip-94"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-94 æª”æ¡ˆä¸­ç¹¼è³‡æ–™</h4>
        <p class="text-sm text-[var(--text-secondary)]">éŸ³è¨Š/è¦–è¨Šæ¨™è¨˜å¯èƒ½ç„¡æ–‡å­—å…§å®¹</p>
      </a>
      <a
        href="/tech/nostr/nip-51"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-51 åˆ—è¡¨</h4>
        <p class="text-sm text-[var(--text-secondary)]">å¯å°‡ç²¾é¸çµ„ç¹”æˆåˆ—è¡¨</p>
      </a>
      <a
        href="/tech/nostr/nip-18"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-18 è½‰ç™¼</h4>
        <p class="text-sm text-[var(--text-secondary)]">å¼•ç”¨è©•è«–é¡ä¼¼è½‰ç™¼è²¼æ–‡</p>
      </a>
    </div>
  </section>

  <!-- Summary -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ç¸½çµ</h2>
    <div class="p-6 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
      <p class="text-[var(--text-secondary)] mb-4">
        NIP-84 ç²¾é¸æ¨™è¨˜è®“ç”¨æˆ¶å¯ä»¥ä¿å­˜å’Œåˆ†äº«å…§å®¹ä¸­çš„ç²¾å½©ç‰‡æ®µã€‚ç„¡è«–æ˜¯ Nostr åŸç”Ÿå…§å®¹é‚„æ˜¯å¤–éƒ¨ç¶²é ï¼Œ
        éƒ½å¯ä»¥è¼•é¬†æ¨™è¨˜ä¸¦åŠ ä¸Šè©•è«–ã€‚é€™ç‚ºå…§å®¹æ¶ˆè²»å’ŒçŸ¥è­˜ç®¡ç†æä¾›äº†å¼·å¤§çš„å·¥å…·ã€‚
      </p>
      <div class="grid md:grid-cols-4 gap-4 text-center">
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-purple-400">Kind 9802</div>
          <div class="text-sm text-[var(--text-secondary)]">ç²¾é¸æ¨™è¨˜</div>
        </div>
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-blue-400">3 ç¨®</div>
          <div class="text-sm text-[var(--text-secondary)]">ä¾†æºé¡å‹</div>
        </div>
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-green-400">context</div>
          <div class="text-sm text-[var(--text-secondary)]">ä¸Šä¸‹æ–‡æ¨™ç±¤</div>
        </div>
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-orange-400">comment</div>
          <div class="text-sm text-[var(--text-secondary)]">å¼•ç”¨è©•è«–</div>
        </div>
      </div>
    </div>
  </section>
</ArticleLayout>
