---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="NIP-38: ç”¨æˆ¶ç‹€æ…‹"
  description="User Statuses - åˆ†äº«ç”¨æˆ¶çš„å³æ™‚æ´»å‹•ç‹€æ…‹"
  breadcrumbs={[
    { label: 'æŠ€è¡“', href: '/tech/' },
    { label: 'Nostr', href: '/tech/nostr/' },
    { label: 'NIP-38' },
  ]}
  difficulty="intermediate"
  readingTime="10 åˆ†é˜"
  tags={['Nostr', 'NIP-38', 'ç‹€æ…‹', 'status', 'music']}
  prevPage={{ title: 'NIP-36 æ•æ„Ÿå…§å®¹', href: '/tech/nostr/nip-36' }}
  nextPage={{ title: 'NIP-40 éæœŸæ™‚é–“æˆ³', href: '/tech/nostr/nip-40' }}
>
  <!-- Breadcrumb -->
  <nav class="flex items-center gap-2 text-sm text-[var(--text-tertiary)] mb-8 flex-wrap">
    <a href="/" class="hover:text-[var(--text-secondary)] transition-colors">é¦–é </a>
    <span>/</span>
    <a href="/tech" class="hover:text-[var(--text-secondary)] transition-colors">æŠ€è¡“</a>
    <span>/</span>
    <a href="/tech/nostr" class="hover:text-[var(--text-secondary)] transition-colors">Nostr</a>
    <span>/</span>
    <span class="text-[var(--text-primary)]">NIP-38</span>
  </nav>

  <!-- Introduction -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ¦‚è¿°</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      NIP-38 å®šç¾©äº†ç”¨æˆ¶ç‹€æ…‹äº‹ä»¶ï¼Œè®“ç”¨æˆ¶å¯ä»¥åˆ†äº«ä»–å€‘ç•¶å‰çš„æ´»å‹•ç‹€æ…‹ã€‚é€™é¡ä¼¼æ–¼å‚³çµ±ç¤¾äº¤å¹³å°çš„ã€Œæ­£åœ¨è½ã€ã€ã€Œæ­£åœ¨åšä»€éº¼ã€åŠŸèƒ½ï¼Œ
      ä½†ä»¥å»ä¸­å¿ƒåŒ–çš„æ–¹å¼å¯¦ç¾ã€‚ç‹€æ…‹å¯ä»¥æ˜¯ä¸€èˆ¬æ´»å‹•ã€æ­£åœ¨æ’­æ”¾çš„éŸ³æ¨‚ï¼Œæˆ–ä»»ä½•è‡ªå®šç¾©é¡å‹ã€‚
    </p>
    <div class="p-4 rounded-lg bg-purple-500/10 border border-purple-500/20">
      <p class="text-[var(--text-secondary)]">
        <strong class="text-purple-400">æ ¸å¿ƒæ¦‚å¿µï¼š</strong>
        ç”¨æˆ¶ç‹€æ…‹ä½¿ç”¨ kind 30315ï¼ˆå¯å®šå€äº‹ä»¶ï¼‰ï¼Œé€é <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">d</code> æ¨™ç±¤å€åˆ†ä¸åŒé¡å‹çš„ç‹€æ…‹ï¼Œ
        ä¸¦æ”¯æ´éæœŸæ™‚é–“è®“ç‹€æ…‹è‡ªå‹•æ¶ˆå¤±ã€‚
      </p>
    </div>
  </section>

  <!-- Event Structure -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">äº‹ä»¶çµæ§‹</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      ç”¨æˆ¶ç‹€æ…‹äº‹ä»¶ä½¿ç”¨ kind 30315ï¼Œæ˜¯å¯å®šå€äº‹ä»¶ï¼ˆaddressable eventï¼‰ï¼š
    </p>
    <div class="overflow-x-auto">
      <table class="w-full border-collapse mb-4">
        <thead>
          <tr class="border-b border-[var(--border-default)]">
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">æ¬„ä½</th>
            <th class="text-left py-3 px-4 text-[var(--text-primary)]">èªªæ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">kind</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">30315ï¼ˆç”¨æˆ¶ç‹€æ…‹ï¼‰</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">content</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">ç‹€æ…‹æ–‡å­—ï¼Œç©ºå­—ä¸²è¡¨ç¤ºæ¸…é™¤ç‹€æ…‹</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">d</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">ç‹€æ…‹é¡å‹æ¨™è­˜ç¬¦ï¼ˆå¿…è¦ï¼‰</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">expiration</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">éæœŸæ™‚é–“æˆ³ï¼ˆå¯é¸ï¼‰</td>
          </tr>
          <tr class="border-b border-[var(--border-default)]">
            <td class="py-3 px-4 font-mono text-purple-400">r</td>
            <td class="py-3 px-4 text-[var(--text-secondary)]">ç›¸é—œé€£çµ URLï¼ˆå¯é¸ï¼‰</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <!-- Status Types -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ç‹€æ…‹é¡å‹</h2>
    <p class="text-[var(--text-secondary)] mb-4">
      NIP-38 å®šç¾©äº†å…©ç¨®æ¨™æº–ç‹€æ…‹é¡å‹ï¼ŒåŒæ™‚å…è¨±è‡ªå®šç¾©é¡å‹ï¼š
    </p>

    <div class="grid md:grid-cols-2 gap-4 mb-6">
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2 flex items-center gap-2">
          <span class="text-2xl">ğŸ’¬</span> general
        </h4>
        <p class="text-sm text-[var(--text-secondary)] mb-2">
          ä¸€èˆ¬æ´»å‹•ç‹€æ…‹ï¼Œå¦‚ã€Œå·¥ä½œä¸­ã€ã€ã€Œæ—…è¡Œä¸­ã€ã€ã€Œé–‹æœƒä¸­ã€ç­‰ã€‚
        </p>
        <code class="text-xs px-2 py-1 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">d: "general"</code>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2 flex items-center gap-2">
          <span class="text-2xl">ğŸµ</span> music
        </h4>
        <p class="text-sm text-[var(--text-secondary)] mb-2">
          æ­£åœ¨æ’­æ”¾çš„éŸ³æ¨‚ï¼ŒéæœŸæ™‚é–“æ‡‰è¨­ç‚ºæ­Œæ›²çµæŸæ™‚é–“ã€‚
        </p>
        <code class="text-xs px-2 py-1 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">d: "music"</code>
      </div>
    </div>

    <div class="p-4 rounded-lg bg-blue-500/10 border border-blue-500/20">
      <p class="text-[var(--text-secondary)]">
        <strong class="text-blue-400">è‡ªå®šç¾©é¡å‹ï¼š</strong>
        é™¤äº†æ¨™æº–é¡å‹å¤–ï¼Œæ‡‰ç”¨å¯ä»¥å®šç¾©è‡ªå·±çš„ç‹€æ…‹é¡å‹ï¼Œå¦‚ <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">gaming</code>ã€
        <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">reading</code>ã€
        <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">streaming</code> ç­‰ã€‚
      </p>
    </div>
  </section>

  <!-- Examples -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ä½¿ç”¨ç¯„ä¾‹</h2>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">ä¸€èˆ¬ç‹€æ…‹</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 30315,
  "tags": [
    ["d", "general"]
  ],
  "content": "æ­£åœ¨å¯«ç¨‹å¼ ğŸ‘¨â€ğŸ’»"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">å¸¶é€£çµçš„ç‹€æ…‹</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 30315,
  "tags": [
    ["d", "general"],
    ["r", "https://github.com/nostr-protocol/nips"]
  ],
  "content": "æ­£åœ¨ç ”ç©¶ Nostr NIPs"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">éŸ³æ¨‚ç‹€æ…‹ï¼ˆå¸¶éæœŸæ™‚é–“ï¼‰</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 30315,
  "tags": [
    ["d", "music"],
    ["r", "spotify:track:4PTG3Z6ehGkBFwjybzWkR8"],
    ["expiration", "1704067200"]
  ],
  "content": "ğŸµ Never Gonna Give You Up - Rick Astley"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">å¸¶è‡ªè¨‚è¡¨æƒ…çš„ç‹€æ…‹</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 30315,
  "tags": [
    ["d", "general"],
    ["emoji", "bitcoin", "https://example.com/bitcoin.png"]
  ],
  "content": "Stacking sats :bitcoin:"
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">å¼•ç”¨å…¶ä»–å…§å®¹</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 30315,
  "tags": [
    ["d", "general"],
    ["e", "<event-id>", "wss://relay.example.com"],
    ["p", "<author-pubkey>"]
  ],
  "content": "æ­£åœ¨é–±è®€é€™ç¯‡ç²¾å½©çš„æ–‡ç« "
}`}</code></pre>

    <h3 class="text-lg font-semibold text-[var(--text-primary)] mb-3">æ¸…é™¤ç‹€æ…‹</h3>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-6"><code class="text-sm text-gray-300">{`{
  "kind": 30315,
  "tags": [
    ["d", "general"]
  ],
  "content": ""
}`}</code></pre>
  </section>

  <!-- TypeScript Implementation -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">TypeScript å¯¦ä½œ</h2>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`import { finalizeEvent, generateSecretKey, getPublicKey } from 'nostr-tools'

// ç‹€æ…‹é¡å‹
type StatusType = 'general' | 'music' | string

interface StatusOptions {
  type: StatusType
  content: string
  url?: string
  expiration?: number
  eventRef?: { id: string; relay?: string }
  profileRef?: string
  emoji?: { shortcode: string; url: string }[]
}

// å‰µå»ºç”¨æˆ¶ç‹€æ…‹äº‹ä»¶
function createStatusEvent(
  options: StatusOptions,
  secretKey: Uint8Array
): object {
  const tags: string[][] = [['d', options.type]]

  // æ·»åŠ  URL é€£çµ
  if (options.url) {
    tags.push(['r', options.url])
  }

  // æ·»åŠ éæœŸæ™‚é–“
  if (options.expiration) {
    tags.push(['expiration', options.expiration.toString()])
  }

  // æ·»åŠ äº‹ä»¶å¼•ç”¨
  if (options.eventRef) {
    tags.push(['e', options.eventRef.id, options.eventRef.relay || ''])
  }

  // æ·»åŠ ç”¨æˆ¶å¼•ç”¨
  if (options.profileRef) {
    tags.push(['p', options.profileRef])
  }

  // æ·»åŠ è‡ªè¨‚è¡¨æƒ…
  if (options.emoji) {
    for (const e of options.emoji) {
      tags.push(['emoji', e.shortcode, e.url])
    }
  }

  const event = {
    kind: 30315,
    created_at: Math.floor(Date.now() / 1000),
    tags,
    content: options.content,
  }

  return finalizeEvent(event, secretKey)
}

// è¨­ç½®ä¸€èˆ¬ç‹€æ…‹
function setGeneralStatus(
  content: string,
  secretKey: Uint8Array,
  options?: { url?: string; expiration?: number }
): object {
  return createStatusEvent({
    type: 'general',
    content,
    ...options,
  }, secretKey)
}

// è¨­ç½®éŸ³æ¨‚ç‹€æ…‹
function setMusicStatus(
  track: string,
  artist: string,
  secretKey: Uint8Array,
  options?: { url?: string; durationSeconds?: number }
): object {
  const expiration = options?.durationSeconds
    ? Math.floor(Date.now() / 1000) + options.durationSeconds
    : undefined

  return createStatusEvent({
    type: 'music',
    content: \`ğŸµ \${track} - \${artist}\`,
    url: options?.url,
    expiration,
  }, secretKey)
}

// æ¸…é™¤ç‹€æ…‹
function clearStatus(
  type: StatusType,
  secretKey: Uint8Array
): object {
  return createStatusEvent({
    type,
    content: '',
  }, secretKey)
}

// ä½¿ç”¨ç¯„ä¾‹
const sk = generateSecretKey()
const pk = getPublicKey(sk)

// è¨­ç½®ä¸€èˆ¬ç‹€æ…‹
const generalStatus = setGeneralStatus(
  'æ­£åœ¨é–‹ç™¼ Nostr å®¢æˆ¶ç«¯ ğŸš€',
  sk,
  { url: 'https://github.com/myproject' }
)

// è¨­ç½®éŸ³æ¨‚ç‹€æ…‹ï¼ˆæ­Œæ›²é•·åº¦ 3 åˆ† 30 ç§’ï¼‰
const musicStatus = setMusicStatus(
  'Bohemian Rhapsody',
  'Queen',
  sk,
  {
    url: 'spotify:track:7tFiyTwD0nx5a1eklYtX2J',
    durationSeconds: 210,
  }
)

// è¨­ç½®å¸¶è¡¨æƒ…çš„ç‹€æ…‹
const emojiStatus = createStatusEvent({
  type: 'general',
  content: 'HODLing :bitcoin: forever!',
  emoji: [
    { shortcode: 'bitcoin', url: 'https://example.com/bitcoin.png' }
  ],
}, sk)

// æ¸…é™¤ç‹€æ…‹
const cleared = clearStatus('general', sk)

console.log('General status:', generalStatus)
console.log('Music status:', musicStatus)
console.log('Emoji status:', emojiStatus)
console.log('Cleared:', cleared)`}</code></pre>
  </section>

  <!-- Query Status -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æŸ¥è©¢ç‹€æ…‹</h2>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`import { SimplePool } from 'nostr-tools'

const pool = new SimplePool()
const relays = ['wss://relay.example.com']

// æŸ¥è©¢ç”¨æˆ¶çš„æ‰€æœ‰ç‹€æ…‹
async function getUserStatuses(pubkey: string) {
  const statuses = await pool.querySync(relays, {
    kinds: [30315],
    authors: [pubkey],
  })
  return statuses
}

// æŸ¥è©¢ç‰¹å®šé¡å‹çš„ç‹€æ…‹
async function getUserStatusByType(pubkey: string, type: string) {
  const statuses = await pool.querySync(relays, {
    kinds: [30315],
    authors: [pubkey],
    '#d': [type],
  })
  return statuses[0] || null
}

// æŸ¥è©¢å¤šå€‹ç”¨æˆ¶çš„ä¸€èˆ¬ç‹€æ…‹
async function getGeneralStatuses(pubkeys: string[]) {
  const statuses = await pool.querySync(relays, {
    kinds: [30315],
    authors: pubkeys,
    '#d': ['general'],
  })
  return statuses
}

// æŸ¥è©¢æ­£åœ¨è½éŸ³æ¨‚çš„ç”¨æˆ¶
async function getMusicStatuses(pubkeys: string[]) {
  const statuses = await pool.querySync(relays, {
    kinds: [30315],
    authors: pubkeys,
    '#d': ['music'],
  })

  // éæ¿¾æ‰å·²éæœŸçš„ç‹€æ…‹
  const now = Math.floor(Date.now() / 1000)
  return statuses.filter(status => {
    const expTag = status.tags.find((t: string[]) => t[0] === 'expiration')
    if (!expTag) return true
    return parseInt(expTag[1]) > now
  })
}

// è§£æç‹€æ…‹äº‹ä»¶
function parseStatus(event: any): {
  type: string
  content: string
  url?: string
  expiration?: number
  isExpired: boolean
} {
  const type = event.tags.find((t: string[]) => t[0] === 'd')?.[1] || 'general'
  const url = event.tags.find((t: string[]) => t[0] === 'r')?.[1]
  const expTag = event.tags.find((t: string[]) => t[0] === 'expiration')
  const expiration = expTag ? parseInt(expTag[1]) : undefined
  const isExpired = expiration ? expiration < Math.floor(Date.now() / 1000) : false

  return {
    type,
    content: event.content,
    url,
    expiration,
    isExpired,
  }
}

// è¨‚é–±ç‹€æ…‹æ›´æ–°
function subscribeToStatuses(
  pubkeys: string[],
  onStatus: (event: any, parsed: ReturnType<typeof parseStatus>) => void
) {
  return pool.subscribeMany(
    relays,
    [{
      kinds: [30315],
      authors: pubkeys,
    }],
    {
      onevent(event) {
        const parsed = parseStatus(event)
        if (!parsed.isExpired && parsed.content) {
          onStatus(event, parsed)
        }
      },
    }
  )
}

// ä½¿ç”¨ç¯„ä¾‹
const targetPubkey = 'abc123...'

// ç²å–ç”¨æˆ¶çš„ä¸€èˆ¬ç‹€æ…‹
const generalStatus = await getUserStatusByType(targetPubkey, 'general')
if (generalStatus) {
  const parsed = parseStatus(generalStatus)
  console.log(\`ç‹€æ…‹: \${parsed.content}\`)
  if (parsed.url) {
    console.log(\`é€£çµ: \${parsed.url}\`)
  }
}

// è¨‚é–±é—œæ³¨åˆ—è¡¨çš„ç‹€æ…‹
const followingPubkeys = ['pubkey1', 'pubkey2', 'pubkey3']
const sub = subscribeToStatuses(followingPubkeys, (event, parsed) => {
  console.log(\`\${event.pubkey} çš„ \${parsed.type} ç‹€æ…‹: \${parsed.content}\`)
})`}</code></pre>
  </section>

  <!-- Use Cases -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æ‡‰ç”¨å ´æ™¯</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸµ éŸ³æ¨‚åˆ†äº«</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          èˆ‡ Spotifyã€Apple Music ç­‰æ•´åˆï¼Œè‡ªå‹•åˆ†äº«æ­£åœ¨è½çš„æ­Œæ›²ï¼ŒéæœŸæ™‚é–“è¨­ç‚ºæ­Œæ›²é•·åº¦ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ“… æ—¥æ›†æ•´åˆ</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          æ—¥æ›†æ‡‰ç”¨è‡ªå‹•æ›´æ–°ç‹€æ…‹ç‚ºã€Œé–‹æœƒä¸­ã€ã€ã€Œå¿™ç¢Œã€ç­‰ï¼ŒéæœŸæ™‚é–“è¨­ç‚ºæœƒè­°çµæŸæ™‚é–“ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ™ï¸ ç›´æ’­/èªéŸ³æˆ¿</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          Nostr Nests ç­‰èªéŸ³æˆ¿æ‡‰ç”¨å¯ä»¥é¡¯ç¤ºç”¨æˆ¶æ­£åœ¨åƒèˆ‡çš„æˆ¿é–“é€£çµã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ® éŠæˆ²ç‹€æ…‹</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          é¡¯ç¤ºæ­£åœ¨ç©çš„éŠæˆ²ï¼Œé‚€è«‹æœ‹å‹ä¸€èµ·ç©ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ§ Podcast åˆ†äº«</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          Podcast æ‡‰ç”¨åˆ†äº«æ­£åœ¨æ”¶è½çš„ç¯€ç›®ï¼Œæ–¹ä¾¿æœ‹å‹ç™¼ç¾å¥½å…§å®¹ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
        <h4 class="font-semibold text-[var(--text-primary)] mb-2">ğŸ“ ä½ç½®åˆ†äº«</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          åˆ†äº«ç•¶å‰ä½ç½®æˆ–æ—…è¡Œç‹€æ…‹ï¼Œå¦‚ã€Œåœ¨æ±äº¬æ—…è¡Œã€ã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- React Component Example -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">React å…ƒä»¶ç¯„ä¾‹</h2>
    <pre class="p-4 rounded-lg bg-[var(--bg-darkest)] overflow-x-auto mb-4"><code class="text-sm text-gray-300">{`import { useState, useEffect } from 'react'
import { SimplePool } from 'nostr-tools'

interface UserStatusProps {
  pubkey: string
  relays: string[]
}

interface Status {
  type: string
  content: string
  url?: string
  isExpired: boolean
}

function UserStatus({ pubkey, relays }: UserStatusProps) {
  const [statuses, setStatuses] = useState<Map<string, Status>>(new Map())
  const pool = new SimplePool()

  useEffect(() => {
    const sub = pool.subscribeMany(
      relays,
      [{
        kinds: [30315],
        authors: [pubkey],
      }],
      {
        onevent(event) {
          const type = event.tags.find(t => t[0] === 'd')?.[1] || 'general'
          const url = event.tags.find(t => t[0] === 'r')?.[1]
          const expTag = event.tags.find(t => t[0] === 'expiration')
          const expiration = expTag ? parseInt(expTag[1]) : undefined
          const isExpired = expiration
            ? expiration < Math.floor(Date.now() / 1000)
            : false

          if (!isExpired && event.content) {
            setStatuses(prev => new Map(prev).set(type, {
              type,
              content: event.content,
              url,
              isExpired,
            }))
          }
        },
      }
    )

    return () => sub.close()
  }, [pubkey, relays])

  if (statuses.size === 0) return null

  return (
    <div className="space-y-2">
      {Array.from(statuses.entries()).map(([type, status]) => (
        <div
          key={type}
          className="flex items-center gap-2 text-sm text-gray-400"
        >
          <StatusIcon type={type} />
          {status.url ? (
            <a
              href={status.url}
              target="_blank"
              rel="noopener noreferrer"
              className="hover:text-purple-400"
            >
              {status.content}
            </a>
          ) : (
            <span>{status.content}</span>
          )}
        </div>
      ))}
    </div>
  )
}

function StatusIcon({ type }: { type: string }) {
  switch (type) {
    case 'music':
      return <span>ğŸµ</span>
    case 'gaming':
      return <span>ğŸ®</span>
    case 'streaming':
      return <span>ğŸ™ï¸</span>
    default:
      return <span>ğŸ’¬</span>
  }
}

// ç‹€æ…‹è¨­ç½®å…ƒä»¶
function StatusSetter({ onSubmit }: { onSubmit: (status: StatusOptions) => void }) {
  const [type, setType] = useState('general')
  const [content, setContent] = useState('')
  const [url, setUrl] = useState('')

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault()
    onSubmit({
      type,
      content,
      url: url || undefined,
    })
    setContent('')
    setUrl('')
  }

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      <select
        value={type}
        onChange={e => setType(e.target.value)}
        className="w-full p-2 rounded bg-gray-800 border border-gray-700"
      >
        <option value="general">ğŸ’¬ ä¸€èˆ¬</option>
        <option value="music">ğŸµ éŸ³æ¨‚</option>
        <option value="gaming">ğŸ® éŠæˆ²</option>
        <option value="streaming">ğŸ™ï¸ ç›´æ’­</option>
      </select>

      <input
        type="text"
        value={content}
        onChange={e => setContent(e.target.value)}
        placeholder="ä½ åœ¨åšä»€éº¼ï¼Ÿ"
        className="w-full p-2 rounded bg-gray-800 border border-gray-700"
      />

      <input
        type="url"
        value={url}
        onChange={e => setUrl(e.target.value)}
        placeholder="ç›¸é—œé€£çµï¼ˆå¯é¸ï¼‰"
        className="w-full p-2 rounded bg-gray-800 border border-gray-700"
      />

      <button
        type="submit"
        disabled={!content}
        className="w-full py-2 px-4 bg-purple-600 hover:bg-purple-700
                   disabled:opacity-50 rounded font-medium"
      >
        æ›´æ–°ç‹€æ…‹
      </button>
    </form>
  )
}`}</code></pre>
  </section>

  <!-- Best Practices -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">æœ€ä½³å¯¦è¸</h2>
    <div class="space-y-4">
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ è¨­ç½®é©ç•¶çš„éæœŸæ™‚é–“</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          å°æ–¼éŸ³æ¨‚ç­‰è‡¨æ™‚ç‹€æ…‹ï¼Œè¨­ç½®åˆç†çš„éæœŸæ™‚é–“è®“ç‹€æ…‹è‡ªå‹•æ¶ˆå¤±ï¼Œé¿å…é¡¯ç¤ºéæ™‚è³‡è¨Šã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ ä½¿ç”¨æ¨™æº–é¡å‹</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          å„ªå…ˆä½¿ç”¨ <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">general</code> å’Œ
          <code class="px-1 py-0.5 rounded bg-[var(--inline-code-bg)] text-[var(--inline-code-text)]">music</code>
          ç­‰æ¨™æº–é¡å‹ï¼Œç¢ºä¿è·¨å®¢æˆ¶ç«¯ç›¸å®¹æ€§ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/20">
        <h4 class="font-semibold text-green-400 mb-2">âœ“ æä¾›æœ‰ç”¨çš„é€£çµ</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ç•¶ç‹€æ…‹æœ‰ç›¸é—œé€£çµæ™‚ï¼ˆå¦‚éŸ³æ¨‚ URLã€ç›´æ’­é–“é€£çµï¼‰ï¼Œä½¿ç”¨ r æ¨™ç±¤æä¾›é€£çµè®“å…¶ä»–ç”¨æˆ¶å¯ä»¥åƒèˆ‡ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/20">
        <h4 class="font-semibold text-yellow-400 mb-2">âš  å®¢æˆ¶ç«¯æ‡‰éæ¿¾éæœŸç‹€æ…‹</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          ä¸­ç¹¼å™¨å¯èƒ½ä¸æœƒè‡ªå‹•åˆªé™¤éæœŸäº‹ä»¶ï¼Œå®¢æˆ¶ç«¯æ‡‰æª¢æŸ¥ expiration æ¨™ç±¤ä¸¦éæ¿¾å·²éæœŸçš„ç‹€æ…‹ã€‚
        </p>
      </div>
      <div class="p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/20">
        <h4 class="font-semibold text-yellow-400 mb-2">âš  ç©ºå…§å®¹æ¸…é™¤ç‹€æ…‹</h4>
        <p class="text-sm text-[var(--text-secondary)]">
          è¦æ¸…é™¤ç‹€æ…‹ï¼Œç™¼é€ç›¸åŒé¡å‹ä½† content ç‚ºç©ºå­—ä¸²çš„äº‹ä»¶ã€‚å®¢æˆ¶ç«¯æ‡‰å°‡ç©ºå…§å®¹è¦–ç‚ºç„¡ç‹€æ…‹ã€‚
        </p>
      </div>
    </div>
  </section>

  <!-- Related NIPs -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ç›¸é—œ NIP</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <a
        href="/tech/nostr/nip-30"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-30 è‡ªè¨‚è¡¨æƒ…</h4>
        <p class="text-sm text-[var(--text-secondary)]">ç‹€æ…‹å…§å®¹å¯ä½¿ç”¨è‡ªè¨‚è¡¨æƒ…</p>
      </a>
      <a
        href="/tech/nostr/nip-40"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-40 éæœŸæ™‚é–“æˆ³</h4>
        <p class="text-sm text-[var(--text-secondary)]">å®šç¾©äº‹ä»¶éæœŸæ©Ÿåˆ¶</p>
      </a>
      <a
        href="/tech/nostr/nip-01"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-01 åŸºæœ¬å”è­°</h4>
        <p class="text-sm text-[var(--text-secondary)]">å¯å®šå€äº‹ä»¶çš„åŸºç¤è¦ç¯„</p>
      </a>
      <a
        href="/tech/nostr/nip-02"
        class="p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] hover:border-purple-500/50 transition-colors"
      >
        <h4 class="font-semibold text-[var(--text-primary)] mb-1">NIP-02 è¯çµ¡äººåˆ—è¡¨</h4>
        <p class="text-sm text-[var(--text-secondary)]">è¿½è¹¤é—œæ³¨è€…çš„ç‹€æ…‹</p>
      </a>
    </div>
  </section>

  <!-- Summary -->
  <section class="mb-12">
    <h2 class="text-2xl font-bold text-[var(--text-primary)] mb-4">ç¸½çµ</h2>
    <div class="p-6 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
      <p class="text-[var(--text-secondary)] mb-4">
        NIP-38 ç”¨æˆ¶ç‹€æ…‹æä¾›äº†ä¸€ç¨®ç°¡å–®è€Œéˆæ´»çš„æ–¹å¼ï¼Œè®“ç”¨æˆ¶åˆ†äº«ä»–å€‘çš„å³æ™‚æ´»å‹•ã€‚
        é€éæ¨™æº–åŒ–çš„ç‹€æ…‹é¡å‹å’ŒéæœŸæ©Ÿåˆ¶ï¼Œæ‡‰ç”¨å¯ä»¥æ•´åˆå„ç¨®æœå‹™ä¾†è‡ªå‹•æ›´æ–°ç”¨æˆ¶ç‹€æ…‹ã€‚
      </p>
      <div class="grid md:grid-cols-3 gap-4 text-center">
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-purple-400">Kind 30315</div>
          <div class="text-sm text-[var(--text-secondary)]">å¯å®šå€ç‹€æ…‹äº‹ä»¶</div>
        </div>
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-blue-400">d æ¨™ç±¤</div>
          <div class="text-sm text-[var(--text-secondary)]">å€åˆ†ç‹€æ…‹é¡å‹</div>
        </div>
        <div class="p-3 rounded-lg bg-[var(--bg-primary)]">
          <div class="text-2xl font-bold text-green-400">è‡ªå‹•éæœŸ</div>
          <div class="text-sm text-[var(--text-secondary)]">expiration æ¨™ç±¤</div>
        </div>
      </div>
    </div>
  </section>
</ArticleLayout>
