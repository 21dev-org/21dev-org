---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="NIP-39: å¤–éƒ¨èº«ä»½é©—è­‰"
  description="åœ¨ Nostr å€‹äººè³‡æ–™ä¸­é€£çµä¸¦é©—è­‰å¤–éƒ¨å¹³å°èº«ä»½"
  pubDate={new Date()}
>
  <h2 id="overview">æ¦‚è¿°</h2>
  <p>
    NIP-39 å®šç¾©äº†ä¸€ç¨®åœ¨ Nostr å€‹äººè³‡æ–™ï¼ˆkind 0ï¼‰ä¸­è²æ˜ä¸¦é©—è­‰å¤–éƒ¨å¹³å°èº«ä»½çš„æ–¹æ³•ã€‚
    ç”¨æˆ¶å¯ä»¥å°‡ GitHubã€Twitterã€Mastodonã€Telegram ç­‰å¸³è™Ÿé€£çµåˆ° Nostr èº«ä»½ï¼Œ
    ä¸¦æä¾›å¯é©—è­‰çš„è­‰æ˜è®“å…¶ä»–äººç¢ºèªé€™äº›å¸³è™Ÿç¢ºå¯¦å±¬æ–¼åŒä¸€äººã€‚
  </p>

  <h2 id="tag-format">æ¨™ç±¤æ ¼å¼</h2>
  <p>
    NIP-39 åœ¨ kind 0 äº‹ä»¶ä¸­å¼•å…¥äº† <code>i</code> æ¨™ç±¤ï¼Œæ¯å€‹æ¨™ç±¤åŒ…å«å…©å€‹åƒæ•¸ï¼š
  </p>

  <pre><code class="language-json">["i", "å¹³å°:èº«ä»½", "è­‰æ˜"]</code></pre>

  <table>
    <thead>
      <tr>
        <th>åƒæ•¸</th>
        <th>èªªæ˜</th>
        <th>ç¯„ä¾‹</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>å¹³å°:èº«ä»½</td>
        <td>å¹³å°åç¨±èˆ‡ç”¨æˆ¶åä»¥ <code>:</code> é€£æ¥</td>
        <td><code>github:satoshi</code></td>
      </tr>
      <tr>
        <td>è­‰æ˜</td>
        <td>æŒ‡å‘æ‰€æœ‰æ¬Šé©—è­‰çš„å­—ä¸²æˆ–ç‰©ä»¶</td>
        <td>Gist IDã€Tweet ID ç­‰</td>
      </tr>
    </tbody>
  </table>

  <div class="not-prose my-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
    <p class="text-sm text-blue-800 dark:text-blue-200">
      <strong>å‘½åè¦ç¯„ï¼š</strong>å¹³å°åç¨±åªèƒ½åŒ…å« <code>a-z</code>ã€<code>0-9</code> å’Œ <code>._-/</code> å­—å…ƒï¼Œ
      ä¸èƒ½åŒ…å«å†’è™Ÿã€‚èº«ä»½æ‡‰è©²æ­£è¦åŒ–ç‚ºå°å¯«ã€‚
    </p>
  </div>

  <h2 id="profile-example">å€‹äººè³‡æ–™ç¯„ä¾‹</h2>
  <pre><code class="language-json">{
  "kind": 0,
  "content": "{\"name\":\"satoshi\",\"about\":\"Bitcoin creator\",\"picture\":\"...\"}",
  "tags": [
    ["i", "github:satoshi", "abc123def456"],
    ["i", "twitter:sataboroshi", "1234567890123456789"],
    ["i", "mastodon:bitcoinhackers.org/@satoshi", "109876543210"],
    ["i", "telegram:123456789", "bitcoin_channel/42"]
  ]
}</code></pre>

  <h2 id="supported-platforms">æ”¯æ´å¹³å°</h2>

  <h3 id="github">GitHub</h3>
  <table>
    <tbody>
      <tr>
        <td><strong>èº«ä»½æ ¼å¼</strong></td>
        <td>GitHub ç”¨æˆ¶å</td>
      </tr>
      <tr>
        <td><strong>è­‰æ˜æ ¼å¼</strong></td>
        <td>Gist ID</td>
      </tr>
      <tr>
        <td><strong>é©—è­‰ä½ç½®</strong></td>
        <td><code>https://gist.github.com/&lt;username&gt;/&lt;gist-id&gt;</code></td>
      </tr>
    </tbody>
  </table>

  <p>Gist å…§å®¹å¿…é ˆåŒ…å«é©—è­‰ Nostr å…¬é‘°æ‰€æœ‰æ¬Šçš„æ–‡å­—ï¼š</p>
  <pre><code class="language-text">Verifying my Nostr public key: npub1xxx...

This gist proves I control both this GitHub account and the Nostr key above.</code></pre>

  <p>æ¨™ç±¤ç¯„ä¾‹ï¼š</p>
  <pre><code class="language-json">["i", "github:satoshi", "abc123def456789"]</code></pre>

  <h3 id="twitter">Twitter / X</h3>
  <table>
    <tbody>
      <tr>
        <td><strong>èº«ä»½æ ¼å¼</strong></td>
        <td>Twitter ç”¨æˆ¶å</td>
      </tr>
      <tr>
        <td><strong>è­‰æ˜æ ¼å¼</strong></td>
        <td>Tweet ID</td>
      </tr>
      <tr>
        <td><strong>é©—è­‰ä½ç½®</strong></td>
        <td><code>https://twitter.com/&lt;username&gt;/status/&lt;tweet-id&gt;</code></td>
      </tr>
    </tbody>
  </table>

  <p>æ¨æ–‡å¿…é ˆåŒ…å« npub ç·¨ç¢¼çš„å…¬é‘°ï¼š</p>
  <pre><code class="language-text">Verifying my Nostr identity: npub1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq...</code></pre>

  <p>æ¨™ç±¤ç¯„ä¾‹ï¼š</p>
  <pre><code class="language-json">["i", "twitter:jack", "1234567890123456789"]</code></pre>

  <h3 id="mastodon">Mastodon</h3>
  <table>
    <tbody>
      <tr>
        <td><strong>èº«ä»½æ ¼å¼</strong></td>
        <td><code>&lt;instance&gt;/@&lt;username&gt;</code></td>
      </tr>
      <tr>
        <td><strong>è­‰æ˜æ ¼å¼</strong></td>
        <td>è²¼æ–‡ ID</td>
      </tr>
      <tr>
        <td><strong>é©—è­‰ä½ç½®</strong></td>
        <td><code>https://&lt;instance&gt;/@&lt;username&gt;/&lt;post-id&gt;</code></td>
      </tr>
    </tbody>
  </table>

  <p>æ¨™ç±¤ç¯„ä¾‹ï¼š</p>
  <pre><code class="language-json">["i", "mastodon:bitcoinhackers.org/@satoshi", "109876543210987654"]</code></pre>

  <h3 id="telegram">Telegram</h3>
  <table>
    <tbody>
      <tr>
        <td><strong>èº«ä»½æ ¼å¼</strong></td>
        <td>Telegram ç”¨æˆ¶ IDï¼ˆæ•¸å­—ï¼‰</td>
      </tr>
      <tr>
        <td><strong>è­‰æ˜æ ¼å¼</strong></td>
        <td><code>&lt;channel-or-group&gt;/&lt;message-id&gt;</code></td>
      </tr>
      <tr>
        <td><strong>é©—è­‰ä½ç½®</strong></td>
        <td><code>https://t.me/&lt;channel-or-group&gt;/&lt;message-id&gt;</code></td>
      </tr>
    </tbody>
  </table>

  <p>è­‰æ˜å¿…é ˆæ˜¯å…¬é–‹é »é“æˆ–ç¾¤çµ„ä¸­çš„è¨Šæ¯ï¼Œè©²ç”¨æˆ¶ç™¼å¸ƒçš„è¨Šæ¯åŒ…å«å…¶ npubï¼š</p>
  <pre><code class="language-json">["i", "telegram:123456789", "bitcoin_channel/42"]</code></pre>

  <h2 id="verification-flow">é©—è­‰æµç¨‹</h2>
  <ol>
    <li><strong>ç”¨æˆ¶åœ¨å¤–éƒ¨å¹³å°ç™¼å¸ƒè­‰æ˜</strong>ï¼šåœ¨ GitHub Gistã€Twitter æ¨æ–‡ç­‰å¹³å°ç™¼å¸ƒåŒ…å« npub çš„é©—è­‰è¨Šæ¯</li>
    <li><strong>ç”¨æˆ¶æ›´æ–° Nostr å€‹äººè³‡æ–™</strong>ï¼šåœ¨ kind 0 äº‹ä»¶ä¸­æ·»åŠ  <code>i</code> æ¨™ç±¤</li>
    <li><strong>å®¢æˆ¶ç«¯æŠ“å–è­‰æ˜</strong>ï¼šæ ¹æ“šæ¨™ç±¤ä¸­çš„å¹³å°å’Œè­‰æ˜ ID æ§‹å»º URL</li>
    <li><strong>å®¢æˆ¶ç«¯é©—è­‰</strong>ï¼šæª¢æŸ¥è­‰æ˜å…§å®¹æ˜¯å¦åŒ…å«æ­£ç¢ºçš„ npub</li>
    <li><strong>é¡¯ç¤ºé©—è­‰ç‹€æ…‹</strong>ï¼šå‘å…¶ä»–ç”¨æˆ¶å±•ç¤ºå·²é©—è­‰çš„å¤–éƒ¨èº«ä»½</li>
  </ol>

  <h2 id="implementation">TypeScript å¯¦ä½œ</h2>

  <h3>å»ºç«‹å¸¶æœ‰å¤–éƒ¨èº«ä»½çš„å€‹äººè³‡æ–™</h3>
  <pre><code class="language-typescript">import { finalizeEvent, generateSecretKey, getPublicKey, nip19 } from 'nostr-tools';

interface ExternalIdentity {
  platform: 'github' | 'twitter' | 'mastodon' | 'telegram' | string;
  identity: string;
  proof: string;
}

interface ProfileWithIdentities {
  name?: string;
  about?: string;
  picture?: string;
  nip05?: string;
  lud16?: string;
  identities: ExternalIdentity[];
}

function createProfileEvent(
  profile: ProfileWithIdentities,
  secretKey: Uint8Array
) {
  const { identities, ...metadata } = profile;

  // å»ºç«‹ i æ¨™ç±¤
  const iTags = identities.map((id) => [
    'i',
    `${id.platform}:${id.identity.toLowerCase()}`,
    id.proof,
  ]);

  const event = {
    kind: 0,
    content: JSON.stringify(metadata),
    tags: iTags,
    created_at: Math.floor(Date.now() / 1000),
  };

  return finalizeEvent(event, secretKey);
}

// ä½¿ç”¨ç¯„ä¾‹
const sk = generateSecretKey();
const pk = getPublicKey(sk);
const npub = nip19.npubEncode(pk);

console.log('åœ¨å¤–éƒ¨å¹³å°ç™¼å¸ƒæ­¤é©—è­‰è¨Šæ¯ï¼š');
console.log(`Verifying my Nostr identity: ${npub}`);

const profileEvent = createProfileEvent(
  {
    name: 'Satoshi',
    about: 'Building the future',
    picture: 'https://example.com/avatar.jpg',
    nip05: 'satoshi@example.com',
    identities: [
      {
        platform: 'github',
        identity: 'satoshi',
        proof: 'abc123def456',
      },
      {
        platform: 'twitter',
        identity: 'satoshi',
        proof: '1234567890123456789',
      },
    ],
  },
  sk
);

console.log(profileEvent);</code></pre>

  <h3>è§£æå¤–éƒ¨èº«ä»½</h3>
  <pre><code class="language-typescript">interface ParsedIdentity {
  platform: string;
  identity: string;
  proof: string;
  verificationUrl: string;
}

function parseExternalIdentities(event: any): ParsedIdentity[] {
  if (event.kind !== 0) {
    return [];
  }

  const iTags = event.tags.filter((t: string[]) => t[0] === 'i');

  return iTags.map((tag: string[]) => {
    const [platform, identity] = tag[1].split(':');
    const proof = tag[2];

    return {
      platform,
      identity,
      proof,
      verificationUrl: buildVerificationUrl(platform, identity, proof),
    };
  });
}

function buildVerificationUrl(
  platform: string,
  identity: string,
  proof: string
): string {
  switch (platform) {
    case 'github':
      return `https://gist.github.com/${identity}/${proof}`;

    case 'twitter':
      return `https://twitter.com/${identity}/status/${proof}`;

    case 'mastodon':
      // identity æ ¼å¼ç‚º instance/@username
      return `https://${identity}/${proof}`;

    case 'telegram':
      // proof æ ¼å¼ç‚º channel/message-id
      return `https://t.me/${proof}`;

    default:
      return '';
  }
}

// ä½¿ç”¨ç¯„ä¾‹
const identities = parseExternalIdentities(profileEvent);
identities.forEach((id) => {
  console.log(`${id.platform}: ${id.identity}`);
  console.log(`é©—è­‰é€£çµ: ${id.verificationUrl}`);
});</code></pre>

  <h3>é©—è­‰å¤–éƒ¨èº«ä»½</h3>
  <pre><code class="language-typescript">import { nip19 } from 'nostr-tools';

interface VerificationResult {
  platform: string;
  identity: string;
  verified: boolean;
  error?: string;
}

async function verifyIdentity(
  identity: ParsedIdentity,
  expectedPubkey: string
): Promise&lt;VerificationResult&gt; {
  const expectedNpub = nip19.npubEncode(expectedPubkey);

  try {
    // æŠ“å–é©—è­‰å…§å®¹
    const response = await fetch(identity.verificationUrl);

    if (!response.ok) {
      return {
        platform: identity.platform,
        identity: identity.identity,
        verified: false,
        error: `ç„¡æ³•å–å¾—é©—è­‰å…§å®¹: ${response.status}`,
      };
    }

    const content = await response.text();

    // æª¢æŸ¥å…§å®¹æ˜¯å¦åŒ…å« npub
    const verified = content.includes(expectedNpub);

    return {
      platform: identity.platform,
      identity: identity.identity,
      verified,
      error: verified ? undefined : 'é©—è­‰å…§å®¹ä¸­æœªæ‰¾åˆ°æ­£ç¢ºçš„ npub',
    };
  } catch (error) {
    return {
      platform: identity.platform,
      identity: identity.identity,
      verified: false,
      error: `é©—è­‰å¤±æ•—: ${error}`,
    };
  }
}

// æ‰¹æ¬¡é©—è­‰æ‰€æœ‰èº«ä»½
async function verifyAllIdentities(
  event: any
): Promise&lt;VerificationResult[]&gt; {
  const identities = parseExternalIdentities(event);

  const results = await Promise.all(
    identities.map((id) => verifyIdentity(id, event.pubkey))
  );

  return results;
}</code></pre>

  <h3>å®¢æˆ¶ç«¯ UI å…ƒä»¶ç¯„ä¾‹</h3>
  <pre><code class="language-typescript">// React å…ƒä»¶ç¯„ä¾‹
interface IdentityBadgeProps {
  identity: ParsedIdentity;
  verified: boolean;
}

function IdentityBadge({ identity, verified }: IdentityBadgeProps) {
  const platformIcons: Record&lt;string, string&gt; = {
    github: 'ğŸ™',
    twitter: 'ğŸ¦',
    mastodon: 'ğŸ˜',
    telegram: 'âœˆï¸',
  };

  const icon = platformIcons[identity.platform] || 'ğŸ”—';

  return (
    &lt;a
      href={identity.verificationUrl}
      target="_blank"
      rel="noopener noreferrer"
      className={`identity-badge ${verified ? 'verified' : 'unverified'}`}
    &gt;
      &lt;span className="icon"&gt;{icon}&lt;/span&gt;
      &lt;span className="platform"&gt;{identity.platform}&lt;/span&gt;
      &lt;span className="identity"&gt;{identity.identity}&lt;/span&gt;
      {verified && &lt;span className="check"&gt;âœ“&lt;/span&gt;}
    &lt;/a&gt;
  );
}</code></pre>

  <h2 id="custom-platforms">è‡ªè¨‚å¹³å°</h2>
  <p>
    NIP-39 å…è¨±æ·»åŠ ä»»ä½•å¹³å°ï¼Œåªè¦éµå¾ªå‘½åè¦ç¯„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„è‡ªè¨‚å¹³å°ç¯„ä¾‹ï¼š
  </p>

  <pre><code class="language-json">{
  "tags": [
    ["i", "youtube:@channelname", "video-id"],
    ["i", "linkedin:username", "post-id"],
    ["i", "reddit:u/username", "post-id"],
    ["i", "keybase:username", "proof-id"],
    ["i", "dns:example.com", "TXT-record-hash"]
  ]
}</code></pre>

  <h2 id="security">å®‰å…¨è€ƒé‡</h2>
  <ul>
    <li><strong>è­‰æ˜å¯èƒ½å¤±æ•ˆ</strong>ï¼šç”¨æˆ¶å¯èƒ½åˆªé™¤ Gist æˆ–æ¨æ–‡ï¼Œå®¢æˆ¶ç«¯æ‡‰è™•ç†é©—è­‰å¤±æ•—çš„æƒ…æ³</li>
    <li><strong>å¹³å° API é™åˆ¶</strong>ï¼šç›´æ¥æŠ“å–å¯èƒ½å—åˆ°é€Ÿç‡é™åˆ¶ï¼Œè€ƒæ…®ä½¿ç”¨å¿«å–</li>
    <li><strong>å½é€ é¢¨éšª</strong>ï¼šæƒ¡æ„ç”¨æˆ¶å¯èƒ½è²ç¨±ä»–äººçš„å¸³è™Ÿï¼Œå‹™å¿…é©—è­‰è­‰æ˜å…§å®¹</li>
    <li><strong>éš±ç§è€ƒé‡</strong>ï¼šé€£çµèº«ä»½æœƒé™ä½åŒ¿åæ€§ï¼Œç”¨æˆ¶æ‡‰è¬¹æ…é¸æ“‡è¦å…¬é–‹çš„å¸³è™Ÿ</li>
  </ul>

  <h2 id="use-cases">ä½¿ç”¨å ´æ™¯</h2>

  <h3>èº«ä»½é©—è­‰</h3>
  <ul>
    <li>è­‰æ˜ä½ æ˜¯æŸå€‹çŸ¥å GitHub é–‹ç™¼è€…</li>
    <li>é€£çµä½ çš„ Twitter å¸³è™Ÿå¢åŠ å¯ä¿¡åº¦</li>
    <li>å¾å…¶ä»–ç¤¾ç¾¤å¹³å°é·ç§»æ™‚ä¿æŒèº«ä»½é€£çºŒæ€§</li>
  </ul>

  <h3>ç¤¾ç¾¤ä¿¡ä»»</h3>
  <ul>
    <li>è®“è¿½éš¨è€…ç¢ºèªä½ æ˜¯çœŸæ­£çš„å¸³è™Ÿ</li>
    <li>åœ¨ Nostr ä¸Šå»ºç«‹èˆ‡ç¾æœ‰ç¶²è·¯èº«ä»½çš„é€£çµ</li>
    <li>æ¸›å°‘å†’å……æ”»æ“Šçš„é¢¨éšª</li>
  </ul>

  <h3>è·¨å¹³å°ç™¼ç¾</h3>
  <ul>
    <li>è®“å…¶ä»–å¹³å°çš„è¿½éš¨è€…æ‰¾åˆ°ä½ çš„ Nostr å¸³è™Ÿ</li>
    <li>å»ºç«‹çµ±ä¸€çš„ç·šä¸Šèº«ä»½</li>
  </ul>

  <h2 id="best-practices">æœ€ä½³å¯¦è¸</h2>
  <ul>
    <li><strong>ä¿æŒè­‰æ˜æœ‰æ•ˆ</strong>ï¼šä¸è¦åˆªé™¤ç”¨æ–¼é©—è­‰çš„ Gist æˆ–æ¨æ–‡</li>
    <li><strong>æ­£è¦åŒ–èº«ä»½</strong>ï¼šä½¿ç”¨å°å¯«å­—æ¯é¿å…é‡è¤‡è²æ˜</li>
    <li><strong>å®šæœŸé©—è­‰</strong>ï¼šå®¢æˆ¶ç«¯æ‡‰è©²å®šæœŸé‡æ–°é©—è­‰å¤–éƒ¨èº«ä»½</li>
    <li><strong>é¡¯ç¤ºé©—è­‰ç‹€æ…‹</strong>ï¼šæ¸…æ¥šå€åˆ†å·²é©—è­‰å’Œæœªé©—è­‰çš„èº«ä»½</li>
    <li><strong>è™•ç†å¤±æ•—</strong>ï¼šå„ªé›…åœ°è™•ç†é©—è­‰å¤±æ•—çš„æƒ…æ³</li>
  </ul>

  <h2 id="related-nips">ç›¸é—œ NIPs</h2>
  <ul>
    <li><a href="/tech/nostr/nip-01">NIP-01</a>ï¼šåŸºæœ¬å”è­° - kind 0 å€‹äººè³‡æ–™äº‹ä»¶</li>
    <li><a href="/tech/nostr/nip-05">NIP-05</a>ï¼šåŸŸåé©—è­‰ - å¦ä¸€ç¨®èº«ä»½é©—è­‰æ–¹å¼</li>
    <li><a href="/tech/nostr/nip-19">NIP-19</a>ï¼šbech32 ç·¨ç¢¼ - npub æ ¼å¼</li>
  </ul>

  <h2 id="references">åƒè€ƒè³‡æº</h2>
  <ul>
    <li><a href="https://github.com/nostr-protocol/nips/blob/master/39.md" target="_blank" rel="noopener noreferrer">NIP-39 è¦ç¯„</a></li>
    <li><a href="https://github.com/nbd-wtf/nostr-tools" target="_blank" rel="noopener noreferrer">nostr-tools</a></li>
  </ul>
</ArticleLayout>
