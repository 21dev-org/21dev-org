---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="Neutrino 輕客戶端"
  description="了解 Neutrino 輕客戶端協議，如何在有限資源設備上運行閃電網路節點。"
  breadcrumbs={[
    { label: '技術', href: '/tech/' },
    { label: 'Lightning Network', href: '/tech/lightning/' },
    { label: 'Neutrino' },
  ]}
  difficulty="intermediate"
  readingTime="10 分鐘"
  prevPage={{ title: 'AMP', href: '/tech/lightning/amp' }}
  nextPage={{ title: 'WebLN', href: '/tech/lightning/webln' }}
>
  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">什麼是 Neutrino？</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    Neutrino 是比特幣的輕客戶端協議（BIP 157/158），允許節點在不下載完整區塊鏈的情況下
    驗證交易。對於閃電網路，這意味著可以在手機或低資源設備上運行完整的閃電節點，
    而不需要數百 GB 的儲存空間。
  </p>

  <div class="not-prose mb-8 p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
    <p class="text-sm text-blue-700 dark:text-blue-400">
      <strong>BIP 157/158：</strong>
      Compact Block Filters（緊湊區塊過濾器）是 Neutrino 的核心技術，
      提供隱私友好的輕客戶端驗證方式。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">為什麼需要輕客戶端？</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Lightning Node Requirements

Full Node Mode:
• Storage: ~600 GB (and growing)
• Initial sync: hours to days
• Memory: at least 2-4 GB
• Network: continuous block downloads

Problems:
• Cannot run on mobile
• Cannot run on low-end devices
• High barrier to entry

Neutrino Light Client:
• Storage: ~100 MB (filters) + channel data
• Initial sync: minutes
• Memory: few hundred MB
• Network: on-demand downloads

Advantages:
• Runs on mobile
• Fast startup
• Maintains non-custodial nature`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">Compact Block Filters</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`BIP 157/158 How It Works

Block Filter:
• Each block generates a small filter (~20KB)
• Filters use Golomb-Rice encoding compression
• Contains all output scripts and input outpoints in the block
• Filter corresponds to block height
• Filters are deterministically generated
• Any full node can generate identical filters

Light Client Flow:
1. Download block headers (80 bytes each)
2. Download corresponding block filters
3. Query filters with local addresses/scripts
4. If filter matches, download full block
5. Verify relevant transactions in block

Privacy Advantages (vs SPV/Bloom):

Bloom Filter (old method):
• Client tells server which addresses it cares about
• Server knows client's addresses
• Serious privacy leak

Compact Block Filter (Neutrino):
• Client downloads all filters
• Local queries, server doesn't know what client cares about
• Good privacy protection`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">Neutrino 與閃電網路</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Lightning Node Using Neutrino

Events to Monitor:
1. Channel funding transaction confirmation
   - Monitor if funding_txid enters a block

2. Channel close transactions
   - Monitor commitment or closing transactions

3. HTLC on-chain settlement
   - Monitor HTLC-Success/Timeout transactions

4. Counterparty fraud detection
   - Monitor if old commitment transactions are published

5. Penalty transaction confirmation
   - Ensure penalty transaction succeeds

Workflow:
1. Lightning node starts
2. Neutrino syncs block headers and filters
3. Query scripts related to channels
4. Download full block when match is found
5. Verify transactions and update channel state
6. Continue monitoring new blocks`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">安全考慮</h2>

  <div class="grid md:grid-cols-2 gap-4 mb-8">
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">信任假設</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        Neutrino 依賴至少一個誠實的全節點提供正確的過濾器。
        惡意節點可能隱藏交易，但無法偽造不存在的交易。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">過濾器驗證</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        可以從多個來源獲取過濾器並比較。不一致的過濾器表示可能有惡意節點。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">瞭望塔輔助</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        配合瞭望塔使用可以彌補輕客戶端可能錯過的欺詐嘗試。
        瞭望塔運行全節點監控。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">連接多節點</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        連接多個 Neutrino 服務節點減少單點依賴風險。
        交叉驗證增加安全性。
      </p>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">配置 Neutrino</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`LND Neutrino 配置：

lnd.conf：
[Bitcoin]
bitcoin.active=true
bitcoin.mainnet=true

# 使用 Neutrino 模式
bitcoin.node=neutrino

[Neutrino]
# 連接的 Neutrino 服務節點
neutrino.addpeer=btcd-mainnet.lightning.computer
neutrino.addpeer=mainnet1-btcd.zaphq.io
neutrino.addpeer=mainnet2-btcd.zaphq.io

# 費率估算來源
neutrino.feeurl=https://nodes.lightning.computer/fees/v1/btc-fee-estimates.json

# 同步模式
neutrino.validatechannels=true

啟動命令：
lnd --bitcoin.node=neutrino

查看同步狀態：
lncli getinfo
# recovery_mode: false
# synced_to_chain: true
# synced_to_graph: true`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">使用 Neutrino 的錢包</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Neutrino-Enabled Lightning Wallets

Mobile Wallets:

Blixt Wallet
• Platform: Android, iOS
• Type: Full LND node + Neutrino
• Feature: True non-custodial mobile Lightning wallet
• Initial sync: ~5-10 minutes

Breez
• Platform: Android, iOS
• Type: Neutrino backend
• Feature: User-friendly interface

Zeus
• Platform: Android, iOS
• Type: Supports built-in LND + Neutrino
• Feature: Can also connect to remote nodes

Desktop Apps:

Zap Desktop
• Optional Neutrino mode
• Fast startup without full node`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">限制與權衡</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Neutrino Limitations

Functional Limitations:
1. Cannot verify all transactions
   - Can only verify transactions related to yourself

2. Historical transaction queries
   - Need to download and scan old blocks
   - Wallet recovery may be slower

3. Fee estimation
   - Requires external sources
   - Full nodes can estimate locally

4. Network dependency
   - Requires connection to Neutrino service nodes
   - Node availability affects wallet functionality

Trade-off Considerations:

Use Neutrino when:
• Mobile devices
• Limited storage space
• Need fast startup
• Managing small amounts

Use Full Node when:
• Large amounts
• Running routing node
• Maximum security requirements
• Supporting Bitcoin network`}</pre>
  </div>

  <div class="not-prose mb-8 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
    <p class="text-sm text-yellow-700 dark:text-yellow-400">
      <strong>建議：</strong>
      對於大額資金或路由節點，建議使用全節點。
      Neutrino 非常適合個人使用和移動錢包場景。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">相關資源</h2>

  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li>
      • <a
        href="https://github.com/bitcoin/bips/blob/master/bip-0157.mediawiki"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">BIP 157 - Client Side Block Filtering</a>
    </li>
    <li>
      • <a
        href="https://github.com/bitcoin/bips/blob/master/bip-0158.mediawiki"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">BIP 158 - Compact Block Filters</a>
    </li>
    <li>
      • <a
        href="/tech/lightning/watchtowers"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">瞭望塔</a>
    </li>
  </ul>

  <div class="mt-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <p class="text-sm text-[var(--text-secondary)]">
      <strong class="text-[var(--text-primary)]">下一步：</strong>
      了解 <a
        href="/tech/lightning/webln"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">WebLN</a
      >
      如何在瀏覽器中整合閃電支付。
    </p>
  </div>
</ArticleLayout>
