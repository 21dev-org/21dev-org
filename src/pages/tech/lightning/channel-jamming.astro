---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="Channel Jamming 通道堵塞"
  description="了解閃電網路的通道堵塞攻擊，這是一個嚴重的可用性問題，以及社群正在研究的各種解決方案。"
  breadcrumbs={[
    { label: '技術', href: '/tech/' },
    { label: 'Lightning Network', href: '/tech/lightning/' },
    { label: 'Channel Jamming' },
  ]}
  difficulty="advanced"
  readingTime="15 分鐘"
  prevPage={{ title: 'Zero-Conf Channels', href: '/tech/lightning/zero-conf' }}
  nextPage={{ title: 'Async Payments', href: '/tech/lightning/async-payments' }}
>
  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">什麼是通道堵塞？</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    通道堵塞（Channel Jamming）是閃電網路面臨的一個嚴重可用性問題。 攻擊者可以通過佔用通道的流動性或
    HTLC 槽位，使節點無法正常處理支付， 而且這種攻擊的成本極低——只需要發送一些最終會失敗的支付。
  </p>

  <div class="not-prose mb-8 p-4 rounded-lg bg-red-500/10 border border-red-500/30">
    <p class="text-sm text-red-700 dark:text-red-400">
      <strong>當前狀態：</strong>
      通道堵塞是閃電網路最重要的未解決問題之一。目前沒有完美的解決方案， 社群正在積極研究和討論各種緩解措施。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">攻擊類型</h2>

  <div class="grid md:grid-cols-2 gap-4 mb-8">
    <div class="p-4 rounded-lg border border-red-500/30 bg-red-500/10">
      <h4 class="font-semibold text-red-700 dark:text-red-400 mb-2">
        流動性堵塞 (Liquidity Jamming)
      </h4>
      <p class="text-sm text-[var(--text-secondary)]">
        攻擊者發送大額支付並故意不完成（不揭示 preimage），佔用通道的流動性直到 HTLC 超時。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-orange-500/30 bg-orange-500/10">
      <h4 class="font-semibold text-orange-700 dark:text-orange-400 mb-2">
        槽位堵塞 (Slot Jamming)
      </h4>
      <p class="text-sm text-[var(--text-secondary)]">
        攻擊者發送大量小額支付，耗盡通道的 HTLC 槽位（通常限制為 483 個），阻止正常支付。
      </p>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">攻擊機制詳解</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Liquidity Jamming Attack:

Attacker controls two nodes A and Z:

A ──> B ──> C ──> D ──> Z
│                       │
└── Attacker controls ──┘

Attack flow:
1. A sends payment to Z (via B-C-D route)
2. HTLC propagates all the way to Z
3. Z intentionally doesn't reveal preimage
4. All intermediate channel liquidity locked
5. Wait for HTLC timeout (hours to days)
6. Attacker loses no funds (payment fails)

Cost analysis:
• Attacker cost: only routing fees (few sats)
• Victim loss: liquidity locked, can't process payments
• Duration: up to HTLC timeout (~2 weeks max)

────────────────────────────────────────────

Slot Jamming Attack:

HTLC slot limit:
• Max 483 pending HTLCs per channel direction
• Required to keep commitment tx under
  Bitcoin's max transaction size limit

Attack flow:
1. Attacker creates 483+ small payments
2. Each payment only 1 sat
3. All HTLC slots filled
4. Normal payments can't go through

Cost: 483 sats x routing fee = few hundred sats`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">為什麼很難解決？</h2>

  <div class="space-y-4 mb-8">
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">1. 無法區分攻擊和正常失敗</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        支付失敗是閃電網路的正常現象（路由問題、離線節點等）。節點無法區分惡意攻擊和正常失敗。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">2. 洋蔥路由隱私</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        中間節點不知道支付的發送者和接收者，無法建立信譽系統或追究責任。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">3. 去中心化網路</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        沒有中央權威可以封鎖攻擊者。任何人都可以匿名加入網路並發起攻擊。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">4. 經濟不對稱</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        攻擊者成本極低（只需路由費），但可以造成大量資金被鎖定。
      </p>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">提議的解決方案</h2>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">
    1. 預付費用 (Upfront Fees)
  </h3>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Upfront Fee Mechanism:

Current model (pay only on success):
  Payment success: routing node collects fee
  Payment failure: routing node gets nothing

Upfront fee model:
  When sending: immediately pay small "hold fee"
  Success: normal routing fee
  Failure: routing node keeps hold fee

Advantages:
• Increases attack cost
• Compensates routing nodes for resource use

Disadvantages:
• Increases cost for normal users
• Routing nodes might intentionally delay
• Complex implementation`}</pre>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">2. 本地信譽系統</h3>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Local Reputation System:

Each node maintains its own reputation database:

Peer     | Success Rate | Reputation
---------|--------------|------------
Node A   | 95%          | Good
Node B   | 30%          | Suspicious
Node C   | 5%           | Bad

Behavior:
• HTLCs from low-rep nodes: limit slots/amount
• HTLCs from high-rep nodes: process normally
• New nodes: gradually build reputation

Challenges:
• Attackers can build reputation first
• Reputation can't be shared (privacy issues)
• May cause network fragmentation`}</pre>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">3. Circuit Breaker</h3>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Circuit Breaker Plugin (CLN):

Per-peer limit settings:
  max_pending_htlcs_per_peer: 30
  max_htlc_value_per_peer: 100000 sat
  max_pending_duration: 1 hour

When limits reached:
• Reject new HTLCs
• Prioritize small fast payments
• Log suspicious behavior

Limitations:
• Only mitigation, not complete prevention
• May affect normal large payments`}</pre>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">
    4. 信譽憑證 (Reputation Credentials)
  </h3>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Reputation Credentials (research):

Concept:
1. Nodes buy "reputation tokens" (pay via LN)
2. Attach tokens when sending payment
3. Payment failure: tokens destroyed
4. Payment success: tokens can be recovered

Features:
• Purchase cost = attack cost
• Anonymous credentials (privacy protection)
• Transferable

Challenges:
• Increases normal payment complexity
• Token economics design
• Requires widespread adoption`}</pre>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">5. 時間鎖降級</h3>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Shorten HTLC Timeout:

Current default:
  Max HTLC timeout = 2016 blocks = ~2 weeks

Reduced timeout:
  Max HTLC timeout = 144 blocks = ~1 day

Benefits:
• Attack duration shortened
• Liquidity recovers faster

Problems:
• Long-path payments more likely to timeout
• Reduces tolerance for offline nodes
• Requires faster block monitoring`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">當前緩解措施</h2>

  <div class="grid md:grid-cols-2 gap-4 mb-8">
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">節點層面</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 設定 max_htlc_value_in_flight</li>
        <li>• 限制每個對等的 pending HTLCs</li>
        <li>• 使用 Circuit Breaker 插件</li>
        <li>• 監控異常模式</li>
      </ul>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">網路層面</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 減少默認 HTLC 超時</li>
        <li>• 增加最小 HTLC 金額</li>
        <li>• 社群信息共享</li>
        <li>• 持續研究新方案</li>
      </ul>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">研究進展</h2>

  <div class="space-y-4 mb-8">
    <div class="p-4 rounded-lg border border-blue-500/30 bg-blue-500/10">
      <h4 class="font-semibold text-blue-700 dark:text-blue-400 mb-2">
        2022: 堵塞問題被系統性研究
      </h4>
      <p class="text-sm text-[var(--text-secondary)]">
        多篇學術論文分析了堵塞攻擊的經濟成本和可行性，引起社群廣泛關注。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-yellow-500/30 bg-yellow-500/10">
      <h4 class="font-semibold text-yellow-700 dark:text-yellow-400 mb-2">2023: 信譽憑證提案</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        Clara Shikhelman 和 Sergei Tikhomirov 提出基於 Chaumian eCash 的信譽系統。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-purple-500/30 bg-purple-500/10">
      <h4 class="font-semibold text-purple-700 dark:text-purple-400 mb-2">
        持續進行: 多種方案並行研究
      </h4>
      <p class="text-sm text-[var(--text-secondary)]">
        社群正在評估多種方案的權衡，可能最終採用組合策略。
      </p>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">相關資源</h2>

  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li>
      • <a
        href="https://github.com/lightning/bolts/issues/1066"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">Channel Jamming 討論</a
      >
    </li>
    <li>
      • <a
        href="https://lists.linuxfoundation.org/pipermail/lightning-dev/"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">Lightning-dev 郵件列表</a
      >
    </li>
    <li>
      • <a
        href="https://github.com/lightningd/plugins/tree/master/circuitbreaker"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">Circuit Breaker 插件</a
      >
    </li>
  </ul>

  <div class="mt-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <p class="text-sm text-[var(--text-secondary)]">
      <strong class="text-[var(--text-primary)]">下一步：</strong>
      了解 <a
        href="/tech/lightning/async-payments"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">非同步支付</a
      >
      如何實現離線接收功能。
    </p>
  </div>
</ArticleLayout>
