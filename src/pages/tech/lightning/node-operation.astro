---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="Node Operation 節點運營"
  description="閃電網路節點運營的完整指南，涵蓋硬體選擇、安全配置、監控維護和營運最佳實踐。"
  breadcrumbs={[
    { label: '技術', href: '/tech/' },
    { label: 'Lightning Network', href: '/tech/lightning/' },
    { label: 'Node Operation' },
  ]}
  difficulty="intermediate"
  readingTime="15 分鐘"
  prevPage={{ title: 'Feature Bits', href: '/tech/lightning/feature-bits' }}
  nextPage={{ title: 'Inbound Liquidity', href: '/tech/lightning/inbound-liquidity' }}
>
  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">節點運營概述</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    運營閃電網路節點需要持續的關注和維護。
    一個健康的節點不僅需要穩定的硬體和網路，還需要良好的通道管理、
    安全措施和監控系統。本文介紹節點運營的關鍵要素。
  </p>

  <div class="not-prose mb-8 p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
    <p class="text-sm text-blue-700 dark:text-blue-400">
      <strong>運營責任：</strong>
      閃電網路節點需要持續在線。離線可能導致對手方強制關閉通道，
      甚至在極端情況下損失資金。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">硬體需求</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Hardware Configuration Recommendations

Minimum Configuration (Small Node):
• CPU: 4 cores
• RAM: 8 GB
• Storage: 500 GB SSD (Bitcoin + LN)
• Network: Stable connection, static IP or Tor
• Example: Raspberry Pi 4 8GB + SSD

Recommended Configuration (Routing Node):
• CPU: 8+ cores
• RAM: 16-32 GB
• Storage: 1-2 TB NVMe SSD
• Network: Enterprise-grade, low latency
• UPS: Uninterruptible power supply
• Backup: Automatic off-site backup

Storage Requirements Estimate:
• Bitcoin full node: ~600 GB (and growing)
• Bitcoin pruned node: ~10 GB (configurable)
• LND database: ~5-50 GB (depends on channel count)
• CLN database: ~1-10 GB
• Logs and backups: ~10-50 GB`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">節點軟體選擇</h2>

  <div class="grid md:grid-cols-2 gap-4 mb-8">
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">LND (Lightning Labs)</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        最廣泛使用的實現，Go 語言編寫。
        功能豐富，生態系統完善，適合大多數使用場景。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">Core Lightning (CLN)</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        Blockstream 開發，C 語言編寫。
        模組化設計，插件系統強大，資源佔用較低。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">Eclair (ACINQ)</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        Scala 語言編寫，注重協議合規。
        Phoenix 錢包的後端，企業級部署經驗豐富。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">LDK (Spiral)</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        Rust 語言函式庫，用於構建自訂節點。
        適合需要深度整合的應用開發者。
      </p>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">網路配置</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Network Options

1. Static Public IP
Advantages: Best connectivity, lowest latency
Disadvantages: Poor privacy, requires firewall configuration

Configuration:
• Open ports: 9735 (LN), 8333 (Bitcoin)
• Set up NAT traversal or DMZ
• Configure firewall rules

2. Tor Hidden Service
Advantages: Good privacy, no fixed IP needed, traverses NAT
Disadvantages: Higher latency, some nodes don't support

Configuration (lnd.conf):
[Tor]
tor.active=true
tor.v3=true
tor.streamisolation=true

Generated address: xxx...xxx.onion:9735

3. Hybrid Mode
Use both clearnet and Tor simultaneously
Maximize connectivity

Node announces two addresses:
• 203.0.113.1:9735 (clearnet)
• xxx.onion:9735 (Tor)`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">安全最佳實踐</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`安全措施清單：

1. 錢包安全
├── 使用硬體錢包簽名（如果支援）
├── 安全備份助記詞（離線、多副本、不同地點）
├── 使用強密碼加密錢包
└── 定期測試恢復流程

2. 通道備份
├── 啟用 Static Channel Backup（SCB）
├── 自動備份到多個位置
├── 使用 upfront_shutdown_script 保護資金
└── 定期驗證備份有效性

3. 系統安全
├── 最小化系統服務
├── 定期更新系統和節點軟體
├── 使用防火牆限制訪問
├── SSH 密鑰認證（禁用密碼）
├── 啟用自動安全更新
└── 監控異常登入

4. 操作安全
├── 使用獨立機器運行節點
├── 避免在節點機器上執行其他服務
├── 限制 API 訪問（macaroon 權限最小化）
├── 使用 VPN 遠程管理
└── 記錄所有管理操作`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">監控和告警</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Metrics to Monitor

Node Health:
• Node online status
• Peer connection count
• Bitcoin block sync status
• Memory and CPU usage
• Disk space

Channel Status:
• Active channel count
• Pending channel count
• Force close events
• Channel capacity changes
• HTLC status

Routing Performance:
• Forwarding success rate
• Daily routing income
• Failure reason distribution
• Average fees
• Channel utilization

Alert Settings:

Critical Alerts (immediate notification):
• Node offline
• Force close occurred
• Disk space low
• Unusual large transactions

Warning Alerts (daily summary):
• Channel balance severely imbalanced
• Routing success rate declining
• Peer offline for extended time

Monitoring Tools:
• ThunderHub: Web interface management
• RTL (Ride The Lightning): Full-featured management UI
• lndmon: Prometheus metrics export
• Balance of Satoshis (bos): CLI toolkit
• Grafana + Prometheus: Custom monitoring dashboards`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">日常維護</h2>

  <div class="grid md:grid-cols-2 gap-4 mb-8">
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">每日任務</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 檢查節點在線狀態</li>
        <li>• 查看待處理 HTLC</li>
        <li>• 檢查強制關閉通知</li>
        <li>• 回顧路由收入</li>
      </ul>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">每週任務</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 分析通道平衡狀態</li>
        <li>• 評估通道健康度</li>
        <li>• 考慮再平衡操作</li>
        <li>• 檢查系統更新</li>
      </ul>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">每月任務</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 審核通道策略</li>
        <li>• 考慮開新通道或關閉低效通道</li>
        <li>• 更新節點軟體</li>
        <li>• 測試備份恢復</li>
      </ul>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">季度任務</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 全面安全審計</li>
        <li>• 硬體健康檢查</li>
        <li>• 評估整體策略</li>
        <li>• 災難恢復演練</li>
      </ul>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">常用命令</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`日常操作命令（LND）：

# 節點狀態
lncli getinfo
lncli getnetworkinfo

# 通道管理
lncli listchannels
lncli pendingchannels
lncli closedchannels

# 餘額查詢
lncli walletbalance
lncli channelbalance

# 對等節點
lncli listpeers
lncli connect <pubkey>@<host>

# 路由統計
lncli fwdinghistory
lncli feereport

# 備份
lncli exportchanbackup --all --output_file=backup.scb

日常操作命令（CLN）：

# 節點狀態
lightning-cli getinfo
lightning-cli listfunds

# 通道管理
lightning-cli listpeerchannels
lightning-cli listclosedchannels

# 支付
lightning-cli pay <bolt11>
lightning-cli invoice <amount> <label> <description>

# 路由
lightning-cli listforwards`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">故障排除</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Common Problems and Solutions

Node won't start:
• Check Bitcoin node status
• Check disk space
• View log errors
• Verify configuration file
• Confirm port not in use

Cannot connect to peers:
• Check network connection
• Confirm firewall settings
• Verify Tor service status
• Try other peers
• Check if peer node is online

Channel stuck in pending:
• Check funding transaction confirmations
• Use CPFP to accelerate (if possible)
• Confirm peer node is online
• Wait for more confirmations

HTLC timeout:
• Check peer node status
• View routing path
• Confirm invoice not expired
• Check CLTV settings`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">相關資源</h2>

  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li>
      • <a
        href="https://docs.lightning.engineering/lightning-network-tools/lnd"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">LND 官方文檔</a>
    </li>
    <li>
      • <a
        href="/tech/lightning/channel-management"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">通道管理</a>
    </li>
    <li>
      • <a
        href="/tech/lightning/watchtowers"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">瞭望塔</a>
    </li>
  </ul>

  <div class="mt-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <p class="text-sm text-[var(--text-secondary)]">
      <strong class="text-[var(--text-primary)]">下一步：</strong>
      了解 <a
        href="/tech/lightning/inbound-liquidity"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">入站容量</a
      >
      如何獲取接收支付的能力。
    </p>
  </div>
</ArticleLayout>
