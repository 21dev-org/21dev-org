---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="Node Operation 節點運營"
  description="閃電網路節點運營的完整指南，涵蓋硬體選擇、安全配置、監控維護和營運最佳實踐。"
  breadcrumbs={[
    { label: '技術', href: '/tech/' },
    { label: 'Lightning Network', href: '/tech/lightning/' },
    { label: 'Node Operation' },
  ]}
  difficulty="intermediate"
  readingTime="15 分鐘"
  prevPage={{ title: 'Feature Bits', href: '/tech/lightning/feature-bits' }}
  nextPage={{ title: 'Inbound Liquidity', href: '/tech/lightning/inbound-liquidity' }}
>
  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">節點運營概述</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    運營閃電網路節點需要持續的關注和維護。
    一個健康的節點不僅需要穩定的硬體和網路，還需要良好的通道管理、
    安全措施和監控系統。本文介紹節點運營的關鍵要素。
  </p>

  <div class="not-prose mb-8 p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
    <p class="text-sm text-blue-700 dark:text-blue-400">
      <strong>運營責任：</strong>
      閃電網路節點需要持續在線。離線可能導致對手方強制關閉通道，
      甚至在極端情況下損失資金。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">硬體需求</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`硬體配置建議：

最低配置（小型節點）：
┌─────────────────────────────────────────────────────────┐
│ CPU：4 核心                                              │
│ RAM：8 GB                                                │
│ 儲存：500 GB SSD（Bitcoin + LN）                        │
│ 網路：穩定連線，固定 IP 或 Tor                          │
│ 範例：Raspberry Pi 4 8GB + SSD                          │
└─────────────────────────────────────────────────────────┘

推薦配置（路由節點）：
┌─────────────────────────────────────────────────────────┐
│ CPU：8+ 核心                                             │
│ RAM：16-32 GB                                            │
│ 儲存：1-2 TB NVMe SSD                                   │
│ 網路：企業級網路，低延遲                                │
│ UPS：不斷電系統                                         │
│ 備份：自動異地備份                                      │
└─────────────────────────────────────────────────────────┘

儲存需求估算：
├── Bitcoin 全節點：~600 GB（並持續增長）
├── Bitcoin 修剪節點：~10 GB（可設定）
├── LND 資料庫：~5-50 GB（取決於通道數量）
├── CLN 資料庫：~1-10 GB
└── 日誌和備份：~10-50 GB`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">節點軟體選擇</h2>

  <div class="grid md:grid-cols-2 gap-4 mb-8">
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">LND (Lightning Labs)</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        最廣泛使用的實現，Go 語言編寫。
        功能豐富，生態系統完善，適合大多數使用場景。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">Core Lightning (CLN)</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        Blockstream 開發，C 語言編寫。
        模組化設計，插件系統強大，資源佔用較低。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">Eclair (ACINQ)</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        Scala 語言編寫，注重協議合規。
        Phoenix 錢包的後端，企業級部署經驗豐富。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">LDK (Spiral)</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        Rust 語言函式庫，用於構建自訂節點。
        適合需要深度整合的應用開發者。
      </p>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">網路配置</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`網路選項：

1. 固定公網 IP
┌─────────────────────────────────────────────────────────┐
│ 優點：連接性最好，延遲最低                               │
│ 缺點：隱私較差，需要防火牆配置                           │
│                                                         │
│ 配置：                                                   │
│ ├── 開放端口：9735（LN）、8333（Bitcoin）               │
│ ├── 設定 NAT 穿透或 DMZ                                 │
│ └── 配置防火牆規則                                      │
└─────────────────────────────────────────────────────────┘

2. Tor 隱藏服務
┌─────────────────────────────────────────────────────────┐
│ 優點：隱私好，無需固定 IP，穿越 NAT                     │
│ 缺點：延遲較高，部分節點不支援                           │
│                                                         │
│ 配置（lnd.conf）：                                       │
│ [Tor]                                                   │
│ tor.active=true                                         │
│ tor.v3=true                                             │
│ tor.streamisolation=true                                │
│                                                         │
│ 生成的地址：xxx...xxx.onion:9735                        │
└─────────────────────────────────────────────────────────┘

3. 混合模式
┌─────────────────────────────────────────────────────────┐
│ 同時使用 clearnet 和 Tor                                │
│ 最大化連接性                                            │
│                                                         │
│ 節點公告兩個地址：                                      │
│ ├── 203.0.113.1:9735（clearnet）                        │
│ └── xxx.onion:9735（Tor）                               │
└─────────────────────────────────────────────────────────┘`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">安全最佳實踐</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`安全措施清單：

1. 錢包安全
├── 使用硬體錢包簽名（如果支援）
├── 安全備份助記詞（離線、多副本、不同地點）
├── 使用強密碼加密錢包
└── 定期測試恢復流程

2. 通道備份
├── 啟用 Static Channel Backup（SCB）
├── 自動備份到多個位置
├── 使用 upfront_shutdown_script 保護資金
└── 定期驗證備份有效性

3. 系統安全
├── 最小化系統服務
├── 定期更新系統和節點軟體
├── 使用防火牆限制訪問
├── SSH 密鑰認證（禁用密碼）
├── 啟用自動安全更新
└── 監控異常登入

4. 操作安全
├── 使用獨立機器運行節點
├── 避免在節點機器上執行其他服務
├── 限制 API 訪問（macaroon 權限最小化）
├── 使用 VPN 遠程管理
└── 記錄所有管理操作`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">監控和告警</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`需要監控的指標：

節點健康：
├── 節點在線狀態
├── 對等節點連接數
├── Bitcoin 區塊同步狀態
├── 記憶體和 CPU 使用率
└── 磁碟空間

通道狀態：
├── 活躍通道數
├── 待處理通道數
├── 強制關閉事件
├── 通道容量變化
└── HTLC 狀態

路由績效：
├── 轉發成功率
├── 每日路由收入
├── 失敗原因分布
├── 平均手續費
└── 通道使用率

告警設置：
┌─────────────────────────────────────────────────────────┐
│ 緊急告警（立即通知）：                                   │
│ ├── 節點離線                                            │
│ ├── 強制關閉發生                                        │
│ ├── 磁碟空間不足                                        │
│ └── 異常的大額交易                                      │
│                                                         │
│ 警告告警（每日彙總）：                                   │
│ ├── 通道餘額嚴重失衡                                    │
│ ├── 路由成功率下降                                      │
│ └── 對等節點長時間離線                                  │
└─────────────────────────────────────────────────────────┘

監控工具：
├── ThunderHub：網頁界面管理
├── RTL (Ride The Lightning)：全功能管理界面
├── lndmon：Prometheus 指標導出
├── Balance of Satoshis (bos)：CLI 工具包
└── Grafana + Prometheus：自訂監控面板`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">日常維護</h2>

  <div class="grid md:grid-cols-2 gap-4 mb-8">
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">每日任務</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 檢查節點在線狀態</li>
        <li>• 查看待處理 HTLC</li>
        <li>• 檢查強制關閉通知</li>
        <li>• 回顧路由收入</li>
      </ul>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">每週任務</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 分析通道平衡狀態</li>
        <li>• 評估通道健康度</li>
        <li>• 考慮再平衡操作</li>
        <li>• 檢查系統更新</li>
      </ul>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">每月任務</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 審核通道策略</li>
        <li>• 考慮開新通道或關閉低效通道</li>
        <li>• 更新節點軟體</li>
        <li>• 測試備份恢復</li>
      </ul>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">季度任務</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 全面安全審計</li>
        <li>• 硬體健康檢查</li>
        <li>• 評估整體策略</li>
        <li>• 災難恢復演練</li>
      </ul>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">常用命令</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`日常操作命令（LND）：

# 節點狀態
lncli getinfo
lncli getnetworkinfo

# 通道管理
lncli listchannels
lncli pendingchannels
lncli closedchannels

# 餘額查詢
lncli walletbalance
lncli channelbalance

# 對等節點
lncli listpeers
lncli connect <pubkey>@<host>

# 路由統計
lncli fwdinghistory
lncli feereport

# 備份
lncli exportchanbackup --all --output_file=backup.scb

日常操作命令（CLN）：

# 節點狀態
lightning-cli getinfo
lightning-cli listfunds

# 通道管理
lightning-cli listpeerchannels
lightning-cli listclosedchannels

# 支付
lightning-cli pay <bolt11>
lightning-cli invoice <amount> <label> <description>

# 路由
lightning-cli listforwards`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">故障排除</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`常見問題和解決方案：

節點無法啟動：
├── 檢查 Bitcoin 節點狀態
├── 檢查磁碟空間
├── 查看日誌錯誤
├── 驗證配置文件
└── 確認端口未被佔用

無法連接對等節點：
├── 檢查網路連接
├── 確認防火牆設置
├── 驗證 Tor 服務狀態
├── 嘗試其他對等節點
└── 檢查對方節點是否在線

通道卡在 pending：
├── 檢查注資交易確認數
├── 使用 CPFP 加速（如果可能）
├── 確認對方節點在線
└── 等待更多確認

HTLC 超時：
├── 檢查對方節點狀態
├── 查看路由路徑
├── 確認發票未過期
└── 檢查 CLTV 設置`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">相關資源</h2>

  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li>
      • <a
        href="https://docs.lightning.engineering/lightning-network-tools/lnd"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">LND 官方文檔</a>
    </li>
    <li>
      • <a
        href="/tech/lightning/channel-management"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">通道管理</a>
    </li>
    <li>
      • <a
        href="/tech/lightning/watchtowers"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">瞭望塔</a>
    </li>
  </ul>

  <div class="mt-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <p class="text-sm text-[var(--text-secondary)]">
      <strong class="text-[var(--text-primary)]">下一步：</strong>
      了解 <a
        href="/tech/lightning/inbound-liquidity"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">入站容量</a
      >
      如何獲取接收支付的能力。
    </p>
  </div>
</ArticleLayout>
