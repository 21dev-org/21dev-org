---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="Network Topology 網路拓撲"
  description="了解閃電網路的網路結構特性，節點連接模式，以及拓撲對路由效率和去中心化的影響。"
  breadcrumbs={[
    { label: '技術', href: '/tech/' },
    { label: 'Lightning Network', href: '/tech/lightning/' },
    { label: 'Network Topology' },
  ]}
  difficulty="intermediate"
  readingTime="10 分鐘"
  prevPage={{ title: 'Sphinx', href: '/tech/lightning/sphinx' }}
  nextPage={{ title: 'Lightning Wallets', href: '/tech/lightning/lightning-wallets' }}
>
  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">網路結構概述</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    閃電網路是一個點對點的支付通道網路。網路拓撲——即節點和通道的連接方式——
    直接影響路由效率、隱私保護和去中心化程度。理解網路結構有助於優化節點運營 和評估網路健康狀況。
  </p>

  <div class="not-prose mb-8 p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
    <p class="text-sm text-blue-700 dark:text-blue-400">
      <strong>小世界網路：</strong>
      閃電網路展現出「小世界」特性——大多數節點可以通過少數幾跳到達任何其他節點。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">網路統計</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Lightning Network Typical Metrics (Sample Data)

Network Scale:
• Public nodes: ~16,000+
• Public channels: ~75,000+
• Total capacity: ~5,000+ BTC
• Average channel capacity: ~0.07 BTC
• Median channel capacity: ~0.02 BTC

Connection Characteristics:
• Average channels per node: ~5-10
• Max connected node: 1000+ channels
• Average path length: ~3-4 hops
• Network diameter: ~6-8 hops

Note: Actual data changes over time, above are examples
Private channels not included in public statistics`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">拓撲類型</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Network Topology Patterns

1. Scale-Free Network
Characteristics:
• Few "super nodes" with many connections
• Most nodes have few connections

Pros:
• Short path length
• Efficient routing
• Resistant to random failures

Cons:
• Centralization risk
• Super nodes become single points of failure
• Privacy concentration

2. Hub-and-Spoke
      o
     /|\\
    o-*-o   * = hub node
     /|\\   o = edge nodes
      o

Real example: LSP and its users

3. Mesh Topology
o---o---o
|\ /|\ /|
| o | o |
|/ \|/ \|
o---o---o

Characteristics: Multiple paths between nodes
Pros: High redundancy, decentralized
Cons: Requires more locked funds`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">節點類型</h2>

  <div class="grid md:grid-cols-2 gap-4 mb-8">
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">路由節點</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        專門為網路提供路由服務。維護多個通道， 平衡流動性，通過路由費用獲利。通常是網路骨幹。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">商家節點</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        主要接收支付。需要入站容量， 可能連接到多個路由節點確保可達性。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">終端用戶</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        個人錢包用戶。通常只有 1-2 個通道， 連接到 LSP 或大型節點。多為私有通道。
      </p>
    </div>
    <div class="p-4 rounded-lg border border-[var(--border-default)] bg-[var(--surface-elevated)]">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">LSP 節點</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        Lightning Service Provider。為大量用戶提供通道和流動性。 是網路中的超級節點。
      </p>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">中心化度量</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Network Centralization Metrics

Node Centrality Types:

Degree Centrality:
  Number of channels

Betweenness Centrality:
  How many shortest paths pass through node
  High betweenness = more payments route through

Closeness Centrality:
  Average distance to all other nodes
  High closeness = can quickly reach anywhere

Gini Coefficient:
Measures inequality in capacity/connection distribution
• 0 = perfect equality (all nodes same)
• 1 = perfect inequality (one node has everything)
• Lightning Network capacity Gini: ~0.8-0.9
  -> Highly concentrated, few nodes hold most capacity

Top N Node Control:
• Top 10 nodes control ~15% capacity
• Top 100 nodes control ~50% capacity
• Clear long-tail distribution`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">對路由的影響</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Topology Impact on Routing

Path Availability:
• High connectivity -> more route options
• Multiple paths -> MPP more likely to succeed
• Mesh structure -> single channel failure not fatal

Liquidity Distribution:
• Central nodes have high capacity -> large payments more likely
• Edge nodes have low capacity -> may need MPP
• Imbalanced channels -> need rebalancing

Latency and Reliability:
• Short path -> fewer hops -> lower latency
• Super nodes -> high availability -> more reliable routing
• But super node dependency -> larger failure impact

Fees:
• Competitive routes -> lower fees
• Chokepoints -> may charge higher fees
• Edge regions -> fewer choices, potentially higher fees`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">改善網路拓撲</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Strategies to Improve Network Structure

For Node Operators:

1. Selective Connections
   • Connect to nodes in different "regions"
   • Avoid connecting only to super nodes
   • Build triangle connections for redundancy

2. Capacity Allocation
   • Adjust channel size based on traffic
   • Maintain balanced inbound/outbound ratio
   • Allocate more capacity to frequent routes

3. Interconnection Coordination
   • Ring of Fire and similar community events
   • Establish channels with geographically diverse nodes
   • Support emerging nodes

Protocol Level Improvements:
• Channel Factories: multi-party shared funding tx
• Splicing: dynamically adjust channel capacity
• Trampoline: reduce end-node burden
• Better path discovery algorithms`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">查看網路拓撲</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Network Exploration Tools

Web Tools:
• 1ML (https://1ml.com) - node ranking, stats, search
• Amboss (https://amboss.space) - detailed node info, community
• LN+ (https://lightningnetwork.plus) - node connection coordination
• mempool.space/lightning - network overview

CLI Tools (LND):
# View network info
lncli getnetworkinfo

# View specific node
lncli getnodeinfo <pubkey>

# View node channels
lncli describegraph | jq '.nodes | length'

CLI Tools (CLN):
# Network statistics
lightning-cli listnodes | jq 'length'
lightning-cli listchannels | jq 'length'`}</pre>
  </div>

  <div class="not-prose mb-8 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
    <p class="text-sm text-yellow-700 dark:text-yellow-400">
      <strong>隱私注意：</strong>
      公開可見的拓撲只包含公告的通道。私有通道不計入， 實際網路比可見的更大、更連通。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">相關資源</h2>

  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li>
      • <a
        href="https://1ml.com/statistics"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">1ML 網路統計</a
      >
    </li>
    <li>
      • <a
        href="/tech/lightning/gossip"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">Gossip 協議</a
      >
    </li>
    <li>
      • <a
        href="/tech/lightning/pathfinding"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">路徑搜索</a
      >
    </li>
  </ul>

  <div class="mt-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <p class="text-sm text-[var(--text-secondary)]">
      <strong class="text-[var(--text-primary)]">下一步：</strong>
      了解 <a
        href="/tech/lightning/lightning-wallets"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">閃電錢包指南</a
      >
      幫助選擇合適的錢包。
    </p>
  </div>
</ArticleLayout>
