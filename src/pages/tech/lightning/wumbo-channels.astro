---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="Wumbo Channels 大額通道"
  description="了解閃電網路的 Wumbo 通道機制，如何突破預設的通道容量限制，開設大額通道。"
  breadcrumbs={[
    { label: '技術', href: '/tech/' },
    { label: 'Lightning Network', href: '/tech/lightning/' },
    { label: 'Wumbo Channels' },
  ]}
  difficulty="intermediate"
  readingTime="8 分鐘"
  prevPage={{ title: 'Inbound Liquidity', href: '/tech/lightning/inbound-liquidity' }}
  nextPage={{ title: 'Channel Management', href: '/tech/lightning/channel-management' }}
>
  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">什麼是 Wumbo 通道？</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    Wumbo 通道是指超過傳統限制的大額閃電網路通道。
    最初閃電網路規範設定了約 0.1677 BTC（16,777,215 satoshis）的通道容量上限，
    以限制早期實驗階段的風險。Wumbo 功能允許節點突破這個限制，
    開設任意大小的通道。
  </p>

  <div class="not-prose mb-8 p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
    <p class="text-sm text-blue-700 dark:text-blue-400">
      <strong>名稱來源：</strong>
      "Wumbo" 來自《海綿寶寶》卡通，是 "mini" 的相反詞。
      在閃電網路中表示 "大" 或 "大額"。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">通道容量限制</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`傳統限制：

┌─────────────────────────────────────────────────────────┐
│ 最大通道容量：2^24 - 1 satoshis                         │
│              = 16,777,215 sats                          │
│              ≈ 0.16777215 BTC                           │
│                                                         │
│ 最大 HTLC 大小：通道容量的一部分                        │
│                                                         │
│ 原因：                                                   │
│ ├── 限制早期階段的風險                                  │
│ ├── 使用 3 字節編碼金額欄位                             │
│ └── 鼓勵多通道分散風險                                  │
└─────────────────────────────────────────────────────────┘

Wumbo 通道（option_support_large_channel）：

┌─────────────────────────────────────────────────────────┐
│ 最大通道容量：2^64 - 1 satoshis（理論上）               │
│              = 實際上受限於 Bitcoin 總供應量            │
│                                                         │
│ 實際限制：                                               │
│ ├── 節點可用資金                                        │
│ ├── 對手方願意接受的風險                                │
│ └── 軟體實現的限制                                      │
│                                                         │
│ 常見大額通道：1-10 BTC                                  │
└─────────────────────────────────────────────────────────┘`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">功能位與協商</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`option_support_large_channel（功能位 18/19）：

功能協商：
┌─────────────────────────────────────────────────────────┐
│ Alice                                 Bob               │
│   │                                    │                │
│   │──── init ─────────────────────────>│                │
│   │     features: ...18/19...          │                │
│   │                                    │                │
│   │<─── init ──────────────────────────│                │
│   │     features: ...18/19...          │                │
│   │                                    │                │
│   │ [雙方都支援 Wumbo]                 │                │
│   │                                    │                │
│   │──── open_channel ─────────────────>│                │
│   │     funding_satoshis: 500000000    │  (5 BTC)       │
│   │                                    │                │
└─────────────────────────────────────────────────────────┘

要求：
├── 雙方節點都必須支援 option_support_large_channel
├── 功能位在 init 訊息中交換
└── 只有當雙方都支援時才能開大額通道

相容性：
├── 位 18（偶數）：強制要求
├── 位 19（奇數）：可選支援
└── 大多數現代節點使用可選模式`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">啟用 Wumbo 通道</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`各實現的配置：

LND（lnd.conf）：
[Application Options]
# Wumbo 預設已啟用（v0.11.0+）
# 可以設置最大通道大小
maxchansize=1000000000  # 10 BTC（以 satoshis 計）

# 開設 Wumbo 通道
lncli openchannel --node_key <pubkey> \\
  --local_amt 500000000  # 5 BTC

CLN（config）：
# 啟用大額通道支援
large-channels

# 設置最大通道大小
max-channel-size-sat=1000000000

# 開設通道
lightning-cli fundchannel <node_id> 5btc

Eclair（eclair.conf）：
eclair.max-funding-satoshis=1000000000

檢查是否支援：
# LND
lncli getinfo | grep -i wumbo

# 查看對方節點是否支援
lncli getnodeinfo <pubkey> | jq '.node.features["19"]'`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">優缺點分析</h2>

  <div class="grid md:grid-cols-2 gap-4 mb-8">
    <div class="p-4 rounded-lg border border-green-500/30 bg-green-500/10">
      <h4 class="font-semibold text-green-700 dark:text-green-400 mb-2">優點</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 減少通道數量，簡化管理</li>
        <li>• 降低開關通道的鏈上費用</li>
        <li>• 增加單筆支付的最大金額</li>
        <li>• 提高路由效率</li>
        <li>• 適合高頻交易場景</li>
      </ul>
    </div>
    <div class="p-4 rounded-lg border border-red-500/30 bg-red-500/10">
      <h4 class="font-semibold text-red-700 dark:text-red-400 mb-2">缺點</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 單點風險集中</li>
        <li>• 對手方風險增加</li>
        <li>• 強制關閉損失更大</li>
        <li>• 需要更多鏈上資金鎖定</li>
        <li>• 隱私性可能降低</li>
      </ul>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">風險管理</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`大額通道的風險管理：

對手方選擇：
├── 選擇可靠、知名的節點
├── 確認對方有良好的 uptime 歷史
├── 避免與不熟悉的節點開大額通道
└── 考慮分散到多個對手方

運營要求：
├── 持續監控通道狀態
├── 使用瞭望塔保護
├── 定期備份通道狀態
├── 確保節點高可用性
└── 準備足夠的緊急資金處理強制關閉

風險量化：

假設 5 BTC 通道，對方作惡或離線：
┌─────────────────────────────────────────────────────────┐
│ 最壞情況：強制關閉                                      │
│                                                         │
│ 損失：                                                   │
│ ├── 強制關閉費用：~0.001-0.01 BTC                       │
│ ├── 資金鎖定時間：最多 2 週                             │
│ ├── HTLC 可能損失：取決於未結算金額                     │
│ └── 機會成本：鎖定期間無法使用                          │
│                                                         │
│ 如果對方發布舊狀態且你沒有瞭望塔：                      │
│ └── 可能損失全部通道資金                                │
└─────────────────────────────────────────────────────────┘`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">使用場景</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`適合使用 Wumbo 通道的場景：

1. 交易所/大型商家
├── 高交易量需求
├── 專業運維能力
├── 可承受較高風險
└── 減少通道管理開銷

2. 路由節點運營者
├── 提供大額支付路由
├── 成為網路骨幹
├── 賺取更多路由費
└── 與其他大型節點互聯

3. LSP（Lightning Service Provider）
├── 為用戶提供流動性
├── 減少開通道成本
├── 批量處理用戶需求
└── 專業流動性管理

4. 企業間結算
├── B2B 大額支付
├── 定期結算需求
├── 信任關係已建立
└── 減少頻繁開關通道

不適合的場景：
├── 個人小額用戶
├── 新手節點運營者
├── 沒有 24/7 監控能力
└── 與不熟悉的節點`}</pre>
  </div>

  <div class="not-prose mb-8 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
    <p class="text-sm text-yellow-700 dark:text-yellow-400">
      <strong>最佳實踐：</strong>
      即使支援 Wumbo 通道，也建議將資金分散到多個通道。
      不要把所有資金放在一個通道中。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">與 MPP 的配合</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Wumbo + MPP 策略：

不用 Wumbo（傳統方法）：
┌─────────────────────────────────────────────────────────┐
│ 發送 1 BTC 支付                                          │
│                                                         │
│ 通道 1 (0.15 BTC) ─┐                                    │
│ 通道 2 (0.15 BTC) ─┼─► 使用 MPP 拆分成 7+ 部分          │
│ 通道 3 (0.15 BTC) ─┤    複雜度高                         │
│ 通道 4 (0.15 BTC) ─┤    可能部分失敗                     │
│ ...                ─┘                                    │
└─────────────────────────────────────────────────────────┘

使用 Wumbo：
┌─────────────────────────────────────────────────────────┐
│ 發送 1 BTC 支付                                          │
│                                                         │
│ Wumbo 通道 (5 BTC) ─► 單一路徑完成                      │
│                        簡單、快速                        │
└─────────────────────────────────────────────────────────┘

混合策略（推薦）：
├── 1-2 個 Wumbo 通道處理大額支付
├── 多個小通道提供冗餘和隱私
├── MPP 在需要時提供額外容量
└── 平衡風險和便利性`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">相關資源</h2>

  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li>
      • <a
        href="https://github.com/lightning/bolts/blob/master/09-features.md"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">BOLT 9 - Feature Bits</a>
    </li>
    <li>
      • <a
        href="/tech/lightning/mpp"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">Multi-Path Payments</a>
    </li>
    <li>
      • <a
        href="/tech/lightning/channel-management"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">通道管理</a>
    </li>
  </ul>

  <div class="mt-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <p class="text-sm text-[var(--text-secondary)]">
      <strong class="text-[var(--text-primary)]">下一步：</strong>
      了解完整的 <a
        href="/tech/lightning/channel-management"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">通道管理</a
      >
      策略和最佳實踐。
    </p>
  </div>
</ArticleLayout>
