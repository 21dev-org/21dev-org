---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
---

<ArticleLayout
  title="Wumbo Channels 大額通道"
  description="了解閃電網路的 Wumbo 通道機制，如何突破預設的通道容量限制，開設大額通道。"
  breadcrumbs={[
    { label: '技術', href: '/tech/' },
    { label: 'Lightning Network', href: '/tech/lightning/' },
    { label: 'Wumbo Channels' },
  ]}
  difficulty="intermediate"
  readingTime="8 分鐘"
  prevPage={{ title: 'Inbound Liquidity', href: '/tech/lightning/inbound-liquidity' }}
  nextPage={{ title: 'Channel Management', href: '/tech/lightning/channel-management' }}
>
  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">什麼是 Wumbo 通道？</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    Wumbo 通道是指超過傳統限制的大額閃電網路通道。
    最初閃電網路規範設定了約 0.1677 BTC（16,777,215 satoshis）的通道容量上限，
    以限制早期實驗階段的風險。Wumbo 功能允許節點突破這個限制，
    開設任意大小的通道。
  </p>

  <div class="not-prose mb-8 p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
    <p class="text-sm text-blue-700 dark:text-blue-400">
      <strong>名稱來源：</strong>
      "Wumbo" 來自《海綿寶寶》卡通，是 "mini" 的相反詞。
      在閃電網路中表示 "大" 或 "大額"。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">通道容量限制</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Traditional Limits:

Maximum channel capacity: 2^24 - 1 satoshis
                        = 16,777,215 sats
                        = ~0.16777215 BTC

Maximum HTLC size: A portion of channel capacity

Reasons:
• Limit risk during early stages
• Using 3-byte encoding for amount field
• Encourage risk distribution across multiple channels

Wumbo Channels (option_support_large_channel):

Maximum channel capacity: 2^64 - 1 satoshis (theoretical)
                        = Actually limited by Bitcoin total supply

Practical limits:
• Node's available funds
• Risk counterparty is willing to accept
• Software implementation limits

Common large channels: 1-10 BTC`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">功能位與協商</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`option_support_large_channel (Feature Bits 18/19)

Feature Negotiation:

Alice                                 Bob
  |                                    |
  |---- init ----------------------->  |
  |     features: ...18/19...          |
  |                                    |
  |<--- init -------------------------  |
  |     features: ...18/19...          |
  |                                    |
  | [Both support Wumbo]               |
  |                                    |
  |---- open_channel ----------------> |
  |     funding_satoshis: 500000000    |  (5 BTC)
  |                                    |

Requirements:
• Both nodes must support option_support_large_channel
• Feature bits exchanged in init message
• Can only open large channel when both support it

Compatibility:
• Bit 18 (even): Compulsory
• Bit 19 (odd): Optional support
• Most modern nodes use optional mode`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">啟用 Wumbo 通道</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`各實現的配置：

LND（lnd.conf）：
[Application Options]
# Wumbo 預設已啟用（v0.11.0+）
# 可以設置最大通道大小
maxchansize=1000000000  # 10 BTC（以 satoshis 計）

# 開設 Wumbo 通道
lncli openchannel --node_key <pubkey> \\
  --local_amt 500000000  # 5 BTC

CLN（config）：
# 啟用大額通道支援
large-channels

# 設置最大通道大小
max-channel-size-sat=1000000000

# 開設通道
lightning-cli fundchannel <node_id> 5btc

Eclair（eclair.conf）：
eclair.max-funding-satoshis=1000000000

檢查是否支援：
# LND
lncli getinfo | grep -i wumbo

# 查看對方節點是否支援
lncli getnodeinfo <pubkey> | jq '.node.features["19"]'`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">優缺點分析</h2>

  <div class="grid md:grid-cols-2 gap-4 mb-8">
    <div class="p-4 rounded-lg border border-green-500/30 bg-green-500/10">
      <h4 class="font-semibold text-green-700 dark:text-green-400 mb-2">優點</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 減少通道數量，簡化管理</li>
        <li>• 降低開關通道的鏈上費用</li>
        <li>• 增加單筆支付的最大金額</li>
        <li>• 提高路由效率</li>
        <li>• 適合高頻交易場景</li>
      </ul>
    </div>
    <div class="p-4 rounded-lg border border-red-500/30 bg-red-500/10">
      <h4 class="font-semibold text-red-700 dark:text-red-400 mb-2">缺點</h4>
      <ul class="text-sm text-[var(--text-secondary)] space-y-1">
        <li>• 單點風險集中</li>
        <li>• 對手方風險增加</li>
        <li>• 強制關閉損失更大</li>
        <li>• 需要更多鏈上資金鎖定</li>
        <li>• 隱私性可能降低</li>
      </ul>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">風險管理</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Risk Management for Large Channels

Counterparty Selection:
• Choose reliable, well-known nodes
• Confirm good uptime history
• Avoid large channels with unfamiliar nodes
• Consider distributing across multiple counterparties

Operational Requirements:
• Continuous channel state monitoring
• Use watchtower protection
• Regular channel state backups
• Ensure high node availability
• Prepare sufficient emergency funds for force closes

Risk Quantification:

Assume 5 BTC channel, counterparty acts maliciously or goes offline:

Worst case: Force close

Losses:
• Force close fees: ~0.001-0.01 BTC
• Funds lock time: Up to 2 weeks
• Potential HTLC losses: Depends on unsettled amounts
• Opportunity cost: Cannot use during lock period

If counterparty publishes old state and you have no watchtower:
• May lose all channel funds`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">使用場景</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Suitable Scenarios for Wumbo Channels

1. Exchanges/Large Merchants
   • High transaction volume needs
   • Professional operations capability
   • Can tolerate higher risk
   • Reduce channel management overhead

2. Routing Node Operators
   • Provide large payment routing
   • Become network backbone
   • Earn more routing fees
   • Interconnect with other large nodes

3. LSP (Lightning Service Provider)
   • Provide liquidity for users
   • Reduce channel opening costs
   • Batch process user needs
   • Professional liquidity management

4. Enterprise Settlement
   • B2B large payments
   • Regular settlement needs
   • Trust relationship established
   • Reduce frequent channel opens/closes

Not Suitable For:
• Individual small users
• Beginner node operators
• No 24/7 monitoring capability
• With unfamiliar nodes`}</pre>
  </div>

  <div class="not-prose mb-8 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
    <p class="text-sm text-yellow-700 dark:text-yellow-400">
      <strong>最佳實踐：</strong>
      即使支援 Wumbo 通道，也建議將資金分散到多個通道。
      不要把所有資金放在一個通道中。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">與 MPP 的配合</h2>

  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <pre
      class="text-[var(--text-secondary)]">{`Wumbo + MPP Strategy

Without Wumbo (Traditional Method):
Sending 1 BTC payment

Channel 1 (0.15 BTC) --+
Channel 2 (0.15 BTC) --+--> Use MPP to split into 7+ parts
Channel 3 (0.15 BTC) --+    High complexity
Channel 4 (0.15 BTC) --+    Parts may fail
...                  --+

Using Wumbo:
Sending 1 BTC payment

Wumbo channel (5 BTC) --> Single path completion
                          Simple, fast

Hybrid Strategy (Recommended):
• 1-2 Wumbo channels for large payments
• Multiple small channels for redundancy and privacy
• MPP provides extra capacity when needed
• Balance risk and convenience`}</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">相關資源</h2>

  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li>
      • <a
        href="https://github.com/lightning/bolts/blob/master/09-features.md"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">BOLT 9 - Feature Bits</a>
    </li>
    <li>
      • <a
        href="/tech/lightning/mpp"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">Multi-Path Payments</a>
    </li>
    <li>
      • <a
        href="/tech/lightning/channel-management"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">通道管理</a>
    </li>
  </ul>

  <div class="mt-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <p class="text-sm text-[var(--text-secondary)]">
      <strong class="text-[var(--text-primary)]">下一步：</strong>
      了解完整的 <a
        href="/tech/lightning/channel-management"
        class="text-yellow-600 dark:text-yellow-400 hover:underline">通道管理</a
      >
      策略和最佳實踐。
    </p>
  </div>
</ArticleLayout>
