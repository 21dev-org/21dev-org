---
import BipLayout from '@/layouts/BipLayout.astro';
---

<BipLayout number={141} prevBip={125} nextBip={143}>
  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">摘要</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    隔離見證（Segregated Witness，簡稱 SegWit）是對比特幣協議的軟分叉升級。
    它通過將簽名數據（見證）與交易數據分離，解決了多個長期存在的問題。
  </p>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">解決的問題</h2>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">1. 交易延展性</h3>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    在 SegWit 之前，第三方可以在交易被確認前修改交易的簽名部分， 從而改變交易
    ID（txid），而不會使交易無效。這被稱為「交易延展性」問題。 SegWit
    通過將簽名數據移到交易之外來解決這個問題。
  </p>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">2. 區塊容量</h3>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    SegWit 引入了「區塊權重」的概念，取代了原來的區塊大小限制。 見證數據以折扣計算（1 字節見證數據 =
    0.25 權重單位）， 這實際上允許了更大的區塊容量。
  </p>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">3. 腳本版本控制</h3>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    SegWit 引入了腳本版本控制系統，使未來的腳本升級可以通過軟分叉實現。 這為 Taproot
    等後續升級奠定了基礎。
  </p>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">技術細節</h2>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">區塊權重</h3>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-4">SegWit 定義了新的區塊限制：</p>
  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm"
  >
    <p class="text-[var(--text-secondary)]">區塊權重 = 基本大小 × 3 + 總大小</p>
    <p class="text-[var(--text-secondary)]">最大區塊權重 = 4,000,000 權重單位</p>
  </div>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    這相當於理論上約 4MB 的區塊大小，但實際上通常約為 2MB。
  </p>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">見證程序</h3>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-4">
    SegWit 定義了兩種原生見證輸出類型：
  </p>
  <ul class="space-y-3 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500 font-bold">P2WPKH</span>
      <span
        >（Pay to Witness Public Key Hash）：地址以 <code
          class="px-1 bg-neutral-100 dark:bg-neutral-800 rounded">bc1q</code
        > 開頭</span
      >
    </li>
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500 font-bold">P2WSH</span>
      <span>（Pay to Witness Script Hash）：用於更複雜的腳本</span>
    </li>
  </ul>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">好處</h2>
  <ul class="space-y-3 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span
        ><strong class="text-[var(--text-primary)]">修復交易延展性</strong>：使閃電網路等 Layer 2
        解決方案成為可能</span
      >
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span><strong class="text-[var(--text-primary)]">增加區塊容量</strong>：提高網路吞吐量</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span><strong class="text-[var(--text-primary)]">降低交易費用</strong>：見證數據折扣計算</span
      >
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span><strong class="text-[var(--text-primary)]">腳本版本控制</strong>：支持未來升級</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span
        ><strong class="text-[var(--text-primary)]">提高簽名驗證效率</strong>：改進的哈希計算</span
      >
    </li>
  </ul>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">相關 BIP</h2>
  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span>BIP-143：SegWit 交易簽名驗證</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span>BIP-144：SegWit 對等協議</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span
        ><a href="/bips/bip-0340" class="text-bitcoin-500 hover:underline">BIP-340/341</a
        >：Taproot（SegWit v1）</span
      >
    </li>
  </ul>
</BipLayout>
