---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
import Tag from '@/components/ui/Tag.astro';
---

<ArticleLayout
  title="BIP-16: Pay to Script Hash (P2SH)"
  description="定義了 P2SH 輸出類型，允許將複雜腳本的哈希作為地址使用。"
  breadcrumbs={[{ label: 'BIPs', href: '/bips/' }, { label: 'BIP-16' }]}
  tags={['Standards Track', 'Final']}
  author="Gavin Andresen"
  date={new Date('2012-01-03')}
  prevPage={{ title: 'BIP-13: P2SH 地址', href: '/bips/bip-0013' }}
  nextPage={{ title: 'BIP-21: URI 協議', href: '/bips/bip-0021' }}
>
  <div
    class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]"
  >
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
      <div>
        <span class="text-[var(--text-tertiary)]">BIP 編號</span>
        <p class="font-semibold text-[var(--text-primary)]">16</p>
      </div>
      <div>
        <span class="text-[var(--text-tertiary)]">類型</span>
        <p class="font-semibold text-[var(--text-primary)]">Standards Track</p>
      </div>
      <div>
        <span class="text-[var(--text-tertiary)]">狀態</span>
        <p><Tag variant="success" size="sm">Final</Tag></p>
      </div>
      <div>
        <span class="text-[var(--text-tertiary)]">啟用日期</span>
        <p class="font-semibold text-[var(--text-primary)]">2012-04-01</p>
      </div>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">摘要</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    Pay to Script Hash (P2SH) 是一種腳本模式，允許將任意複雜的贖回條件壓縮為一個 20 字節的哈希值。
    發送者只需要知道這個哈希值，而不需要了解完整的贖回腳本。P2SH 地址以數字 <code
      class="px-1 bg-neutral-100 dark:bg-neutral-800 rounded">3</code
    > 開頭。
  </p>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">動機</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    在 P2SH 之前，如果要使用多簽名錢包，發送者需要在交易中包含完整的多簽名腳本。 這意味著：
  </p>
  <ul class="space-y-3 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span>發送者需要知道接收者的完整贖回腳本</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span>交易大小增加，手續費由發送者承擔</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span>無法使用簡單的地址格式</span>
    </li>
  </ul>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">運作方式</h2>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">
    鎖定腳本 (scriptPubKey)
  </h3>
  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <p class="text-[var(--text-secondary)]">OP_HASH160 &lt;20-byte-hash&gt; OP_EQUAL</p>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">解鎖腳本 (scriptSig)</h3>
  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <p class="text-[var(--text-secondary)]">&lt;signatures...&gt; &lt;serialized-script&gt;</p>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">驗證流程</h3>
  <ol class="space-y-3 text-[var(--text-secondary)] mb-6 list-decimal list-inside">
    <li>計算 serialized-script 的 HASH160</li>
    <li>驗證哈希值與 scriptPubKey 中的哈希匹配</li>
    <li>將 serialized-script 反序列化並執行</li>
    <li>驗證簽名是否有效</li>
  </ol>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">應用場景</h2>
  <ul class="space-y-3 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span
        ><strong class="text-[var(--text-primary)]">多簽名錢包</strong>：2-of-3、3-of-5 等多簽配置</span
      >
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span
        ><strong class="text-[var(--text-primary)]">時間鎖合約</strong>：結合 CLTV/CSV 的複雜條件</span
      >
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span
        ><strong class="text-[var(--text-primary)]">SegWit 嵌套</strong>：P2SH-P2WPKH 和 P2SH-P2WSH</span
      >
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span><strong class="text-[var(--text-primary)]">原子交換</strong>：跨鏈交易的基礎</span>
    </li>
  </ul>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">地址格式</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-4">
    P2SH 地址使用 Base58Check 編碼，版本前綴為 <code
      class="px-1 bg-neutral-100 dark:bg-neutral-800 rounded">0x05</code
    >：
  </p>
  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <p class="text-[var(--text-secondary)]">3J98t1WpEZ73CNmQviecrnyiWrnqRhWNLy</p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">安全考量</h2>
  <div class="not-prose mb-6 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
    <p class="text-sm text-yellow-700 dark:text-yellow-400">
      <strong>注意：</strong> P2SH 的安全性取決於 HASH160（RIPEMD160(SHA256)）的抗碰撞性。 目前這被認為是安全的，但較新的標準（如
      P2WSH）使用更長的哈希以提供更強的安全性。
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">相關 BIP</h2>
  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span>BIP-13：P2SH 地址格式</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span
        ><a href="/bips/bip-0141" class="text-bitcoin-500 hover:underline">BIP-141</a>：SegWit（引入
        P2WSH）</span
      >
    </li>
    <li class="flex items-start gap-2">
      <span class="text-bitcoin-500">•</span>
      <span
        ><a href="/bips/bip-0065" class="text-bitcoin-500 hover:underline">BIP-65</a
        >：OP_CHECKLOCKTIMEVERIFY</span
      >
    </li>
  </ul>

  <div class="mt-8 p-4 rounded-lg bg-bitcoin-500/10 border border-bitcoin-500/30">
    <p class="text-sm text-bitcoin-700 dark:text-bitcoin-400">
      <strong>延伸閱讀：</strong> 查看
      <a
        href="https://github.com/bitcoin/bips/blob/master/bip-0016.mediawiki"
        target="_blank"
        rel="noopener noreferrer"
        class="underline hover:no-underline"
      >
        GitHub 上的完整 BIP-16 文件
      </a>
    </p>
  </div>
</ArticleLayout>
