---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
import Tag from '@/components/ui/Tag.astro';
---

<ArticleLayout
  title="BIP-385: 原始輸出描述符"
  description="定義 raw() 和 addr() 描述符函數，用於表示任意腳本和地址。"
  breadcrumbs={[
    { label: 'BIPs', href: '/bips/' },
    { label: 'BIP-385' },
  ]}
  tags={['Informational', 'Final']}
  author="Pieter Wuille, Andrew Chow"
  date={new Date('2021-06-27')}
  prevPage={{ title: 'BIP-384: 組合描述符', href: '/bips/bip-0384' }}
  nextPage={{ title: 'BIP-386: Taproot 描述符', href: '/bips/bip-0386' }}
>
  <div class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
      <div>
        <span class="text-[var(--text-tertiary)]">BIP 編號</span>
        <p class="font-semibold text-[var(--text-primary)]">385</p>
      </div>
      <div>
        <span class="text-[var(--text-tertiary)]">類型</span>
        <p class="font-semibold text-[var(--text-primary)]">Informational</p>
      </div>
      <div>
        <span class="text-[var(--text-tertiary)]">狀態</span>
        <p><Tag variant="success" size="sm">Final</Tag></p>
      </div>
      <div>
        <span class="text-[var(--text-tertiary)]">依賴</span>
        <p class="font-semibold text-[var(--text-primary)]">BIP-380</p>
      </div>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">摘要</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    BIP-385 定義了兩個特殊的描述符函數：
    <code class="px-1 py-0.5 rounded bg-[var(--bg-secondary)]">raw()</code> 用於表示任意的原始腳本，
    <code class="px-1 py-0.5 rounded bg-[var(--bg-secondary)]">addr()</code> 用於直接指定地址。
    這些函數用於處理非標準腳本或已知地址的監控。
  </p>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">raw() — 原始腳本</h2>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">格式</h3>

  <div class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <pre class="text-sm overflow-x-auto font-mono">
語法：raw(HEX_SCRIPT)

參數：
• HEX_SCRIPT = 輸出腳本的十六進位表示

範例：
raw(76a914bef5a2f9a56a94aab12459f72ad9cf8cf19c7bbe88ac)

這是一個 P2PKH 腳本：
76        OP_DUP
a9        OP_HASH160
14        OP_PUSHBYTES_20
bef5a2f9a56a94aab12459f72ad9cf8cf19c7bbe  （公鑰哈希）
88        OP_EQUALVERIFY
ac        OP_CHECKSIG</pre>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">使用場景</h3>

  <div class="not-prose mb-8 space-y-4">
    <div class="p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">非標準腳本</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        描述無法用其他描述符函數表達的自定義腳本，
        如帶有特殊條件的時間鎖或複雜的條件腳本。
      </p>
    </div>
    <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/30">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">OP_RETURN 輸出</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        監控包含數據的 OP_RETURN 輸出（雖然這些是不可花費的）。
      </p>
    </div>
    <div class="p-4 rounded-lg bg-purple-500/10 border border-purple-500/30">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">歷史腳本</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        表示區塊鏈早期使用的非標準腳本類型。
      </p>
    </div>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">範例：OP_RETURN</h3>

  <div class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <pre class="text-sm overflow-x-auto font-mono">
監控包含 "Hello" 的 OP_RETURN：

raw(6a0548656c6c6f)

解析：
6a        OP_RETURN
05        OP_PUSHBYTES_5
48656c6c6f  "Hello" 的 hex 編碼

注意：OP_RETURN 輸出不可花費，僅用於監控</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">addr() — 地址描述符</h2>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">格式</h3>

  <div class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <pre class="text-sm overflow-x-auto font-mono">
語法：addr(ADDRESS)

參數：
• ADDRESS = 任何有效的比特幣地址

範例：
addr(1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2)  // P2PKH
addr(3J98t1WpEZ73CNmQviecrnyiWrnqRhWNLy)  // P2SH
addr(bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4)  // P2WPKH
addr(bc1p0xlxvlhemja6c4dqv22uapctqupfhlxm9h8z3k2e72q4k9hcz7vqzk5jj0)  // P2TR</pre>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">內部轉換</h3>

  <div class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <pre class="text-sm overflow-x-auto font-mono">
addr() 會自動轉換為對應的腳本：

addr(1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2)
  → 解碼 Base58Check
  → 提取公鑰哈希
  → 構建 P2PKH 腳本
  → 等同於 raw(76a914bef5a2f9...88ac)

addr(bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4)
  → 解碼 Bech32
  → 提取見證程序
  → 構建 P2WPKH 腳本
  → 等同於 raw(0014751e76e8199196d454941c45d1b3a323f1433bd6)</pre>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">使用場景</h3>

  <div class="not-prose mb-8 space-y-4">
    <div class="p-4 rounded-lg bg-bitcoin-500/10 border border-bitcoin-500/30">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">監控已知地址</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        當你只知道地址（而非公鑰或私鑰）時，
        可以使用 addr() 來監控該地址的交易。
      </p>
    </div>
    <div class="p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">Watch-Only 錢包</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        創建只讀錢包來追蹤特定地址，
        無需擁有對應的私鑰。
      </p>
    </div>
    <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/30">
      <h4 class="font-semibold text-[var(--text-primary)] mb-2">支付驗證</h4>
      <p class="text-sm text-[var(--text-secondary)]">
        商家監控收款地址，確認客戶支付。
      </p>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">限制</h2>

  <div class="not-prose mb-8 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
    <h4 class="font-semibold text-[var(--text-primary)] mb-3">重要限制</h4>
    <ul class="text-sm text-[var(--text-secondary)] space-y-2">
      <li>
        <strong>不可簽章</strong>：raw() 和 addr() 描述符無法用於簽署交易，
        因為它們不包含密鑰資訊。
      </li>
      <li>
        <strong>不可派生</strong>：不支援範圍派生（沒有 /0/* 這樣的路徑）。
      </li>
      <li>
        <strong>單一輸出</strong>：每個 raw() 或 addr() 只對應一個特定輸出。
      </li>
      <li>
        <strong>無來源資訊</strong>：不支援 [fingerprint/path] 來源標記。
      </li>
    </ul>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">比較</h2>

  <div class="not-prose mb-8 overflow-x-auto">
    <table class="w-full text-sm border-collapse">
      <thead>
        <tr class="border-b border-[var(--border-default)]">
          <th class="text-left p-3 text-[var(--text-primary)]">特性</th>
          <th class="text-left p-3 text-[var(--text-primary)]">raw()</th>
          <th class="text-left p-3 text-[var(--text-primary)]">addr()</th>
        </tr>
      </thead>
      <tbody class="text-[var(--text-secondary)]">
        <tr class="border-b border-[var(--border-default)]">
          <td class="p-3">輸入格式</td>
          <td class="p-3">十六進位腳本</td>
          <td class="p-3">地址字串</td>
        </tr>
        <tr class="border-b border-[var(--border-default)]">
          <td class="p-3">適用腳本</td>
          <td class="p-3">任意腳本</td>
          <td class="p-3">有地址的標準腳本</td>
        </tr>
        <tr class="border-b border-[var(--border-default)]">
          <td class="p-3">可讀性</td>
          <td class="p-3">低</td>
          <td class="p-3">高</td>
        </tr>
        <tr class="border-b border-[var(--border-default)]">
          <td class="p-3">OP_RETURN</td>
          <td class="p-3 text-green-500">支援</td>
          <td class="p-3 text-red-500">不支援</td>
        </tr>
        <tr>
          <td class="p-3">簽章能力</td>
          <td class="p-3 text-red-500">不可</td>
          <td class="p-3 text-red-500">不可</td>
        </tr>
      </tbody>
    </table>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">Bitcoin Core 範例</h2>

  <div class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <pre class="text-sm overflow-x-auto font-mono">
# 導入地址用於監控
$ bitcoin-cli importdescriptors '[&#123;
  "desc": "addr(bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4)#checksum",
  "timestamp": "now",
  "watchonly": true,
  "label": "監控地址"
&#125;]'

# 導入原始腳本
$ bitcoin-cli importdescriptors '[&#123;
  "desc": "raw(76a914bef5a2f9a56a94aab12459f72ad9cf8cf19c7bbe88ac)#checksum",
  "timestamp": "now",
  "watchonly": true
&#125;]'

# 獲取描述符資訊
$ bitcoin-cli getdescriptorinfo "addr(1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2)"
&#123;
  "descriptor": "addr(1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2)#...",
  "isrange": false,
  "issolvable": false,
  "hasprivatekeys": false
&#125;</pre>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">總結</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-4">
    BIP-385 定義的 raw() 和 addr() 提供了表示任意腳本和地址的能力。
    它們主要用於監控目的，因為沒有包含密鑰資訊所以無法簽署交易。
    對於需要簽章能力的錢包，應該使用其他包含密鑰的描述符函數。
  </p>

  <div class="not-prose mt-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]">
    <h4 class="font-semibold text-[var(--text-primary)] mb-2">延伸閱讀</h4>
    <ul class="text-sm text-[var(--text-secondary)] space-y-1">
      <li>
        <a href="https://github.com/bitcoin/bips/blob/master/bip-0385.mediawiki" target="_blank" rel="noopener noreferrer" class="text-bitcoin-500 hover:underline">
          BIP-385 完整規格
        </a>
      </li>
      <li>
        <a href="/bips/bip-0380" class="text-bitcoin-500 hover:underline">
          BIP-380: 描述符基礎框架
        </a>
      </li>
    </ul>
  </div>
</ArticleLayout>
