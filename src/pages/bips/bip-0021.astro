---
import ArticleLayout from '@/layouts/ArticleLayout.astro';
import Tag from '@/components/ui/Tag.astro';
---

<ArticleLayout
  title="BIP-21: URI Scheme"
  description="定義比特幣支付的 URI 格式，讓用戶可以透過點擊連結或掃描 QR Code 發起支付。"
  breadcrumbs={[{ label: 'BIPs', href: '/bips/' }, { label: 'BIP-21' }]}
  tags={['Standards Track', 'Proposed']}
  author="Nils Schneider, Matt Corallo"
  date={new Date('2012-01-29')}
  prevPage={{ title: 'BIP-16: P2SH', href: '/bips/bip-0016' }}
  nextPage={{ title: 'BIP-32: HD 錢包', href: '/bips/bip-0032' }}
>
  <div
    class="not-prose mb-8 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)]"
  >
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
      <div>
        <span class="text-[var(--text-tertiary)]">BIP 編號</span>
        <p class="font-semibold text-[var(--text-primary)]">21</p>
      </div>
      <div>
        <span class="text-[var(--text-tertiary)]">類型</span>
        <p class="font-semibold text-[var(--text-primary)]">Standards Track</p>
      </div>
      <div>
        <span class="text-[var(--text-tertiary)]">狀態</span>
        <p><Tag variant="default" size="sm">Proposed</Tag></p>
      </div>
      <div>
        <span class="text-[var(--text-tertiary)]">應用</span>
        <p class="font-semibold text-[var(--text-primary)]">廣泛使用</p>
      </div>
    </div>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">摘要</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    BIP-21 定義了一個標準的 URI scheme，讓比特幣地址可以像網頁連結一樣被點擊。
    這使得支付請求可以包含金額、標籤、訊息等資訊，大大簡化了支付流程。
  </p>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">URI 格式</h2>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">基本語法</h3>
  <div
    class="not-prose mb-6 p-4 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <p class="text-[var(--text-secondary)]">
      bitcoin:&lt;address&gt;[?param1=value1&amp;param2=value2]
    </p>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">參數說明</h3>
  <div class="not-prose mb-6 overflow-x-auto">
    <table class="w-full text-sm" aria-label="BIP-21 URI 參數說明">
      <thead>
        <tr class="border-b border-[var(--border-default)]">
          <th scope="col" class="text-left py-2 text-[var(--text-primary)]">參數</th>
          <th scope="col" class="text-left py-2 text-[var(--text-primary)]">說明</th>
          <th scope="col" class="text-left py-2 text-[var(--text-primary)]">範例</th>
        </tr>
      </thead>
      <tbody class="text-[var(--text-secondary)]">
        <tr class="border-b border-[var(--border-default)]">
          <td class="py-2 font-mono">amount</td>
          <td class="py-2">金額（單位：BTC）</td>
          <td class="py-2 font-mono">amount=0.001</td>
        </tr>
        <tr class="border-b border-[var(--border-default)]">
          <td class="py-2 font-mono">label</td>
          <td class="py-2">收款者名稱（給用戶看）</td>
          <td class="py-2 font-mono">label=Coffee%20Shop</td>
        </tr>
        <tr class="border-b border-[var(--border-default)]">
          <td class="py-2 font-mono">message</td>
          <td class="py-2">支付說明</td>
          <td class="py-2 font-mono">message=Order%20123</td>
        </tr>
        <tr>
          <td class="py-2 font-mono">req-*</td>
          <td class="py-2">必要參數前綴</td>
          <td class="py-2 font-mono">req-somethingnew=...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">範例</h2>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">最簡單的形式</h3>
  <div
    class="not-prose mb-4 p-3 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <p class="text-[var(--text-secondary)]">bitcoin:bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq</p>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">包含金額</h3>
  <div
    class="not-prose mb-4 p-3 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <p class="text-[var(--text-secondary)]">
      bitcoin:bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq?amount=0.001
    </p>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">完整範例</h3>
  <div
    class="not-prose mb-6 p-3 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <p class="text-[var(--text-secondary)] break-all">
      bitcoin:bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq?amount=0.001&label=Coffee%20Shop&message=Order%20123
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">URL 編碼規則</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-4">
    參數值必須使用 URL 編碼（百分比編碼）：
  </p>
  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li>• 空格 → <code class="px-1 bg-neutral-100 dark:bg-neutral-800 rounded">%20</code></li>
    <li>• & → <code class="px-1 bg-neutral-100 dark:bg-neutral-800 rounded">%26</code></li>
    <li>• = → <code class="px-1 bg-neutral-100 dark:bg-neutral-800 rounded">%3D</code></li>
    <li>• ? → <code class="px-1 bg-neutral-100 dark:bg-neutral-800 rounded">%3F</code></li>
  </ul>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">擴展參數</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-4">
    BIP-21 支援未來擴展，但有特殊規則：
  </p>
  <ul class="space-y-3 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span
        ><strong class="text-[var(--text-primary)]">可選參數</strong
        >：錢包可以忽略不認識的參數</span
      >
    </li>
    <li class="flex items-start gap-2">
      <span class="text-yellow-500">△</span>
      <span
        ><strong class="text-[var(--text-primary)]">req- 前綴</strong>：以 req-
        開頭的參數是必要的，如果錢包不支援該參數，應拒絕處理整個 URI</span
      >
    </li>
  </ul>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">與其他 BIP 的整合</h2>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">
    BIP-70 Payment Protocol（已棄用）
  </h3>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-4">
    BIP-70 定義了 <code class="px-1 bg-neutral-100 dark:bg-neutral-800 rounded">r</code> 參數用於支付請求：
  </p>
  <div
    class="not-prose mb-6 p-3 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <p class="text-[var(--text-secondary)]">bitcoin:?r=https://merchant.com/pay.php?order=123</p>
  </div>
  <div class="not-prose mb-6 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
    <p class="text-sm text-yellow-700 dark:text-yellow-400">
      <strong>注意：</strong> BIP-70 Payment Protocol 因安全和隱私問題已被大多數錢包棄用。
    </p>
  </div>

  <h3 class="text-xl font-semibold text-[var(--text-primary)] mt-6 mb-3">閃電網路整合</h3>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-4">
    現代錢包支援統一 QR Code，同時包含鏈上地址和閃電發票：
  </p>
  <div
    class="not-prose mb-6 p-3 rounded-lg bg-[var(--bg-secondary)] border border-[var(--border-default)] font-mono text-sm overflow-x-auto"
  >
    <p class="text-[var(--text-secondary)] break-all">
      bitcoin:bc1q...?amount=0.001&lightning=lnbc100n1p...
    </p>
  </div>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">實際應用</h2>
  <ul class="space-y-3 text-[var(--text-secondary)] mb-6">
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span
        ><strong class="text-[var(--text-primary)]">網頁支付按鈕</strong>：<code
          class="px-1 bg-neutral-100 dark:bg-neutral-800 rounded">&lt;a href="bitcoin:..."&gt;</code
        ></span
      >
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span
        ><strong class="text-[var(--text-primary)]">QR Code</strong>：將 URI 編碼為 QR Code 供掃描</span
      >
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span><strong class="text-[var(--text-primary)]">電商結帳</strong>：預填金額和訂單資訊</span>
    </li>
    <li class="flex items-start gap-2">
      <span class="text-green-500">✓</span>
      <span><strong class="text-[var(--text-primary)]">捐款連結</strong>：一鍵打開錢包應用</span>
    </li>
  </ul>

  <h2 class="text-2xl font-bold text-[var(--text-primary)] mt-8 mb-4">錢包支援</h2>
  <p class="text-[var(--text-secondary)] leading-relaxed mb-6">
    所有主流比特幣錢包都支援 BIP-21 URI：
  </p>
  <ul class="space-y-2 text-[var(--text-secondary)] mb-6">
    <li>• Bitcoin Core</li>
    <li>• BlueWallet</li>
    <li>• Sparrow</li>
    <li>• Electrum</li>
    <li>• 所有現代硬體錢包配套軟體</li>
  </ul>

  <div class="mt-8 p-4 rounded-lg bg-bitcoin-500/10 border border-bitcoin-500/30">
    <p class="text-sm text-bitcoin-700 dark:text-bitcoin-400">
      <strong>延伸閱讀：</strong> 查看
      <a
        href="https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki"
        target="_blank"
        rel="noopener noreferrer"
        class="underline hover:no-underline"
      >
        GitHub 上的完整 BIP-21 文件
      </a>
    </p>
  </div>
</ArticleLayout>
